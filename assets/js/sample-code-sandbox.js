/*! ArcGIS API for JavaScript 4.4 | Copyright (c) 2017 Esri. All rights reserved. | http://www.esri.com/legal/privacy | https://developers.arcgis.com/terms/faq */
require(["beautify-web/beautify-html","eligrey/FileSaver","dojo/_base/connect","dojo/_base/event","dojo/dom-construct","dojo/dom-style","dojo/has","dojo/on","dojo/query","esri/config","esri/core/urlUtils","esri/request","dojo/NodeList-dom","dojo/domReady!"],function(e,o,n,t,c,a,i,d,s,r,m,l){function u(){I.toggleClass("btn-clear"),I.toggleClass("icon-ui-minimize"),I.toggleClass("icon-ui-maximize"),N.toggleClass("sandbox-container-minimized"),J.toggleClass("sandbox-output-maximized"),M.toggleClass("sandbox-container-minimized"),x(),O.resize(!0)}function f(){V.toggleClass("btn-clear"),V.toggleClass("icon-ui-minimize"),V.toggleClass("icon-ui-maximize"),N.toggleClass("sandbox-container-maximized"),J.toggleClass("sandbox-output-minimized"),M.toggleClass("sandbox-container-minimized"),x(),O.resize(!0)}function p(){var e=R.attr("data-sample-description-url")[0];document.location=e}function g(){E("saveFile");try{if(!!new Blob){var e=new Blob([O.getSession().getValue()],{type:"text/plain;charset='"+document.characterSet+"'"});o(e,q+".html")}}catch(e){console.log("Download is not supported for %s",navigator.userAgent)}}function b(){E("openJSBin");var e,o=window.open("about:blank",function(){function e(e){for(var o="",n=0;n<e;n++)o+=(65536*(1+Math.random())|0).toString(16).substring(1);return o}return[e(2),e(1),e(1),e(1),e(3)].join("-")}()),n=O.getSession().getValue(),t=y(n),c=["html"],a=o.document.createElement("form");a.setAttribute("target","_self"),a.setAttribute("method","post"),a.setAttribute("action","https://jsbin.com?html,output"),a.style.display="none";for(var i=0;i<c.length;i++)e=o.document.createElement("input"),a.appendChild(e),e.type="hidden",e.name=c[i],e.value=encodeURIComponent(t);o.document.body.appendChild(a),a.submit()}function h(e){function o(e,o){N[0].style.right=o-e+"px",J[0].style.left=e+"px"}t.stop(e),M.addClass("resizing"),G.addClass("resizing");var c=a.get("wrapper","width"),i=d(window,"mousemove",function(e){t.stop(e),e.pageX>50&&e.pageX+70<c&&(o(e.pageX+11,c),O.resize(!0))});d.once(parent.document,"mouseup",function(e){M.removeClass("resizing"),G.removeClass("resizing"),n.disconnect(i)})}function x(){J.removeAttr("style"),N.removeAttr("style"),j()}function C(){E("updateSandboxOutput"),$.addClass("is-active"),G=s(".js-sandbox-iframe"),G&&c.destroy(G[0]),T&&n.disconnect(T);var e=c.create("iframe",{class:"sandbox-iframe js-sandbox-iframe"},J[0]);T=d(e,"load",function(){G=s(".js-sandbox-iframe"),$.removeClass("is-active"),D.removeClass("btn-disabled")}),E("sandboxIsLoaded"),idoc=e.contentWindow?e.contentWindow:e.contentDocument.document?e.contentDocument.document:e.contentDocument;var o=O.getSession().getValue();o=w(o),i("ie")?(idoc.contents=o,e.src="javascript:window['contents']"):(idoc.document.open(),idoc.document.write(o),idoc.document.close())}function v(){var o={brace_style:"none",end_with_newline:!1,extra_liners:"",indent_size:2,max_preserve_newlines:2,preserve_newlines:!0,wrap_line_length:80},n=O.getSession().getValue(),t=e.html_beautify(n,o);O.getSession().setValue(t)}function y(e){var o=e,n=/<title>[^<]*<\/title>/im,t=e.match(n),c=t?t[0]:"",a=c.replace(/<\/?title>/gim,"");if(c&&""!==c){var i=F.match(/[-\w]*(?=\/live(\/index\.html)?)/im),d=i?i[0]:"sample",s="https://developers.arcgis.com/javascript/latest/"+d+"/index.html",r="";r+='<meta name="description" content="['+a+']">\n  ',r+="\x3c!--\n  ArcGIS API for JavaScript, https://js.arcgis.com\n  For more information about the {{ sample_name }} sample, read the original sample description at developers.arcgis.com.\n  {{ sample_url }}\n  --\x3e\n".replace(/{{\ssample_name\s}}/,d).replace(/{{\ssample_url\s}}/,s)+c,o=e.replace(n,r)}return o}function S(){if(W&&"block"!==W.style("display")[0]){var e="";K.forEach(function(o){e+="<tr><td><span class='command'>"+o.command+'</span></td><td><span class="action">'+o.description+"</span></td></tr>"}),P[0].innerHTML=e,W.style("display","block"),j()}}function j(){var e=W[0].clientWidth,o=W[0].clientHeight,n=(document.body.clientHeight-o)/2+"px",t=(document.body.clientWidth-e)/2+"px";W.style("top",n),W.style("left",t)}function w(e){var o=e.match(/issMeshUrl = ".+?"/g);if(o&&(o=o.filter(function(e){return-1===e.indexOf("//")}),o.forEach(function(o){var n=o.split('"')[1];e=e.replace(n,F+"/"+n)})),o=e.match(/url = ".+?"/g),o&&(o=o.filter(function(e){return-1===e.indexOf("//")}),o.forEach(function(o){var n=o.split('"')[1];e=e.replace(n,F+"/"+n)})),o=e.match(/".\/Clock.js"/g),o&&(o=o.filter(function(e){return-1===e.indexOf("//")}),o.forEach(function(o){var n=o.split('"')[1];e=e.replace(n,F+"/"+n)})),o=e.match(/".\/clock.svg"/g),o&&(o=o.filter(function(e){return-1===e.indexOf("//")}),o.forEach(function(o){var n=o.split('"')[1];e=e.replace(n,F+"/"+n)})),o=e.match(/image: ".+?"/g),o&&(o=o.filter(function(e){return-1===e.indexOf("//")}),o.forEach(function(o){var n=o.split('"')[1];e=e.replace(n,F+"/"+n)})),o=e.match(/url: ".+?"/g),o&&(o=o.filter(function(e){return-1===e.indexOf("//")}),o.forEach(function(o){var n=o.split('"')[1];e=e.replace(n,F+"/"+n)})),o=e.match(/src='.+?'/g),o&&(o=o.filter(function(e){return-1===e.indexOf("//")}),o.forEach(function(o){var n=o.split("'")[1];e=e.replace(n,F+"/"+n)})),o=e.match(/getUniqueValueSymbol\(".+?"/g),o&&(o=o.filter(function(e){return-1===e.indexOf("//")}),o=o.filter(function(e){return-1===e.indexOf("{")}),o.forEach(function(o){var n=o.split('"')[1];e=e.replace(n,F+"/"+n)})),o=e.match(/src=".+?"/g),o&&(o=o.filter(function(e){return-1===e.indexOf("//")}),o=o.filter(function(e){return-1===e.indexOf("{")}),o.forEach(function(o){var n=o.split('"')[1];e=e.replace(n,F+"/"+n)})),o=e.match(/"dojo\/text!.+?"/g),o&&(o=o.filter(function(e){return-1===e.indexOf("//")}),o.forEach(function(o){var n=o.split('"')[1];e=e.replace(n,"dojo/text!"+F+"/brightest.txt")})),/layers-scenelayerview-query/.test(F)){var n=/<img[^>]*>/im,t=new RegExp(F+"/");if(n.test(e)){var c=e.match(n)[0],a=c.replace(t,"");e=e.replace(n,a)}}return e}function z(e,o){return e=Math.ceil(e),o=Math.floor(o),Math.floor(Math.random()*(o-e+1))+e}function E(e){Q&&console&&console.log&&console.log(Array.prototype.slice.call(arguments))}var O,k,q,F,T,_,K,H,M,L,A,R,I,V,D,U,B,W,P,X,J,G,N,$,Q=!1,Y=14.11,Z=18,ee={mac:[{command:"<code>Cmd</code> + <code>Enter</code>",description:"Refresh Output"},{command:"<code>Cmd</code> + <code>/</code>",description:"Comment lines / Uncomment lines"},{command:"<code>Cmd</code> + <code>Shift</code> + <code>L</code>",description:"Beautify sandbox code"},{command:"<code>Cmd</code> + <code>1</code>",description:"Toggle HTML"},{command:"<code>Cmd</code> + <code>2</code>",description:"Toggle Output"},{command:"<code>Cmd</code> + <code>K</code>",description:"Toggle vim, <code>:w</code> Refresh Output"},{command:"<code>Cmd</code> + <code>Shift</code> + <code>></code>",description:"Increase sandbox code font size"},{command:"<code>Cmd</code> + <code>Shift</code> + <code><</code>",description:"Decrease sandbox code font size"},{command:"<code>Cmd</code> + <code>0</code>",description:"Reset sandbox code font size"}],win:[{command:"<code>Ctrl</code> + <code>Enter</code>",description:"Refresh Output"},{command:"<code>Ctrl</code> + <code>/</code>",description:"Comment lines / Uncomment lines"},{command:"<code>Ctrl</code> + <code>Shift</code> + <code>L</code>",description:"Beautify sandbox code"},{command:"<code>Ctrl</code> + <code>1</code>",description:"Toggle HTML"},{command:"<code>Ctrl</code> + <code>2</code>",description:"Toggle Output"},{command:"<code>Ctrl</code> + <code>K</code>",description:"Toggle vim, <code>:w</code> Refresh Output"},{command:"<code>Ctrl</code> + <code>Shift</code> + <code>></code>",description:"Increase sandbox code font size"},{command:"<code>Ctrl</code> + <code>Shift</code> + <code><</code>",description:"Decrease sandbox code font size"},{command:"<code>Ctrl</code> + <code>0</code>",description:"Reset sandbox code font size"}]};r.request.corsEnabledServers.push("https://developers.arcgis.com/javascript/samples"),function(){E("setSampleFolder");var e=m.urlToObject(document.location.href);e.query=e.query||{};var o=document.location.pathname.replace("sample-code/sandbox/index.html","");e.query&&e.query.sample?(q=e.query.sample,document.title="Sandbox: "+q,F=document.location.protocol+"//"+document.location.host+o+"sample-code/"+e.query.sample+"/live"):F=o+"sample-code/get-started-mapview/live"}(),function(){E("startEditor"),ace.config.set("workerPath","../../assets/js/libs/ace");var e=s(".js-sandbox-editor")[0];O=ace.edit(e),O.$blockScrolling=1/0,O.setPrintMarginColumn(0),O.setTheme("ace/theme/github"),O.getSession().setTabSize(2),O.getSession().setUseSoftTabs(!0),O.getSession().setMode("ace/mode/html"),O.setOption("wrap",!0),_=Y,localStorage&&(localStorage.sandboxFontSize?localStorage.sandboxFontSize&&(_=parseInt(localStorage.sandboxFontSize),O.setFontSize(_)):localStorage.sandboxFontSize=_);var o={current:"ace",ace:null,vim:void 0};ace.config.loadModule("ace/keyboard/vim",function(e){o.vim=e.handler,e.CodeMirror.Vim.defineEx("write","w",function(e,o){e.ace.execCommand("sandboxSaveCommand")})}),O.commands.addCommand({name:"sandboxSaveCommand",bindKey:{win:"Ctrl-Enter",mac:"Command-Enter"},exec:function(e){C()}}),O.commands.addCommand({name:"sandboxKeybindingCommand",bindKey:{win:"Ctrl-K",mac:"Command-K"},exec:function(e){"ace"===o.current?(e.setKeyboardHandler(o.vim),o.current="vim"):(e.setKeyboardHandler(o.ace),o.current="ace")}}),O.commands.addCommand({name:"sandboxCommentLinesCommand",bindKey:{win:"Ctrl-/",mac:"Command-/"},exec:function(e){e.toggleCommentLines()}}),O.commands.addCommand({name:"sandboxBeautifyCommand",bindKey:{win:"Ctrl-Shift-L",mac:"Command-Shift-L"},exec:function(e){v()}}),O.commands.addCommand({name:"sandboxToogleHTMLCommand",bindKey:{win:"Ctrl-1",mac:"Command-1"},exec:function(e){u()}}),O.commands.addCommand({name:"sandboxToogleOutputCommand",bindKey:{win:"Ctrl-2",mac:"Command-2"},exec:function(e){f()}}),O.commands.addCommand({name:"sandboxIncreaseFontCommand",bindKey:{win:"Ctrl-Shift-.",mac:"Command-Shift-."},exec:function(e){"use strict";_++,e.setFontSize(_),localStorage.sandboxFontSize=_,_>Z&&""===document.querySelector(".js-sandbox-editor").style.lineHeight&&(document.querySelector(".js-sandbox-editor").style.lineHeight=1.4)}}),O.commands.addCommand({name:"sandboxDecreaseFontCommand",bindKey:{win:"Ctrl-Shift-,",mac:"Command-Shift-,"},exec:function(e){"use strict";_--,e.setFontSize(_),localStorage.sandboxFontSize=_,_<Z&&""!==document.querySelector(".js-sandbox-editor").style.lineHeight&&(document.querySelector(".js-sandbox-editor").style.lineHeight="")}}),O.commands.addCommand({name:"sandboxResetFontCommand",bindKey:{win:"Ctrl-0",mac:"Command-0"},exec:function(e){"use strict";e.setFontSize(Y),_=Y,localStorage&&delete localStorage.sandboxFontSize,document.querySelector(".js-sandbox-editor").style.lineHeight="",document.querySelector(".js-sandbox-editor").style.fontSize=""}})}(),function(){E("bindEventHandlers"),I=s(".js-btn-html"),V=s(".js-btn-output"),R=s(".js-btn-sample-description"),A=s(".js-btn-save-file"),L=s(".js-btn-open-in-jsbin"),D=s(".js-btn-refresh"),N=s(".js-sandbox-container"),M=s(".js-sandbox-handle"),J=s(".js-sandbox-output"),$=s(".js-loader"),I.on("click",u),V.on("click",f),R.on("click",p),A.on("click",g),L.on("click",b),D.on("click",C),U=s(".js-btn-sandbox-keyboard-shortcuts"),U.on("click",S),X=s(".js-sandbox-keyboard-shortcuts-modal-close"),X.on("click",function(){W.style("display","none")}),B=s(".js-sandbox-keyboard-shortcut-container"),W=s(".js-sandbox-keyboard-shortcuts-modal"),P=s(".js-sandbox-keyboard-shortcuts-modal-content tbody"),M.on("mousedown",h),R.attr("data-sample-description-url","../../sample-code/"+q+"/index.html"),d(window,"resize",x)}(),function(){function e(e){E("handleSample");var o=e.data;O.getSession().setValue(o),R.toggleClass("btn-disabled"),A.removeClass("btn-disabled"),L.removeClass("btn-disabled"),C()}function o(e){console&&console.log&&console.log("error getting code sample: ",e)}E("fetchSandboxSampleCode"),l(F+"/index.html",{responseType:"text"}).then(e,o)}(),function(){k=document.documentElement.getAttribute("data-platform"),K=/mac/i.test(k)?ee.mac:ee.win,H=z(0,K.length-1);var e=K[H];B[0].innerHTML="<span class='command'>"+e.command+'</span><span class="action">'+e.description+"</span>"}()});