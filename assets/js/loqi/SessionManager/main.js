/*! ArcGIS API for JavaScript 4.4 | Copyright (c) 2017 Esri. All rights reserved. | http://www.esri.com/legal/privacy | https://developers.arcgis.com/terms/faq */
define(["dojo/_base/declare","dojo/_base/lang","dojo/cookie","dojo/topic","dojo/query","dojo/dom-construct","Notifications","esri/config","esri/request","esri/core/urlUtils"],function(r,e,i,o,t,n,s,a,u,c){var l=/^(https?:\/\/(arcgis.com|esri.com|.+.arcgis.com|.+.esri.com)|\/)/;a.request.proxyUrl="/proxy",a.request.corsEnabledServers.push(SiteConfig.billing),a.request.corsEnabledServers.push(SiteConfig.download_server),a.request.corsEnabledServers.push("https://geotriggerstg.arcgis.com"),a.request.corsEnabledServers.push("https://geotriggerdev.arcgis.com"),a.request.corsEnabledServers.push("https://geotrigger.arcgis.com"),a.request.corsEnabledServers.push("https://portalette.geotrigger.arcgis.com"),a.request.corsEnabledServers.push("https://portalettestg.geotrigger.arcgis.com");var h=r([],{constructor:function(r){e.mixin(this,r)},_callbacks:[],ready:!1,get_gravatar:function(r,e){var e=e||80;return"//www.gravatar.com/avatar/"+function(r){function e(r,e){return r<<e|r>>>32-e}function i(r,e){var i,o,t,n,s;return t=2147483648&r,n=2147483648&e,i=1073741824&r,o=1073741824&e,s=(1073741823&r)+(1073741823&e),i&o?2147483648^s^t^n:i|o?1073741824&s?3221225472^s^t^n:1073741824^s^t^n:s^t^n}function o(r,e,i){return r&e|~r&i}function t(r,e,i){return r&i|e&~i}function n(r,e,i){return r^e^i}function s(r,e,i){return e^(r|~i)}function a(r,t,n,s,a,u,c){return r=i(r,i(i(o(t,n,s),a),c)),i(e(r,u),t)}function u(r,o,n,s,a,u,c){return r=i(r,i(i(t(o,n,s),a),c)),i(e(r,u),o)}function c(r,o,t,s,a,u,c){return r=i(r,i(i(n(o,t,s),a),c)),i(e(r,u),o)}function l(r,o,t,n,a,u,c){return r=i(r,i(i(s(o,t,n),a),c)),i(e(r,u),o)}function h(r){var e,i,o="",t="";for(i=0;i<=3;i++)e=r>>>8*i&255,t="0"+e.toString(16),o+=t.substr(t.length-2,2);return o}var f,p,g,d,S,m,v,b,I,w=Array();for(r=function(r){r=r.replace(/rn/g,"n");for(var e="",i=0;i<r.length;i++){var o=r.charCodeAt(i);o<128?e+=String.fromCharCode(o):o>127&&o<2048?(e+=String.fromCharCode(o>>6|192),e+=String.fromCharCode(63&o|128)):(e+=String.fromCharCode(o>>12|224),e+=String.fromCharCode(o>>6&63|128),e+=String.fromCharCode(63&o|128))}return e}(r),w=function(r){for(var e,i=r.length,o=i+8,t=(o-o%64)/64,n=16*(t+1),s=Array(n-1),a=0,u=0;u<i;)e=(u-u%4)/4,a=u%4*8,s[e]=s[e]|r.charCodeAt(u)<<a,u++;return e=(u-u%4)/4,a=u%4*8,s[e]=s[e]|128<<a,s[n-2]=i<<3,s[n-1]=i>>>29,s}(r),m=1732584193,v=4023233417,b=2562383102,I=271733878,f=0;f<w.length;f+=16)p=m,g=v,d=b,S=I,m=a(m,v,b,I,w[f+0],7,3614090360),I=a(I,m,v,b,w[f+1],12,3905402710),b=a(b,I,m,v,w[f+2],17,606105819),v=a(v,b,I,m,w[f+3],22,3250441966),m=a(m,v,b,I,w[f+4],7,4118548399),I=a(I,m,v,b,w[f+5],12,1200080426),b=a(b,I,m,v,w[f+6],17,2821735955),v=a(v,b,I,m,w[f+7],22,4249261313),m=a(m,v,b,I,w[f+8],7,1770035416),I=a(I,m,v,b,w[f+9],12,2336552879),b=a(b,I,m,v,w[f+10],17,4294925233),v=a(v,b,I,m,w[f+11],22,2304563134),m=a(m,v,b,I,w[f+12],7,1804603682),I=a(I,m,v,b,w[f+13],12,4254626195),b=a(b,I,m,v,w[f+14],17,2792965006),v=a(v,b,I,m,w[f+15],22,1236535329),m=u(m,v,b,I,w[f+1],5,4129170786),I=u(I,m,v,b,w[f+6],9,3225465664),b=u(b,I,m,v,w[f+11],14,643717713),v=u(v,b,I,m,w[f+0],20,3921069994),m=u(m,v,b,I,w[f+5],5,3593408605),I=u(I,m,v,b,w[f+10],9,38016083),b=u(b,I,m,v,w[f+15],14,3634488961),v=u(v,b,I,m,w[f+4],20,3889429448),m=u(m,v,b,I,w[f+9],5,568446438),I=u(I,m,v,b,w[f+14],9,3275163606),b=u(b,I,m,v,w[f+3],14,4107603335),v=u(v,b,I,m,w[f+8],20,1163531501),m=u(m,v,b,I,w[f+13],5,2850285829),I=u(I,m,v,b,w[f+2],9,4243563512),b=u(b,I,m,v,w[f+7],14,1735328473),v=u(v,b,I,m,w[f+12],20,2368359562),m=c(m,v,b,I,w[f+5],4,4294588738),I=c(I,m,v,b,w[f+8],11,2272392833),b=c(b,I,m,v,w[f+11],16,1839030562),v=c(v,b,I,m,w[f+14],23,4259657740),m=c(m,v,b,I,w[f+1],4,2763975236),I=c(I,m,v,b,w[f+4],11,1272893353),b=c(b,I,m,v,w[f+7],16,4139469664),v=c(v,b,I,m,w[f+10],23,3200236656),m=c(m,v,b,I,w[f+13],4,681279174),I=c(I,m,v,b,w[f+0],11,3936430074),b=c(b,I,m,v,w[f+3],16,3572445317),v=c(v,b,I,m,w[f+6],23,76029189),m=c(m,v,b,I,w[f+9],4,3654602809),I=c(I,m,v,b,w[f+12],11,3873151461),b=c(b,I,m,v,w[f+15],16,530742520),v=c(v,b,I,m,w[f+2],23,3299628645),m=l(m,v,b,I,w[f+0],6,4096336452),I=l(I,m,v,b,w[f+7],10,1126891415),b=l(b,I,m,v,w[f+14],15,2878612391),v=l(v,b,I,m,w[f+5],21,4237533241),m=l(m,v,b,I,w[f+12],6,1700485571),I=l(I,m,v,b,w[f+3],10,2399980690),b=l(b,I,m,v,w[f+10],15,4293915773),v=l(v,b,I,m,w[f+1],21,2240044497),m=l(m,v,b,I,w[f+8],6,1873313359),I=l(I,m,v,b,w[f+15],10,4264355552),b=l(b,I,m,v,w[f+6],15,2734768916),v=l(v,b,I,m,w[f+13],21,1309151649),m=l(m,v,b,I,w[f+4],6,4149444226),I=l(I,m,v,b,w[f+11],10,3174756917),b=l(b,I,m,v,w[f+2],15,718787259),v=l(v,b,I,m,w[f+9],21,3951481745),m=i(m,p),v=i(v,g),b=i(b,d),I=i(I,S);return(h(m)+h(v)+h(b)+h(I)).toLowerCase()}(r)+".jpg?s="+e},redirect:function(r,e){l.test(r)||(r="http://developers.arcgis.com"),e&&(e=dojo.objectToQuery(e)),window.location=r+(e?"?"+e:"")},queue:function(r){this.ready?r():this._callbacks.push(r)},avatar:function(r){return this.profile.thumbnail?"https://"+SiteConfig.ago+"/sharing/rest/community/users/"+this.username()+"/info/"+this.profile.thumbnail+"?token="+this.token():this.get_gravatar(this.profile.email,r||18)+"&d=mm"},loggedIn:function(){return!!this.token()},displayName:function(){return this.profile?profile.fullName||this.username()||profile.email||"Your Account":this.username()},orgId:function(){return this.organization?this.organization.id:i("esri_auth")?JSON.parse(i("esri_auth")).accountId:void 0},orgUrlKey:function(){return this.organization?this.organization.urlKey:i("esri_auth")?JSON.parse(i("esri_auth")).urlKey:void 0},orgUrl:function(){if(this.organization){return(this.organization.allSSL?"https://":"http://")+this.orgUrlKey()+SiteConfig.ago_maps}},token:function(){return!!i("esri_auth")&&JSON.parse(i("esri_auth")).token},role:function(){var r=JSON.parse(i("esri_auth"));return!!r&&(!!r.role&&r.role.replace("org_","").replace("account_",""))},isAdmin:function(){return"admin"===this.role()},username:function(){return this.profile?this.profile.username:i("esri_auth")?JSON.parse(i("esri_auth")).email:void 0},userId:function(){return this.username()},requireSession:function(){this.loggedIn()||this.redirect("/sign-in",{redirect_uri:window.encodeURIComponent(window.location.href)})},logout:function(){redirect("https://www.arcgis.com/sharing/rest/oauth2/signout",{redirect_uri:SiteConfig.destination})},developerSubscription:function(){if(this.organization&&this.organization.subscriptionInfo&&("Trial Developer"===this.organization.subscriptionInfo.type||"Developer"===this.organization.subscriptionInfo.type))return!0},developer:function(){return this.developerSubscription()},trial:function(){if(this.organization&&this.organization.subscriptionInfo.type.match(/Trial/))return!0},expired:function(){if(this.organization&&this.organization.subscriptionInfo&&"expired"===this.organization.subscriptionInfo.state)return!0},suspended:function(){if(this.organization&&this.organization.subscriptionInfo&&"suspended"===this.organization.subscriptionInfo.state)return!0},firstName:function(){return this.profile.fullName.split(/ |\.|_/)[0]},finishSignin:function(r){var e=this.isPublicAccount()?"/public-account/":"/applications/",i=c.urlToObject(window.location.href).query,o=i&&i.redirect_uri?i.redirect_uri:e;this.redirect(o)},isPublicAccount:function(){return!!i("esri_auth")&&!JSON.parse(i("esri_auth")).role}});window.ArcGIS=window.ArcGIS||{},window.ArcGIS.Session=new h;var f=i("esri_auth");return(f?JSON.parse(f):void 0)&&!window.ArcGIS.shouldExpireSession&&(u(SiteConfig.portal+"/rest/portals/self",{query:{token:ArcGIS.Session.token(),f:"json"}}).then(function(r){ArcGIS.Session.profile=r.user,ArcGIS.Session.organization=r,o.publish("session:organization"),u({url:SiteConfig.billing+"/subscription",content:{token:ArcGIS.Session.token(),f:"json"}}).then(function(r){ArcGIS.Session.subscription=r.subscription,ArcGIS.Session.ready=!0;for(var e=ArcGIS.Session._callbacks.length-1;e>=0;e--)ArcGIS.Session._callbacks[e]();o.publish("session:ready")},function(r){ArcGIS.Session.logout(),document.location.reload(!0)})},function(r){ArcGIS.Session.logout(),document.location.reload(!0)}),ArcGIS.Session.queue(function(){var r=ArcGIS.Session.expired()||ArcGIS.Session.suspended();if(t("#account-alerts").length&&r){var e=new s(t("#account-notifications")[0]),i=ArcGIS.Session.developer()&&ArcGIS.Session.expired(),o=ArcGIS.Session.developer()&&ArcGIS.Session.suspended(),n=!ArcGIS.Session.developer();if(i&&e.error("It looks like your account has expired. You won't be able to create new applications or feature services until you <a href='/account/modify-plan/'>renew your account</a>."),o&&e.error("Looks like you went over your credit limit for this month. You won't be able to create new applications or feature services. You can either <a href='/account/modify-plan/'>upgrade to a larger plan</a> or wait until next month."),n){var a=" <a href='"+ArcGIS.Session.orgUrl()+"/home/organization.html'>Upgrade Subscription</a>";e.error("Your subscription has been suspended or has expired."+a)}}})),window.ArcGIS.Session});