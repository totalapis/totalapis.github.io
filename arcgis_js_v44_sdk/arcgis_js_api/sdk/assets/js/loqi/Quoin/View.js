/*! ArcGIS API for JavaScript 4.4 | Copyright (c) 2017 Esri. All rights reserved. | http://www.esri.com/legal/privacy | https://developers.arcgis.com/terms/faq */
define(["dojo/_base/declare","dijit/_WidgetBase","Quoin/Handlebars","Quoin/HandlebarsTemplated","Quoin/Model","dojo/query","dojo/_base/event","dojo/_base/lang","dojo/_base/array","dojox/lang/functional/object","dojo/on","dojo/dom-style","dojo/topic","dojo/dom-construct","dojo/NodeList-dom"],function(t,i,e,n,s,o,h,r,c,d,a,u,l,f){function g(t){return t.replace(/</g,"&lt;").replace(/>/g,"&gt;")}return e.registerHelper("get",function(t,i){if(t.model&&t.model.get(i)){var e=t.model.get(i);return"string"==typeof e?g(e):e}return""}),e.registerHelper("log",function(t){console.log("Handlebars Log :",t)}),e.registerHelper("node",function(t){return"data-dojo-attach-point="+t}),t("Quoin.View",[i,n],{_bindings:{},_watches:[],constructor:function(t){t&&t.model||(this.model=new s({}))},postCreate:function(){this._createEvents(),this._createBindings(),this.inherited(arguments)},destroy:function(){this._removeWatches(),this.inherited(arguments)},use:function(t){return this._removeWatches(),this.model=t,t&&(this._createBindings(),this._runBindings()),this},render:function(t,i,e){return e&&(this.destroyRendering(),this._rendered=!1,this.buildRendering(),this._createEvents(),this._createBindings(),this._runBindings()),f.place(this.domNode,t,i),this},_createEvents:function(){d.forIn(this.events,r.hitch(this,function(t,i){var e=i.split(" "),n=e.splice(-1,1)[0],s=e.join(" "),c=o(s,this.domNode),d=r.hitch(this,function(i){h.stop(i),r.hitch(this,this[t])(i)});c.length?this.own(a(c,n,d)):this.own(a(this.domNode,s+":"+n,d))}))},_runBindings:function(){d.forIn(this.bindings,r.hitch(this,function(t,i){var e,n;if(r.isObject(t)&&(e=t.callback,n=t.element),(r.isFunction(t)||e)&&(e?r.hitch(this,e||t):r.hitch(this,t))(this.model.get(i)),r.isString(t)||n){var s=n?n.split(" "):t.split(" "),h=s.splice(-1,1)[0],c=s.join(" ");o(c,this.domNode).attr(h,this.model.get(i))}}))},_removeWatches:function(){c.forEach(this._watches,function(t){t.unwatch()})},_createBindings:function(){d.forIn(this.bindings,r.hitch(this,function(t,i){var e,n,s,h;if(r.isObject(t)&&(s=t.callback,h=t.element),(r.isFunction(t)||s)&&(e=s?r.hitch(this,s):r.hitch(this,t)),r.isString(t)||h){var c=h?h.split(" "):t.split(" "),d=c.splice(-1,1)[0],a=c.join(" ");n=r.hitch(this,function(t){o(a,this.domNode).attr(d,t)})}var u=this.model.watch(i,r.hitch(this,function(t,i,s){n&&n(s),e&&e(s)}));this._watches.push(u)}))},subscribe:function(t,i){return this.own(l.subscribe(t,r.hitch(this,i)))},publish:function(){var t=Array.prototype.slice.call(arguments);l.publish.apply(this,t)}})});