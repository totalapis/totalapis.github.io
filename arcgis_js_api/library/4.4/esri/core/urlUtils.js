// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.4/esri/copyright.txt for details.
//>>built
define("require exports dojo/_base/window dojo/_base/lang dojo/_base/url dojo/io-query ../config ./lang ./sniff ./Logger ./Error".split(" "),function(A,e,S,T,h,r,B,U,C,V,W){function t(a){var b={path:null,query:null},c=new h(a),d=a.indexOf("?");null===c.query?b.path=a:(b.path=a.substring(0,d),b.query=r.queryToObject(c.query));c.fragment&&(b.hash=c.fragment,null===c.query&&(b.path=b.path.substring(0,b.path.length-(c.fragment.length+1))));return b}function D(a,b){void 0===a&&(a=!1);void 0===b&&(b=!0);
var c,d=l.proxyUrl;if("string"===typeof a){if(c=E(a),a=u(a))d=a.proxyUrl}else c=!!a;if(!d)throw X.warn("esri/config: esriConfig.request.proxyUrl is not set. If making a request to a CORS-enabled\n server, please push the domain into esriConfig.request.corsEnabledServers."),new W("urlutils:proxy-not-set","esri/config: esriConfig.request.proxyUrl is not set. If making a request to a CORS-enabled\n server, please push the domain into esriConfig.request.corsEnabledServers.");var g;c&&b&&"https"===e.appUrl.scheme&&
(b=F(d),v(b)&&(d=b,g=1));d=t(d);d._xo=g;return d}function G(a){var b=a.indexOf("?");-1!==b?(m.path=a.slice(0,b),m.query=a.slice(b+1)):(m.path=a,m.query=null);return m}function H(a){a=G(a).path;a&&"/"===a[a.length-1]||(a+="/");a=w(a,!0);return a=a.toLowerCase()}function u(a){var b=l.proxyRules;a=H(a);for(var c=0;c<b.length;c++)if(0===a.indexOf(b[c].urlPrefix))return b[c]}function I(a){a=n(a);var b=a.indexOf("/sharing");return 0<b?a.substring(0,b):a.replace(/\/+$/,"")}function x(a,b,c){void 0===c&&
(c=!1);a=y(a);b=y(b);return c||a.scheme===b.scheme?a.host.toLowerCase()===b.host.toLowerCase()&&a.port===b.port:!1}function v(a){return C("esri-phonegap")?!0:C("esri-cors")?null!=J(a):!1}function J(a,b){void 0===b&&(b=!1);"string"===typeof a&&(a=p(a)?y(a):e.appUrl);for(var c=l.corsEnabledServers||[],d=0;d<c.length;d++)for(var g=c[d],z=void 0,z="string"===typeof g?K(g):g.host?K(g.host):[],f=0;f<z.length;f++)if(x(a,z[f]))return b?d:g;return b?-1:null}function K(a){e.corsServersUrlCache[a]||(q(a)||f(a)?
e.corsServersUrlCache[a]=[new h(k(a))]:e.corsServersUrlCache[a]=[new h("http://"+a),new h("https://"+a)]);return e.corsServersUrlCache[a]}function k(a,b,c){void 0===b&&(b=e.appBaseUrl);if(f(a))return c&&c.preserveProtocolRelative?a:"http"===e.appUrl.scheme&&e.appUrl.authority===L(a).slice(2)?"http:"+a:"https:"+a;if(q(a))return a;c=M;if("/"===a[0]){var d=b.indexOf("//"),d=b.indexOf("/",d+2);b=-1===d?b:b.slice(0,d)}return c(b,a)}function N(a,b,c){void 0===b&&(b=e.appBaseUrl);if(!p(a))return a;var d=
n(a),g=d.toLowerCase();b=n(b).toLowerCase().replace(/\/+$/,"");if((c=c?n(c).toLowerCase().replace(/\/+$/,""):null)&&0!==b.indexOf(c))return a;for(var f=function(a,b,c){c=a.indexOf(b,c);return-1===c?a.length:c},h=f(g,"/",g.indexOf("//")+2),k=-1;g.slice(0,h+1)===b.slice(0,h)+"/";){k=h+1;if(h===g.length)break;h=f(g,"/",h+1)}if(-1===k||c&&k<c.length)return a;a=d.slice(k);d=b.slice(k-1).replace(/[^/]+/g,"").length;if(0<d)for(g=0;g<d;g++)a="../"+a;else a="./"+a;return a}function n(a){a=a.trim();a=k(a);
a="http"===e.appUrl.scheme&&E(a)&&x(e.appBaseUrl,a,!0)&&!v(a)?f(a)?"http:"+a:a.replace(O,"http:"):a;a=Y(a);return a=a.replace(/^(https?:\/\/)(arcgis\.com)/i,"$1www.$2")}function M(){for(var a=[],b=0;b<arguments.length;b++)a[b]=arguments[b];if(a&&a.length){b=[];if(p(a[0])){var c=a[0],d=c.indexOf("//");b.push(c.slice(0,d+1));Z.test(a[0])&&(b[0]+="/");a[0]=c.slice(d+2)}else"/"===a[0][0]&&b.push("");a=a.reduce(function(a,b){return a.concat(b.split("/"))},[]);for(c=0;c<a.length;c++)d=a[c],".."===d&&0<
b.length?b.pop():!d||"."===d&&0!==b.length||b.push(d);return b.join("/")}}function L(a){if(P(a))return null;var b=a.indexOf("://");if(-1===b&&f(a))b=2;else if(-1!==b)b+=3;else return null;b=a.indexOf("/",b);return-1===b?a:a.slice(0,b)}function p(a){return f(a)||q(a)}function P(a){return"data:"===a.slice(0,5)}function f(a){return a&&"/"===a[0]&&"/"===a[1]}function q(a){return Q.test(a)}function E(a){return O.test(a)||"https"===e.appUrl.scheme&&f(a)}function aa(a){return R.test(a)||"http"===e.appUrl.scheme&&
f(a)}function F(a){return f(a)?"https:"+a:a.replace(R,"https:")}function w(a,b){void 0===b&&(b=!1);if(f(a))return a.slice(2);a=a.replace(Q,"");b&&1<a.length&&"/"===a[0]&&"/"===a[1]&&(a=a.slice(2));return a}function Y(a){var b=B.request.httpsDomains;if(!aa(a))return a;var c=a.indexOf("/",7),d;d=-1===c?a:a.slice(0,c);d=d.toLowerCase().slice(7);if("http"===e.appUrl.scheme&&d===e.appUrl.authority)return a;if("https"===e.appUrl.scheme&&d===e.appUrl.authority||b&&b.some(function(a){return d===a||U.endsWith(d,
"."+a)}))a=F(a);return a}function y(a){if("string"===typeof a)return new h(k(a));a.scheme||(a.scheme=e.appUrl.scheme);return a}Object.defineProperty(e,"__esModule",{value:!0});A=S.global;var X=V.getLogger("esri.core.urlUtils"),l=B.request,Q=/^\s*[a-z][a-z0-9-+.]*:(?![0-9])/i,R=/^\s*http:/i,O=/^\s*https:/i,Z=/^\s*file:/i;e.appUrl=new h(A.location);e.corsServersUrlCache={};e.appBaseUrl=function(){var a=e.appUrl.path,a=a.substring(0,a.lastIndexOf(a.split("/")[a.split("/").length-1]));return""+(e.appUrl.scheme+
"://"+e.appUrl.host+(null!=e.appUrl.port?":"+e.appUrl.port:""))+a}();e.urlToObject=t;e.getProxyUrl=D;e.addProxy=function(a){var b=u(a),c,d;b?(d=G(b.proxyUrl),c=d.path,d=d.query?r.queryToObject(d.query):null):l.forceProxy&&(d=D(),c=d.path,d=d.query);c&&(b=t(a),a=c+"?"+b.path,(c=r.objectToQuery(T.mixin(d||{},b.query)))&&(a=a+"?"+c));return a};var m={path:"",query:""};e.addProxyRule=function(a){a={proxyUrl:a.proxyUrl,urlPrefix:H(a.urlPrefix)};for(var b=l.proxyRules,c=a.urlPrefix,d=b.length,e=0;e<b.length;e++){var f=
b[e].urlPrefix;if(0===c.indexOf(f)){if(c.length===f.length)return-1;d=e;break}0===f.indexOf(c)&&(d=e+1)}b.splice(d,0,a);return d};e.getProxyRule=u;e.hasSamePortal=function(a,b){a=I(a);b=I(b);return w(a)===w(b)};e.hasSameOrigin=x;e.canUseXhr=v;e.getCorsConfig=J;e.makeAbsolute=k;e.makeRelative=N;e.normalize=n;e.join=M;e.getOrigin=L;e.isAbsolute=p;e.isDataProtocol=P;var ba=/^data:(.*?)(;base64)?,(.*)$/;e.dataComponents=function(a){return(a=a.match(ba))?{mediaType:a[1],isBase64:!!a[2],data:a[3]}:null};
e.makeData=function(a){return a.isBase64?"data:"+a.mediaType+";base64,"+a.data:"data:"+a.mediaType+","+a.data};e.isProtocolRelative=f;e.hasProtocol=q;e.read=function(a,b){b=b&&b.url&&b.url.path;return a&&b?k(a,b,{preserveProtocolRelative:!0}):a};e.write=function(a,b){if(!a)return a;!p(a)&&b&&b.blockedRelativeUrls&&b.blockedRelativeUrls.push(a);var c=k(a);if(b){var d=b.verifyItemRelativeUrls&&b.verifyItemRelativeUrls.rootPath||b.url&&b.url.path;d&&(c=N(c,d,d),c!==a&&b.verifyItemRelativeUrls&&b.verifyItemRelativeUrls.writtenUrls.push(c))}return c};
e.isSVG=function(a){return ca.test(a)};var ca=/(^data:image\/svg|\.svg$)/i});