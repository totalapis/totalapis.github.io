// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.4/esri/copyright.txt for details.
//>>built
define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper dojo/_base/lang ../../core/JSONSupport ../../core/kebabDictionary ../../core/lang ../../core/accessorSupport/decorators ../../geometry/SpatialReference ../../geometry/Point ../../geometry/support/spatialReferenceUtils ../../geometry/support/webMercatorUtils ../../geometry/support/scaleUtils ./LOD".split(" "),function(b,A,q,g,r,t,u,v,f,m,h,w,x,y,z){var n=u({PNG:"png",PNG8:"png8",PNG24:"png24",PNG32:"png32",
JPEG:"jpg",JPG:"jpg",DIB:"dib",TIFF:"tiff",EMF:"emf",PS:"ps",PDF:"pdf",GIF:"gif",SVG:"svg",SVGZ:"svgz",Mixed:"mixed",MIXED:"mixed",LERC:"lerc"});b=k=function(b){function d(a){a=b.call(this)||this;a.dpi=96;a.format=null;a.origin=null;a.minScale=0;a.maxScale=0;a.size=null;a.spatialReference=null;return a}q(d,b);d.create=function(a){void 0===a&&(a={size:256,spatialReference:m.WebMercator});var c=a.scales,p=a.size||256;a=a.spatialReference||m.WebMercator;var e=w.getInfo(a),e=e?new h(e.origin[0],e.origin[1],
a):new h(0,0,a),d=1/(39.37*y.getUnitValueForSR(a)*96),l=[];if(c)for(var b=0;b<c.length;b++){var f=c[b],g=f*d;l.push({level:b,scale:f,resolution:g})}else for(c=256/p*5.91657527591555E8,l.push({level:0,scale:c,resolution:c*d}),b=1;24>b;b++)f=c/2,g=f*d,l.push({level:b,scale:f,resolution:g}),c=f;return new k({dpi:96,lods:l,origin:e,size:p,spatialReference:a})};Object.defineProperty(d.prototype,"lods",{set:function(a){var c=this,b=0,e=0,d=[];this._levelToLOD={};a&&(b=-Infinity,e=Infinity,a.forEach(function(a){d.push(a.scale);
b=a.scale>b?a.scale:b;e=a.scale<e?a.scale:e;c._levelToLOD[a.level]=a}));this._set("scales",d);this._set("minScale",b);this._set("maxScale",e);this._set("lods",a);this._initializeUpsampleLevels()},enumerable:!0,configurable:!0});d.prototype.zoomToScale=function(a){var c=this.scales;if(0>=a)return c[0];if(a>=c.length)return c[c.length-1];var b=Math.round(a);return c[b]+(b-a)*(c[Math.round(a-.5)]-c[b])};d.prototype.scaleToZoom=function(a){for(var c=this.scales,b=c.length-1,e=0;e<b;e++){var d=c[e],f=
c[e+1];if(d<=a)break;if(f===a)return e+1;if(d>a&&f<a)return e+1-(a-f)/(d-f)}return e};d.prototype.snapScale=function(a,c){void 0===c&&(c=.95);a=this.scaleToZoom(a);return a%Math.floor(a)>=c?this.zoomToScale(Math.ceil(a)):this.zoomToScale(Math.floor(a))};d.prototype.tileAt=function(a,c,b,e){var d=this.lodAt(a);if(!d)return null;e||(e={id:null,level:0,row:0,col:0,extent:[0,0,0,0]});var f;if("number"===typeof c)f=c,c=b;else{if(c.spatialReference.equals(this.spatialReference))f=c.x,c=c.y;else{e=x.project(c,
this.spatialReference);if(!e)return null;f=e.x;c=e.y}e=b}b=d.resolution*this.size[0];d=d.resolution*this.size[1];e.level=a;e.row=Math.floor((this.origin.y-c)/d+.001);e.col=Math.floor((f-this.origin.x)/b+.001);this.updateTileInfo(e);return e};d.prototype.updateTileInfo=function(a){var c=this.lodAt(a.level),b=c.resolution*this.size[0],c=c.resolution*this.size[1];a.id=a.level+"/"+a.row+"/"+a.col;a.extent||(a.extent=[0,0,0,0]);a.extent[0]=this.origin.x+a.col*b;a.extent[1]=this.origin.y-(a.row+1)*c;a.extent[2]=
a.extent[0]+b;a.extent[3]=a.extent[1]+c};d.prototype.upsampleTile=function(a){var c=this._upsampleLevels[a.level];if(!c||-1===c.parentLevel)return!1;a.level=c.parentLevel;a.row=Math.floor(a.row/c.factor+.001);a.col=Math.floor(a.col/c.factor+.001);this.updateTileInfo(a);return!0};d.prototype.lodAt=function(a){return this._levelToLOD&&this._levelToLOD[a]||null};d.prototype.clone=function(){return k.fromJSON(this.toJSON())};d.prototype.toJSON=function(){return v.fixJson({rows:this.size[0],cols:this.size[1],
dpi:this.dpi,format:n.toJSON(this.format),compressionQuality:this.compressionQuality,origin:this.origin&&this.origin.toJSON(),spatialReference:this.spatialReference&&this.spatialReference.toJSON(),lods:this.lods&&this.lods.map(function(a){return a.toJSON()})})};d.prototype._initializeUpsampleLevels=function(){var a=this.lods;this._upsampleLevels=[];for(var c=null,b=0;b<a.length;b++){var d=a[b];this._upsampleLevels[d.level]={parentLevel:c?c.level:-1,factor:c?c.resolution/d.resolution:0};c=d}};return d}(f.declared(t));
g([f.property()],b.prototype,"compressionQuality",void 0);g([f.property()],b.prototype,"dpi",void 0);g([f.property({json:{read:n.fromJSON}})],b.prototype,"format",void 0);g([f.property({type:h,json:{read:function(b,d){return h.fromJSON(r.mixin({spatialReference:d.spatialReference},b))}}})],b.prototype,"origin",void 0);g([f.property({type:[z],value:null})],b.prototype,"lods",null);g([f.property({readOnly:!0})],b.prototype,"minScale",void 0);g([f.property({readOnly:!0})],b.prototype,"maxScale",void 0);
g([f.property({readOnly:!0})],b.prototype,"scales",void 0);g([f.property({cast:function(b){return Array.isArray(b)?b:"number"===typeof b?[b,b]:[256,256]},json:{read:{source:["rows","cols"],reader:function(b,d){return[d.cols,d.rows]}}}})],b.prototype,"size",void 0);g([f.property({type:m})],b.prototype,"spatialReference",void 0);b=k=g([f.subclass("esri.layers.support.TileInfo")],b);var k;return b});