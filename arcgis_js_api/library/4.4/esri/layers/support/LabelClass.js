// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.4/esri/copyright.txt for details.
//>>built
define("../../core/JSONSupport ../../core/lang ../../core/kebabDictionary dojo/_base/lang dojo/number ../../PopupTemplate ../../widgets/Popup/PopupRendererViewModel ../../renderers/support/arcadeUtils ../../symbols/support/jsonUtils".split(" "),function(r,l,t,h,u,v,w,k,m){var x=/__begin__/ig,y=/__end__/ig,n=/^__begin__/i,p=/__end__$/i,q=t({esriServerPointLabelPlacementAboveCenter:"above-center",esriServerPointLabelPlacementAboveLeft:"above-left",esriServerPointLabelPlacementAboveRight:"above-right",
esriServerPointLabelPlacementBelowCenter:"below-center",esriServerPointLabelPlacementBelowLeft:"below-left",esriServerPointLabelPlacementBelowRight:"below-right",esriServerPointLabelPlacementCenterCenter:"center-center",esriServerPointLabelPlacementCenterLeft:"center-left",esriServerPointLabelPlacementCenterRight:"center-right",esriServerLinePlacementAboveAfter:"above-after",esriServerLinePlacementAboveAlong:"above-along",esriServerLinePlacementAboveBefore:"above-before",esriServerLinePlacementAboveStart:"above-start",
esriServerLinePlacementAboveEnd:"above-end",esriServerLinePlacementBelowAfter:"below-after",esriServerLinePlacementBelowAlong:"below-along",esriServerLinePlacementBelowBefore:"below-before",esriServerLinePlacementBelowStart:"below-start",esriServerLinePlacementBelowEnd:"below-end",esriServerLinePlacementCenterAfter:"center-after",esriServerLinePlacementCenterAlong:"center-along",esriServerLinePlacementCenterBefore:"center-before",esriServerLinePlacementCenterStart:"center-start",esriServerLinePlacementCenterEnd:"center-end",
esriServerPolygonPlacementAlwaysHorizontal:"always-horizontal"}),g=r.createSubclass({declaredClass:"esri.layers.support.LabelClass",properties:{name:{value:null,json:{write:!0}},labelExpression:{value:null,json:{write:!0}},labelExpressionInfo:{value:null,json:{write:function(a,b,e,d){a=l.fixJson(a&&h.clone(a));b.labelExpressionInfo=this._processLabelExpressionInfo(a)}}},labelPlacement:{value:null,json:{read:function(a,b){return q.fromJSON(a)},write:function(a,b){if(a=q.toJSON(a))b.labelPlacement=
a}}},maxScale:{value:0,json:{write:function(a,b){if(a||this.minScale)b.maxScale=a}}},minScale:{value:0,json:{write:function(a,b){if(a||this.maxScale)b.minScale=a}}},requiredFields:{readOnly:!0,dependsOn:["labelExpression","labelExpressionInfo","where"],get:function(){var a=Object.create(null);this._collectRequiredFields(a);return Object.keys(a)}},symbol:{value:null,json:{read:m.read,write:function(a,b,e,d){b.symbol=m.write(a,{},d)}}},useCodedValues:{value:null,json:{write:!0}},where:{value:null,json:{write:!0}}},
getLabelExpression:function(){var a={expression:"",type:"none"};this.labelExpressionInfo?this.labelExpressionInfo.value?(a.expression=this.labelExpressionInfo.value,a.type="conventional"):this.labelExpressionInfo.expression&&(a.expression=this.labelExpressionInfo.expression,a.type="arcade"):this._validateLabelExpression(this.labelExpression)&&(a.expression=this._convertLabelExpression(this.labelExpression),a.type="conventional");return a},getOptions:function(){var a={},b=this.labelExpressionInfo;
if(b){var e=b.expression;e&&!b.value&&(a.hasArcadeExpression=!0,a.compiledArcadeFunc=k.createFunction(e))}return a},clone:function(){return new g({labelExpression:this.labelExpression,labelExpressionInfo:h.clone(this.labelExpressionInfo),labelPlacement:this.labelPlacement,maxScale:this.maxScale,minScale:this.minScale,name:this.name,symbol:this.symbol.clone(),where:this.where,useCodedValues:this.useCodedValues})},_collectRequiredFields:function(a){this._collectLabelExpressionRequiredFields(this.getLabelExpression(),
a);this._collectWhereRequiredFields(this.where,a)},_validateLabelExpression:function(a){return/^(\s*\[[^\]]+\]\s*)+$/i.test(a)},_convertLabelExpression:function(a){return a.replace(/\[/g,"{").replace(/\]/g,"}")},_collectWhereRequiredFields:function(a,b){null!=a&&(a=a.split(" "),3===a.length&&(b[a[0]]=!0),7===a.length&&(b[a[0]]=!0,b[a[4]]=!0))},_collectLabelExpressionRequiredFields:function(a,b){"arcade"===a.type?k.extractFieldNames(a.expression).forEach(function(a){b[a]=!0}):(a=a.expression.match(/{[^}]*}/g))&&
a.forEach(function(a){b[a.slice(1,-1)]=!0})},_processLabelExpressionInfo:function(a){a&&a.value&&(a.expression=this._convertTemplatedStringToArcade(a.value));return a},_convertTemplatedStringToArcade:function(a){var b;a&&(b=h.replace(a,function(a,b){return'__begin__$feature["'+b+'"]__end__'}),b=n.test(b)?b.replace(n,""):'"'+b,b=p.test(b)?b.replace(p,""):b+'"',b=b.replace(x,'" + ').replace(y,' + "'));return b}});g.evaluateWhere=function(a,b){var e=function(a,b,c){switch(b){case "\x3d":return a==c?
!0:!1;case "\x3c\x3e":return a!=c?!0:!1;case "\x3e":return a>c?!0:!1;case "\x3e\x3d":return a>=c?!0:!1;case "\x3c":return a<c?!0:!1;case "\x3c\x3d":return a<=c?!0:!1}return!1};try{if(null==a)return!0;var d=a.split(" ");if(3===d.length)return e(b[d[0]],d[1],d[2]);if(7===d.length){var f=e(b[d[0]],d[1],d[2]),g=d[3],c=e(b[d[4]],d[5],d[6]);switch(g){case "AND":return f&&c;case "OR":return f||c}}return!1}catch(z){console.log("Error.: can't parse \x3d "+a)}};g.buildLabelText=function(a,b,e,d){var f="";if(d&&
d.hasArcadeExpression)d.compiledArcadeFunc&&(a=k.createExecContext(b),a=k.executeFunction(d.compiledArcadeFunc,a),null!=a&&(f=a.toString()));else var h=b&&b.attributes||{},f=a.replace(/{[^}]*}/g,function(a){return g.formatField(a.slice(1,-1),a,h,e,d)});return f};g.formatField=function(a,b,e,d,f){var g=a.toLowerCase();for(a=0;a<d.length;a++)if(d[a].name.toLowerCase()===g){b=e[d[a].name];var c=d[a].domain;if(c&&h.isObject(c)){if("codedValue"==c.type)for(e=0;e<c.codedValues.length;e++)c.codedValues[e].code==
b&&(b=c.codedValues[e].name);else"range"==c.type&&c.minValue<=b&&b<=c.maxValue&&(b=c.name);break}c=d[a].type;"date"==c?(c=f&&f.dateFormat||"shortDate",c=v.prototype._dateFormatKebabDict.fromJSON(c),(c="DateFormat"+w.prototype._dateFormats[c])&&(b=l.substitute({myKey:b},"{myKey:"+c+"}"))):("integer"==c||"small-integer"==c||"long"==c||"double"==c)&&f&&f.numberFormat&&f.numberFormat.digitSeparator&&f.numberFormat.places&&(b=u.format(b,{places:f.numberFormat.places}))}return null==b?"":b};return g});