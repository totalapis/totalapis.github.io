// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.4/esri/copyright.txt for details.
//>>built
define("require exports ../core/tsSupport/declareExtendsHelper ../core/tsSupport/decorateHelper ../core/accessorSupport/decorators dojo/_base/lang dojo/io-query ../core/promiseUtils ../config ../request ./DynamicLayer ./mixins/ArcGISDynamicMapService ./mixins/OperationalLayer ./mixins/PortalLayer".split(" "),function(c,u,k,d,a,e,l,m,n,f,p,q,r,t){c=function(c){function a(b,a){b=c.call(this)||this;b.alwaysRefetch=!1;b.legendEnabled=!0;b.operationalLayerType="ArcGISMapServiceLayer";b.type="map-image";
return b}k(a,c);a.prototype.normalizeCtorArgs=function(b,a){return"string"===typeof b?e.mixin({url:b},a):b};a.prototype.load=function(){var b=this;this.addResolvingPromise(this.loadFromPortal({supportedTypes:["Map Service"]}).then(function(){return b._fetchService()}));return this};a.prototype.readLegendEnabled=function(b,a){return null!=a.showLegend?a.showLegend:!0};a.prototype.writeLegendEnabled=function(b,a){a.showLegend=!!b};a.prototype.getImageUrl=function(b,a,c,d){var g=this,h=this.parsedUrl.path+
"/export";b=e.mixin({},this.parsedUrl.query,this.createExportImageParameters(b,a,c,d),{f:"image",token:this.token,_ts:this.alwaysRefetch?(new Date).getTime():null});a=h+"?"+l.objectToQuery(b);return a.length>n.request.maxUrlLength?(b.f="json",f(h,{query:b,responseType:"json",callbackParamName:"callback"}).then(function(a){return a.data.href+(g.token?"?token\x3d"+g.token:"")})):a};a.prototype._fetchService=function(){var a=this;return m.resolve().then(function(){return a.resourceInfo?{ssl:!1,data:a.resourceInfo}:
f(a.parsedUrl.path,{query:e.mixin({f:"json"},a.parsedUrl.query),responseType:"json",callbackParamName:"callback"})}).then(function(b){b.ssl&&(a.url=a.url.replace(/^http:/i,"https:"));a.read(b.data,{origin:"service",url:a.parsedUrl})})};return a}(a.declared(p,q,r,t));d([a.property()],c.prototype,"alwaysRefetch",void 0);d([a.property({type:Boolean})],c.prototype,"legendEnabled",void 0);d([a.reader("legendEnabled",["showLegend"])],c.prototype,"readLegendEnabled",null);d([a.writer("legendEnabled")],c.prototype,
"writeLegendEnabled",null);d([a.property()],c.prototype,"operationalLayerType",void 0);d([a.property({json:{read:!1},readOnly:!0,value:"map-image"})],c.prototype,"type",void 0);return c=d([a.subclass("esri.layers.MapImageLayer")],c)});