// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.4/esri/copyright.txt for details.
//>>built
define("require exports ../../../../core/tsSupport/declareExtendsHelper ../../../../core/tsSupport/decorateHelper ../../../../core/promiseUtils ../../../../core/Error ../../../../tasks/GenerateRendererTask ../../../../core/accessorSupport/decorators ../../statistics/support/utils ./LayerAdapter".split(" "),function(e,r,l,m,f,g,n,k,h,p){var q=/(https?:)?\/\/services.*\.arcgis\.com/i;e=function(e){function d(a){var b=e.call(this)||this;b._layer=a.layer;return b}l(d,e);d.prototype.getField=function(a){return this._layer.getField(a)};
d.prototype.getFieldUsageInfo=function(a){return this._layer.getField(a)?{supportsLabelingInfo:!0,supportsRenderer:!0,supportsPopupTemplate:!0,supportsLayerQuery:!0}:null};d.prototype.getFieldDomain=function(a,b){return this._layer.getFieldDomain(a,b)};d.prototype.queryStatistics=function(a){var b=this._layer;if(this.hasLocalSource||!b.get("capabilities.query.supportsStatistics"))return f.reject(new g("feature-layer-adapter:not-supported","Layer does not support statistics query"));var c=b.createQuery();
c.outStatistics=a.outStatistics;c.groupByFieldsForStatistics=a.groupByFieldsForStatistics;c.orderByFields=a.orderByFields;c.where=h.mergeWhereClauses(c.where,a.where);c.sqlFormat=a.sqlFormat;return b.queryFeatures(c)};d.prototype.queryFeatureCount=function(a){if(this.hasLocalSource)return f.reject(new g("feature-layer-adapter:not-supported","Layer does not support count query"));var b=this._layer,c=b.createQuery();c.where=h.mergeWhereClauses(c.where,a);return b.queryFeatureCount(c)};d.prototype.generateRenderer=
function(a){var b=this._layer;if(this.hasLocalSource||10.1>b.version)return f.reject(new g("feature-layer-adapter:not-supported","Layer does not support generateRenderer operation (requires ArcGIS Server version 10.1+)"));var c=new n({url:b.parsedUrl.path,gdbVersion:b.gdbVersion}),b=b.createQuery();a.where=h.mergeWhereClauses(a.where,b.where);return c.execute(a)};d.prototype.getAllFeatures=function(a){return this.hasLocalSource||a?a?a.then(function(){return a.graphics}):this.hasLocalSource?f.resolve(this._layer.source):
null:f.reject(new g("feature-layer-adapter:missing-parameters","View is required for service based layers"))};d.prototype.load=function(){var a=this,b=this._layer,c=b.load().then(function(){a.geometryType=b.geometryType;a.objectIdField=b.objectIdField;a.supportsSQLExpression=q.test(b.url);a.hasLocalSource=!b.url&&!!b.source;if(a.hasLocalSource)return f.reject(new g("feature-layer-adapter:not-supported","Feature collection is not supported"))});this.addResolvingPromise(c);return this};return d}(k.declared(p));
return e=m([k.subclass()],e)});