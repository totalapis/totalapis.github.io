// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.4/esri/copyright.txt for details.
//>>built
define("require exports dojo/i18n!../../nls/smartMapping dojo/_base/lang ../symbology/type ../../../core/promiseUtils ../../../core/lang ../support/utils ./support/utils ../../../views/SceneView ../statistics/uniqueValues ../../UniqueValueRenderer ../../support/utils".split(" "),function(K,t,z,u,v,f,A,k,g,B,C,D,p){function E(b){if(!b||!b.layer||!b.field&&!b.valueExpression)return f.reject(g.createError("type-renderer:missing-parameters","'layer' and 'field' or 'valueExpression' parameters are required"));
var a=u.mixin({},b);a.symbolType=a.symbolType||"2d";a.layer=k.createLayerAdapter(a.layer);a.numTypes=null==a.numTypes?10:a.numTypes;a.defaultSymbolEnabled=null==a.defaultSymbolEnabled?!0:a.defaultSymbolEnabled;a.sortBy=null==a.sortBy?"count":a.sortBy;a.statistics=A.clone(a.statistics);return a.layer?a.layer.load().then(function(){var b=a.layer.geometryType,d=-1<a.symbolType.indexOf("3d");if("mesh"===b)a.symbolType="3d-volumetric",a.colorMixMode=a.colorMixMode||"replace";else{if(d&&("polyline"===b||
"polygon"===b))return f.reject(g.createError("type-renderer:not-supported","3d symbols are not supported for polyline and polygon layers"));if(-1<a.symbolType.indexOf("3d-volumetric")&&!(a.view instanceof B))return f.reject(g.createError("type-renderer:invalid-parameters","'view' parameter should be an instance of SceneView when 'symbolType' parameter is '3d-volumetric' or '3d-volumetric-uniform'"))}b=k.getFieldsList({field:a.field,valueExpression:a.valueExpression});return(b=g.verifyBasicFieldValidity(a.layer,
b,"type-renderer:invalid-parameters"))?f.reject(b):a}):f.reject(g.createError("type-renderer:invalid-parameters","'layer' must be one of these types: "+F))}function w(b,a){var c=b.typeScheme,d=b.basemap;c?c=v.cloneScheme(c):(c=(b=v.getSchemes({basemap:b.basemap,geometryType:a,worldScale:-1<b.symbolType.indexOf("3d-volumetric"),view:b.view}))&&b.primaryScheme,d=b&&b.basemapId);return{scheme:c,basemapId:d}}function x(b,a){return b.label<a.label?-1:b.label>a.label?1:0}function y(b,a){return b.value<
a.value?-1:b.value>a.value?1:0}function G(b,a){var c=a.count-b.count;0===c&&(c=x(b,a));return c}function H(b,a){var c=a.count-b.count;0===c&&(c=y(b,a));return c}function I(b,a,c){var d;"count"===a?(d=H,c&&c.codedValues&&(d=G)):"value"===a&&(d=y,c&&c.codedValues&&(d=x));d&&b.sort(d)}function J(b,a){b=b.uniqueValueInfos;var c=a.layer,d=a.field,e=d?c.getField(d):null,f=e?c.getFieldDomain(e.name):null,k=-1===a.numTypes?b.length:a.numTypes,m=c.geometryType,c=w(a,m),h=c.scheme,d=new D({field:d}),q=-1,l,
n={value:null,domain:f,fieldInfo:e};b.forEach(function(a,b){n.value=a.value;a.label=p.createUniqueValueLabel(n);null===a.value&&(q=b)});-1<q&&(l=b.splice(q,1)[0]);I(b,a.sortBy,f);e&&"date"===e.type&&(e=b.filter(function(a,b){return b<k}).map(function(a){return a.value}),n.dateFormatInterval=p.calculateDateFormatInterval(e));var r=g.createColors(h.colors,b.length);b.forEach(function(b,c){n.value=b.value;b.label=p.createUniqueValueLabel(n);b.symbol=g.createSymbol(h,r[c],m,a.symbolType,a.colorMixMode)});
a.valueExpression&&(d.valueExpression=a.valueExpression,d.valueExpressionTitle=a.valueExpressionTitle);d.legendOptions=a.legendOptions;r=g.createColors(h.colors,k);for(e=0;e<k;e++)(f=b[e])&&d.addUniqueValueInfo({value:f.value,label:f.label,symbol:g.createSymbol(h,r[e],m,a.symbolType,a.colorMixMode)});a.defaultSymbolEnabled&&(d.defaultSymbol=g.createSymbol(h,h.noDataColor,m,a.symbolType,a.colorMixMode),d.defaultLabel=z.other);l&&(l.symbol=g.createSymbol(h,h.noDataColor,m,a.symbolType,a.colorMixMode),
b.push(l));l=[];e=d.uniqueValueInfos.length===b.length?-1:d.uniqueValueInfos.length;if(-1<e)for(;e<b.length;e++)l.push(u.mixin({},b[e]));return{renderer:d,uniqueValueInfos:b,excludedUniqueValueInfos:l,typeScheme:w(a,m).scheme,basemapId:c.basemapId}}Object.defineProperty(t,"__esModule",{value:!0});var F=k.supportedLayerTypes.join(", ");t.createRenderer=function(b){return E(b).then(function(a){return(null!=a.statistics?f.resolve(a.statistics):C({layer:a.layer,field:a.field,valueExpression:a.valueExpression,
returnAllCodedValues:a.returnAllCodedValues})).then(function(b){return J(b,a)})})}});