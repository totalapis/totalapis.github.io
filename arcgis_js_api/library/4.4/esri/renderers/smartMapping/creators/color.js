// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.4/esri/copyright.txt for details.
//>>built
define("require exports dojo/i18n!../../nls/smartMapping dojo/_base/lang ../../../core/lang ../statistics/summaryStatistics ../symbology/color ../../../core/numberUtils ../../support/utils ../../ClassBreaksRenderer ../../../core/promiseUtils ../../../views/SceneView ./support/utils ../support/utils".split(" "),function(I,n,A,p,B,C,q,D,r,E,f,w,d,e){function F(b){if(!(b&&b.layer&&(b.field||b.valueExpression||b.sqlExpression)))return f.reject(d.createError("color-visual-variable:missing-parameters",
"'layer' and 'field', 'valueExpression' or 'sqlExpression' parameters are required"));var a=p.mixin({},b);a.layer=e.createLayerAdapter(a.layer);return a.layer?a.layer.load().then(function(){var c=a.layer.geometryType;if("mesh"!==c&&a.worldScale){if("polyline"===c||"polygon"===c)return f.reject(d.createError("color-visual-variable:not-supported","'worldScale' sizing is not supported for polyline and polygon layers"));if(!(a.view instanceof w))return f.reject(d.createError("color-visual-variable:invalid-parameters",
"'view' parameter should be an instance of SceneView when 'worldScale' parameter is true"))}c=e.getFieldsList({field:a.field,normalizationField:a.normalizationField,valueExpression:a.valueExpression});return(c=d.verifyBasicFieldValidity(a.layer,c,"color-visual-variable:invalid-parameters"))?f.reject(c):a}):f.reject(d.createError("color-visual-variable:invalid-parameters","'layer' must be one of these types: "+x))}function G(b){if(!(b&&b.layer&&(b.field||b.valueExpression||b.sqlExpression)))return f.reject(d.createError("color-continuous-renderer:missing-parameters",
"'layer' and 'field', 'valueExpression' or 'sqlExpression' parameters are required"));var a=p.mixin({},b);a.symbolType=a.symbolType||"2d";a.layer=e.createLayerAdapter(a.layer);return a.layer?a.layer.load().then(function(){var c=a.layer.geometryType,b=-1<a.symbolType.indexOf("3d");if("mesh"===c)a.symbolType="3d-volumetric",a.colorMixMode=a.colorMixMode||"replace";else{if(b&&("polyline"===c||"polygon"===c))return f.reject(d.createError("color-continuous-renderer:not-supported","3d symbols are not supported for polyline and polygon layers"));
if(-1<a.symbolType.indexOf("3d-volumetric")&&!(a.view instanceof w))return f.reject(d.createError("color-continuous-renderer:invalid-parameters","'view' parameter should be an instance of SceneView when 'symbolType' parameter is '3d-volumetric' or '3d-volumetric-uniform'"))}c=e.getFieldsList({field:a.field,normalizationField:a.normalizationField,valueExpression:a.valueExpression});return(c=d.verifyBasicFieldValidity(a.layer,c,"color-continuous-renderer:invalid-parameters"))?f.reject(c):a}):f.reject(d.createError("color-continuous-renderer:invalid-parameters",
"'layer' must be one of these types: "+x))}function H(b){b=p.mixin({},b);var a=-1<b.symbolType.indexOf("3d-volumetric");delete b.symbolType;delete b.defaultSymbolEnabled;delete b.colorMixMode;b.worldScale=a;return b}function y(b){return F(b).then(function(a){var b=a.normalizationField,e=b?"field":void 0;return(a.statistics?f.resolve(a.statistics):C({layer:a.layer,field:a.field,valueExpression:a.valueExpression,sqlExpression:a.sqlExpression,sqlWhere:a.sqlWhere,normalizationType:e,normalizationField:b,
minValue:a.minValue,maxValue:a.maxValue})).then(function(c){var g,m;g=a.layer;var k=a.field,h=k&&"function"!==typeof k?g.getField(k):null,h=h&&"date"===h.type,e=g.geometryType;g=a.colorScheme;m=a.basemap;g?g=q.cloneScheme(g):(g=(m=q.getSchemes({theme:a.theme||"high-to-low",basemap:a.basemap,geometryType:e,worldScale:a.worldScale,view:a.view}))&&m.primaryScheme,m=m&&m.basemapId);if(g){var t=d.createColors(g.colors,5);if(5>t.length)c=f.reject(d.createError("color-visual-variable:insufficient-info",
"Color scheme does not have enough colors"));else{var e=d.getDefaultDataRange(c,h,!0),l=-1<g.id.indexOf("seq-");if(e){for(var l=e[0],n=e[1],p=(n-l)/4,u=[l],v=1;3>=v;v++)u.push(l+v*p);u.push(n);l=D.round(u,{strictBounds:!0})}else l=d.createStopValues(c,l);t=d.createColors(t,5);k={type:"color",field:k,valueExpression:a.valueExpression,normalizationField:b,stops:r.createColorStops({values:l,isDate:h,dateFormatOptions:h?r.timelineDateFormatOptions:null,colors:t,labelIndexes:[0,2,4]}),legendOptions:a.legendOptions};
c=f.resolve({basemapId:m,visualVariable:k,statistics:c,defaultValuesUsed:!!e,colorScheme:q.cloneScheme(g),authoringInfo:{visualVariables:[{type:"color",minSliderValue:c.min,maxSliderValue:c.max,theme:g.theme}]}})}}else c=f.reject(d.createError("color-visual-variable:insufficient-info","Unable to find color scheme"));return c})})}Object.defineProperty(n,"__esModule",{value:!0});var z=Math.pow(2,53)-1,x=e.supportedLayerTypes.join(", ");n.createVisualVariable=y;n.createContinuousRenderer=function(b){return G(b).then(function(a){return y(H(a)).then(function(c){var b=
a.normalizationField,f=b?"field":void 0,g=a.field,e=a.layer.geometryType,k=null==a.defaultSymbolEnabled?!0:a.defaultSymbolEnabled,h=q.cloneScheme(c.colorScheme);return{renderer:new E({classBreakInfos:[{minValue:-z,maxValue:z,symbol:d.createSymbol(h,h.noDataColor,e,a.symbolType,a.colorMixMode)}],defaultLabel:k?A.other:null,defaultSymbol:k?d.createSymbol(h,h.noDataColor,e,a.symbolType,a.colorMixMode):null,field:g,normalizationType:f,normalizationField:b,valueExpression:a.valueExpression,visualVariables:[r.cloneColorVariable(c.visualVariable)],
authoringInfo:B.clone(c.authoringInfo)}),visualVariable:r.cloneColorVariable(c.visualVariable),statistics:c.statistics,defaultValuesUsed:c.defaultValuesUsed,colorScheme:q.cloneScheme(c.colorScheme),basemapId:c.basemapId}})})}});