// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.4/esri/copyright.txt for details.
//>>built
define("require exports ../core/tsSupport/declareExtendsHelper ../core/tsSupport/decorateHelper ../core/accessorSupport/decorators ../core/lang ../core/urlUtils ../core/Logger ../core/Error ../core/arrayUtils ../portal/Portal ../symbols/WebStyleSymbol ../symbols/support/jsonUtils ../symbols/support/symbolUtils ./Renderer ./support/arcadeUtils ./support/diffUtils".split(" "),function(c,A,u,e,a,g,r,v,p,t,q,w,m,x,y,n,z){var k=v.getLogger("esri.renderers.UniqueValueRenderer");c=l=function(c){function a(b){b=
c.call(this)||this;b._valueInfoMap={};b._isDefaultSymbolDerived=!1;b.type="uniqueValue";b.field=null;b.field2=null;b.field3=null;b.valueExpression=null;b.valueExpressionTitle=null;b.legendOptions=null;b.defaultLabel=null;b.fieldDelimiter=null;b.portal=null;b.styleOrigin=null;b.diff={uniqueValueInfos:function(b,a){if(b||a){if(!b||!a)return{type:"complete",oldValue:b,newValue:a};for(var f=!1,c={type:"collection",added:[],removed:[],changed:[],unchanged:[]},h=function(d){var h=t.find(b,function(b){return b.value===
a[d].value});h?z.diff(h,a[d])?c.changed.push({type:"complete",oldValue:h,newValue:a[d]}):c.unchanged.push({oldValue:h,newValue:a[d]}):c.added.push(a[d]);f=!0},e=0;e<a.length;e++)h(e);h=function(d){t.find(a,function(f){return f.value===b[d].value})||(c.removed.push(b[d]),f=!0)};for(e=0;e<b.length;e++)h(e);return f?c:void 0}}};b._set("uniqueValueInfos",[]);return b}u(a,c);a.prototype.writeValueExpression=function(b,f,a,d){d&&"web-scene"===d.origin?b&&d.messages&&d.messages.push(new p("property:unsupported",
this.declaredClass+".valueExpression is not supported in Web Scene. Please remove this property to save the Web Scene.",{instance:this,propertyName:"valueExpression",context:d})):f.valueExpression=b};a.prototype.writeValueExpressionTitle=function(b,f,a,d){d&&"web-scene"===d.origin?b&&d.messages&&d.messages.push(new p("property:unsupported",this.declaredClass+".valueExpressionTitle is not supported in Web Scene. Please remove this property to save the Web Scene.",{instance:this,propertyName:"valueExpressionTitle",
context:d})):f.valueExpressionTitle=b};Object.defineProperty(a.prototype,"compiledFunc",{get:function(){return n.createFunction(this.valueExpression)},enumerable:!0,configurable:!0});a.prototype.readLegendOptions=function(b){return g.clone(b)};a.prototype.writeLegendOptions=function(b,f,a,d){d&&"web-scene"===d.origin?b&&d.messages&&d.messages.push(new p("property:unsupported",this.declaredClass+".legendOptions is not supported in Web Scene. Please remove this property to save the Web Scene.",{instance:this,
propertyName:"legendOptions",context:d})):f.legendOptions=g.clone(b)};Object.defineProperty(a.prototype,"defaultSymbol",{set:function(b){this._isDefaultSymbolDerived=!1;this._set("defaultSymbol",b)},enumerable:!0,configurable:!0});a.prototype.readDefaultSymbol=function(b,f,a){return m.read(b,f,a)};a.prototype.writeDefaultSymbol=function(b,f,a,d){!this._isDefaultSymbolDerived&&(b=m.write(b,{},d))&&(f.defaultSymbol=b)};a.prototype.readPortal=function(b,f,a){return a.portal||q.getDefault()};a.prototype.readStyleOrigin=
function(b,f,a){if(f.styleName)return Object.freeze({styleName:f.styleName});if(f.styleUrl)return b=r.read(f.styleUrl,a),Object.freeze({styleUrl:b})};a.prototype.writeStyleOrigin=function(b,a,c,d){b.styleName?a.styleName=b.styleName:b.styleUrl&&(a.styleUrl=r.write(b.styleUrl,d))};Object.defineProperty(a.prototype,"uniqueValueInfos",{set:function(b){this.styleOrigin?k.error("#uniqueValueInfos\x3d","Cannot modify unique value infos of a UniqueValueRenderer created from a web style"):(this._set("uniqueValueInfos",
b.slice(0)),this._updateValueInfoMap())},enumerable:!0,configurable:!0});a.prototype.readUniqueValueInfos=function(b,a,c){if(Array.isArray(b))return b.map(function(b){b=g.clone(b);b.symbol=m.read(b.symbol,a,c);return b})};a.prototype.writeUniqueValueInfos=function(b,a,c,d){this.styleOrigin||(a.uniqueValueInfos=(this.uniqueValueInfos||[]).map(function(b){b=g.clone(b);b.symbol&&(b.symbol=m.write(b.symbol,{},d));b.value+="";return g.fixJson(b)}))};a.prototype.addUniqueValueInfo=function(b,a){this.styleOrigin?
k.error("#addUniqueValueInfo()","Cannot modify unique value infos of a UniqueValueRenderer created from a web style"):(b="object"===typeof b?b:{value:b,symbol:a},this.uniqueValueInfos.push(b),this._valueInfoMap[b.value+""]=b)};a.prototype.removeUniqueValueInfo=function(b){if(this.styleOrigin)k.error("#removeUniqueValueInfo()","Cannot modify unique value infos of a UniqueValueRenderer created from a web style");else for(var a=0;a<this.uniqueValueInfos.length;a++)if(this.uniqueValueInfos[a].value+""===
b+""){delete this._valueInfoMap[b];this.uniqueValueInfos.splice(a,1);break}};a.prototype.getUniqueValueInfo=function(b,a){var f=this.field,d=b.attributes;if(this.valueExpression)f=n.executeFunction(this.compiledFunc,n.createExecContext(b,n.getViewInfo(a)));else if(this.field2){b=this.field2;a=this.field3;var c=[];f&&c.push(d[f]);b&&c.push(d[b]);a&&c.push(d[a]);f=c.join(this.fieldDelimiter||"")}else f=f&&"function"===typeof f?f(b):d[f];return this._valueInfoMap[f+""]};a.prototype.getSymbol=function(b,
a){return(b=this.getUniqueValueInfo(b,a))&&b.symbol||this.defaultSymbol};a.prototype.clone=function(){var b=new l({field:this.field,field2:this.field2,field3:this.field3,defaultLabel:this.defaultLabel,defaultSymbol:g.clone(this.defaultSymbol),valueExpression:this.valueExpression,valueExpressionTitle:this.valueExpressionTitle,fieldDelimiter:this.fieldDelimiter,visualVariables:g.clone(this.visualVariables),legendOptions:g.clone(this.legendOptions),authoringInfo:g.clone(this.authoringInfo)});this._isDefaultSymbolDerived&&
(b._isDefaultSymbolDerived=!0);b._set("portal",this.portal);var a=g.clone(this.uniqueValueInfos);this.styleOrigin&&(b._set("styleOrigin",Object.freeze(g.clone(this.styleOrigin))),Object.freeze(a));b._set("uniqueValueInfos",a);b._updateValueInfoMap();return b};a.prototype.collectRequiredFields=function(b){this.inherited(arguments);[this.field,this.field2,this.field3].forEach(function(a){a&&(b[a]=!0)})};a.prototype.populateFromStyle=function(){var b=this;return x.fetchStyle(this.styleOrigin,{portal:this.portal}).then(function(a){var f=
[];b._valueInfoMap={};a&&a.data&&Array.isArray(a.data.items)&&a.data.items.forEach(function(c){var d=new w({styleUrl:a.styleUrl,styleName:a.styleName,portal:b.portal,name:c.name});b.defaultSymbol||c.name!==a.data.defaultItem||(b.defaultSymbol=d,b._isDefaultSymbolDerived=!0);d={value:c.name,symbol:d};f.push(d);b._valueInfoMap[c.name]=d});b._set("uniqueValueInfos",Object.freeze(f));!b.defaultSymbol&&b.uniqueValueInfos.length&&(b.defaultSymbol=b.uniqueValueInfos[0].symbol,b._isDefaultSymbolDerived=!0);
return b})};a.prototype._updateValueInfoMap=function(){var b=this;this._valueInfoMap={};this.uniqueValueInfos.forEach(function(a){return b._valueInfoMap[a.value+""]=a})};a.fromPortalStyle=function(b,a){var c=new l(a&&a.properties);c._set("styleOrigin",Object.freeze({styleName:b}));c._set("portal",a&&a.portal||q.getDefault());a=c.populateFromStyle();a.otherwise(function(a){k.error("#fromPortalStyle('"+b+"'[, ...])","Failed to create unique value renderer from style name",a)});return a};a.fromStyleUrl=
function(b,a){a=new l(a&&a.properties);a._set("styleOrigin",Object.freeze({styleUrl:b}));a=a.populateFromStyle();a.otherwise(function(a){k.error("#fromStyleUrl('"+b+"'[, ...])","Failed to create unique value renderer from style URL",a)});return a};return a}(a.declared(y));e([a.property()],c.prototype,"type",void 0);e([a.property({json:{read:{source:"field1"},write:{target:"field1"}}})],c.prototype,"field",void 0);e([a.property({json:{write:!0}})],c.prototype,"field2",void 0);e([a.property({json:{write:!0}})],
c.prototype,"field3",void 0);e([a.property({json:{write:!0}})],c.prototype,"valueExpression",void 0);e([a.writer("valueExpression")],c.prototype,"writeValueExpression",null);e([a.property({json:{write:!0}})],c.prototype,"valueExpressionTitle",void 0);e([a.writer("valueExpressionTitle")],c.prototype,"writeValueExpressionTitle",null);e([a.property({dependsOn:["valueExpression"]})],c.prototype,"compiledFunc",null);e([a.property({json:{write:!0}})],c.prototype,"legendOptions",void 0);e([a.reader("legendOptions")],
c.prototype,"readLegendOptions",null);e([a.writer("legendOptions")],c.prototype,"writeLegendOptions",null);e([a.property({json:{write:!0}})],c.prototype,"defaultLabel",void 0);e([a.property()],c.prototype,"defaultSymbol",null);e([a.reader("defaultSymbol")],c.prototype,"readDefaultSymbol",null);e([a.writer("defaultSymbol")],c.prototype,"writeDefaultSymbol",null);e([a.property({json:{write:!0}})],c.prototype,"fieldDelimiter",void 0);e([a.property({type:q,readOnly:!0})],c.prototype,"portal",void 0);
e([a.reader("portal",["styleName"])],c.prototype,"readPortal",null);e([a.property({readOnly:!0,json:{write:!0}})],c.prototype,"styleOrigin",void 0);e([a.reader("styleOrigin",["styleName","styleUrl"])],c.prototype,"readStyleOrigin",null);e([a.writer("styleOrigin")],c.prototype,"writeStyleOrigin",null);e([a.property()],c.prototype,"uniqueValueInfos",null);e([a.reader("uniqueValueInfos")],c.prototype,"readUniqueValueInfos",null);e([a.writer("uniqueValueInfos")],c.prototype,"writeUniqueValueInfos",null);
e([a.property({dependsOn:["field","field2","field3"],readOnly:!0})],c.prototype,"requiredFields",void 0);c=l=e([a.subclass("esri.renderers.UniqueValueRenderer")],c);var l;return c});