// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.4/esri/copyright.txt for details.
//>>built
define("dojo/_base/array dojo/_base/lang ../request ./Task ../geometry/SpatialReference ./support/AddressCandidate".split(" "),function(k,e,h,l,p,g){return l.createSubclass({declaredClass:"esri.tasks.Locator",properties:{categories:{value:null,type:[String]},countryCode:{value:null,type:String},outSpatialReference:{value:null,type:p},url:{}},addressToLocations:function(a,b){var c,d=a.outFields,f=a.searchExtent,g=a.countryCode,q=a.magicKey,r=a.distance,m=a.categories,k=a.maxLocations,l=a.forStorage;
a.location&&this.normalization&&(c=a.location.clone().normalize());f&&(f=f.shiftCentralMeridian());a=a.address;var n=this.outSpatialReference;a={query:this._encode(e.mixin({},this.parsedUrl.query,a,{f:"json",outSR:n&&JSON.stringify(n.toJSON()),outFields:d&&d.join(",")||null,searchExtent:f&&JSON.stringify(f.toJSON()),category:m&&m.join(",")||null,countryCode:g||null,magicKey:q||null,distance:r||null,location:c||null,maxLocations:k||null,forStorage:l||null})),callbackParamName:"callback"};if(this.requestOptions||
b)a=e.mixin({},this.requestOptions,b,a);return h(this.parsedUrl.path+"/findAddressCandidates",a).then(this._handleAddressToLocationsResponse)},suggestLocations:function(a,b){a.hasOwnProperty("location")&&this.normalization&&(a.location=a.location.clone().normalize());a.searchExtent&&(a.searchExtent=a.searchExtent.shiftCentralMeridian());a={query:this._encode(e.mixin({},this.parsedUrl.query,{f:"json",text:a.text,maxSuggestions:a.maxSuggestions,searchExtent:a.searchExtent&&JSON.stringify(a.searchExtent.toJSON()),
category:a.categories&&a.categories.join(",")||null,countryCode:a.countryCode||null,location:a.location||null,distance:a.distance||null},{f:"json"})),callbackParamName:"callback"};if(this.requestOptions||b)a=e.mixin({},this.requestOptions,b,a);return h(this.parsedUrl.path+"/suggest",a).then(this._handleSuggestLocationsResponse)},addressesToLocations:function(a,b){var c=this.outSpatialReference,d=[],f=a.categories,g=a.countryCode;k.forEach(a.addresses,function(a,b){d.push({attributes:a})});a={query:this._encode(e.mixin({},
this.parsedUrl.query,{category:f&&f.join(",")||null,sourceCountry:g||null},{addresses:JSON.stringify({records:d})},{f:"json",outSR:c&&JSON.stringify(c.toJSON())})),callbackParamName:"callback"};if(this.requestOptions||b)a=e.mixin({},this.requestOptions,b,a);return h(this.parsedUrl.path+"/geocodeAddresses",a).then(this._handleAddressesToLocationsResponse)},locationToAddress:function(a,b,c){a&&this.normalization&&(a=a.clone().normalize());var d=this.outSpatialReference;a={query:this._encode(e.mixin({},
this.parsedUrl.query,{outSR:d&&JSON.stringify(d.toJSON()),location:a&&JSON.stringify(a.toJSON()),distance:b,f:"json"})),callbackParamName:"callback"};if(this.requestOptions||c)a=e.mixin({},this.requestOptions,c,a);return h(this.parsedUrl.path+"/reverseGeocode",a).then(this._handleLocationToAddressResponse)},_handleAddressToLocationsResponse:function(a){a=a.data;var b=a.spatialReference,c,d;return(a.candidates||[]).map(function(a){c=a.extent;d=a.location;c&&(c.spatialReference=b);d&&(d.spatialReference=
b);return g.fromJSON(a)})},_handleSuggestLocationsResponse:function(a){return a.data.suggestions||[]},_handleAddressesToLocationsResponse:function(a){a=a.data;var b=a.spatialReference,c;return(a.locations||[]).map(function(a){if(c=a.location)c.spatialReference=b;return g.fromJSON(a)})},_handleLocationToAddressResponse:function(a){a=a.data;var b=a.address||{};return g.fromJSON({address:b.Match_addr||"",attributes:b,location:a.location,score:100})}})});