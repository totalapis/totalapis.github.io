// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.4/esri/copyright.txt for details.
//>>built
define("require exports dojo/_base/lang ../../libs/gl-matrix/mat2d ../../libs/gl-matrix/mat2dExtras ../../../../core/screenUtils ../../../../geometry/Polygon ../../../../symbols/SimpleMarkerSymbol ../../../../symbols/support/gfxUtils".split(" "),function(L,l,y,t,u,q,H,n,r){function v(c,a){a.toRgba?(c[0]=a.r,c[1]=a.g,c[2]=a.b,c[3]=a.a):(c[0]=a[0],c[1]=a[1],c[2]=a[2],c[3]=a[3]);return c}function w(c,a,b){null!=b&&(c[0]=a[0],c[1]=a[1],c[2]=a[2],c[3]=b);return c}function z(c,a,b){var e=a[0]/a[1];c[0]=
c[1]=1;isNaN(b)||(1<e?(c[0]=b/a[0],c[1]=b/e/a[1]):(c[1]=b/a[1],c[0]=b*e/a[0]));return c}function A(c,a,b,e,f,h,g){var d=f.symbol;b=c.toScreenPoint(I,b,g[0]);g=[b.x,b.y];c=b.x;b=b.y;var l=f.heading;f=f.size&&f.size[0];var m,k;t.identity(p);"number"===typeof f&&(k=isFinite(f)&&f);k=(f=k&&isFinite(k)&&!isNaN(k))?q.pt2px(k):NaN;h&&u.rotategAt(p,p,h,g);l&&u.rotategAt(p,p,l,g);h=q.pt2px(d.xoffset);l=q.pt2px(d.yoffset);0===h&&0===l||t.translate(p,p,[h,-l]);0!==d.angle&&u.rotategAt(p,p,d.angle,g);if("simple-marker-symbol"===
d.type)switch(m=d.style,h=Math.round,k=f?k:q.pt2px(d.size),f=void 0,m){case n.STYLE_SQUARE:case n.STYLE_CROSS:case n.STYLE_X:case n.STYLE_DIAMOND:f=isNaN(k)?16:.5*k;m=x(a,e,B(m,c,b,h(c-f),h(c+f),h(b-f),h(b+f)));break;case n.STYLE_PATH:m=d=x(a,e,d.path);d=d.getBoundingBox();k=z(t.create(),[d.width,d.height],k);1===k[0]&&1===k[3]||u.scaleAt(p,p,k,g);t.translate(p,p,[-(d.x+.5*d.width)+c,-(d.y+.5*d.height)+b]);break;default:f=isNaN(k)?16:.5*k,m=C(a,e,{cx:c,cy:b,r:f})}else if("picture-marker-symbol"===
d.type)m=f?k:q.pt2px(d.width),k=f?k:q.pt2px(d.height),m=D(a,e,{x:c-.5*m,y:b-.5*k,width:m,height:k,src:d.url});else if("text-symbol"===d.type){if(g=d.font&&d.font.clone())g.size=f?k:q.pt2px(g.size);m=E(a,e,{type:"text",text:d.text,x:c,y:b,align:r.getSVGAlign(d),decoration:d.decoration||g&&g.decoration,rotated:d.rotated,kerning:d.kerning});g&&m.setFont(g);k=m.getNode();a=r.getSVGBaseline(d);d=r.getSVGBaselineShift(d);k&&(k.setAttribute("dominant-baseline",a),d&&k.setAttribute("baseline-shift",d))}m.setTransform(p);
return m}function D(c,a,b){return a?a.setShape(b):c.createImage(b)}function C(c,a,b){return a?a.setShape(b):c.createCircle(b)}function x(c,a,b){b=Array.isArray(b)?b.join(" "):b;return a?a.setShape(b):c.createPath(b)}function E(c,a,b){return a?a.setShape(b):c.createText(b)}function F(c,a){a=a&&a.shape&&a.shape.type;var b=c&&c.type;c=c&&c.style;b&&(c=J[b]||c);K[c]&&(c="path");return!(!a||!c||a===c)}function B(c,a,b,e,f,h,g,d){switch(c){case n.STYLE_SQUARE:return["M",e+","+h,f+","+h,f+","+g,e+","+g,
"Z"];case n.STYLE_CROSS:return["M",a+","+h,a+","+g,"M",e+","+b,f+","+b];case n.STYLE_X:return["M",e+","+h,f+","+g,"M",e+","+g,f+","+h];case n.STYLE_DIAMOND:return["M",a+","+h,f+","+b,a+","+g,e+","+b,"Z"];case n.STYLE_TARGET:return["M",e+","+h,f+","+h,f+","+g,e+","+g,e+","+h,"M",e-d+","+b,e+","+b,"M",a+","+(h-d),a+","+h,"M",f+d+","+b,f+","+b,"M",a+","+(g+d),a+","+g]}}function G(c,a){var b=a.symbol;if("picture-marker-symbol"!==b.type){var e=r.getFill(b);if("simple-marker-symbol"===b.type){var f=b.style,
h=(b=r.getStroke(b))&&b.color,f=f===n.STYLE_X||f===n.STYLE_CROSS,g=a.opacity;(a=a.color||v([0,0,0,0],f?h:e))&&null!=g&&(a=w([0,0,0,0],a,g));a&&(f?a!==h&&(b=b?y.mixin({},b):{},b.color=a):a!==e&&(e=a));c.setFill(e).setStroke(b)}else"text-symbol"===b.type&&(g=a.opacity,(a=a.color||v([0,0,0,0],e))&&null!=g&&(a=w([0,0,0,0],a,g)),a&&a!==e&&(e=a),c.setFill(e))}}Object.defineProperty(l,"__esModule",{value:!0});l.getScalingVector=z;var I={x:0,y:0},p=t.create();l.drawPoint=A;l.drawMarkers=function(c,a,b,e,
f,h,g){var d=f.symbol;b=b.points;a=e||a.createGroup();e=[0];a.children[0]&&F(d,a.children[0])&&a.clear();for(var l=0,m=b.length,d=0;d<m;d++)for(var k=b[d],p=g.length,n=0;n<p;n++)e[0]=g[n],a.add(A(c,a,{x:k[0],y:k[1]},a.children[l++],f,h,e));c=a.children.length;if(b.length*g.length<c)for(g=b.length*g.length,d=c-1;d>=g;d--)a.children[d].removeShape();return a};l.drawShape=function(c,a,b,e,f){var h=[];"extent"===b.type&&(b=H.fromExtent(b));if("polyline"===b.type||"polygon"===b.type){for(var g=f.length,
d=0;d<g;d++)h=h.concat(c.toScreenPath(b,f[d]));e=x(a,e,h)}return e};l.drawRect=function(c,a,b){return a?a.setShape(b):c.createRect(b)};l.drawImage=D;l.drawCircle=C;l.drawPath=x;l.drawText=E;var J={"picture-marker-symbol":"image","picture-fill-symbol":"path","simple-fill-symbol":"path","simple-line-symbol":"path","text-symbol":"text"},K={square:1,cross:1,x:1,diamond:1,target:1};l.isShapeInvalid=F;l.smsToPath=B;l.stylePoint=G;l.styleMarkers=function(c,a){for(var b=c.children.length,e=0;e<b;e++)G(c.children[e],
a)};l.styleShape=function(c,a){var b=a.symbol,e=a.size,f=a.color;a=a.opacity;var h=r.getStroke(b),g=r.getFill(b),d=!1,l;"simple-line-symbol"===b.type?(d=!0,l="none"!==b.style):l=b.outline&&"none"!==b.outline.style;var m,k,n;e&&(n=isFinite(e[0])&&e[0]);null!=e&&(n=q.pt2px(n));!f&&null==a||"picture-fill-symbol"===b.type||(d?(m=f||h&&h.color&&v([0,0,0,0],h.color))&&null!=a&&(m=w(m,m,a)):g&&(k=f||v([0,0,0,0],g))&&null!=a&&(k=w(k,k,a)));!l||null==e&&!m?c.setStroke(h):c.setStroke(y.mixin({},h,null!=n?{width:n}:
null,m&&{color:m}));c.setFill(k||g);c.rawNode.setAttribute("vector-effect","non-scaling-stroke")}});