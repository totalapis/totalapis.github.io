// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.4/esri/copyright.txt for details.
//>>built
define("require exports ../../../core/libs/gl-matrix/mat4 ../GeometryUtils ./BackgroundRenderer ./LineRenderer ./FillRenderer ./SymbolRenderer ./TileInfoRenderer ./FadeRecorder".split(" "),function(u,v,e,l,m,n,p,q,r,t){return function(){function d(){this._extrudeRotateVector=new Float32Array([0,0,1]);this._extrudeScaleVector=new Float32Array([1,1,1]);this._state={rotation:0,width:0,height:0};this._cachedRotation=this._cachedHeight=this._cachedWidth=0;this._pixelRatio=1}d.prototype.initialize=function(a,
b,c){void 0===c&&(c=!0);this._SpriteMosaic=a;this._glyphMosaic=b;this._ignoreSpeed=!c;this._backgroundRenderer=new m;this._lineRenderer=new n;this._fillRenderer=new p;this._symbolRenderer=new q;this._tileInfoRenderer=new r;this._fadeRecorder=new t.FadeRecorder(300);this._extrudeMatrix=new Float32Array(16);this._extrudeNoRotationMatrix=new Float32Array(16);this._backgroundColor=new Float32Array([1,0,0,1])};d.prototype.dispose=function(){this._backgroundRenderer&&(this._backgroundRenderer.dispose(),
this._backgroundRenderer=null);this._lineRenderer&&(this._lineRenderer.dispose(),this._lineRenderer=null);this._fillRenderer&&(this._fillRenderer.dispose(),this._fillRenderer=null);this._symbolRenderer&&(this._symbolRenderer.dispose(),this._symbolRenderer=null);this._tileInfoRenderer&&(this._tileInfoRenderer.dispose(),this._tileInfoRenderer=null)};d.prototype.setStateParams=function(a,b,c){this._pixelRatio=b;this._fadeRecorder.recordLevel(c);this._state=a;if(this._state.width!==this._cachedWidth||
this._state.height!==this._cachedHeight||this._state.rotation!==this._cachedRotation)this._extrudeScaleVector[0]=2/a.width,this._extrudeScaleVector[1]=-2/a.height,e.identity(this._extrudeMatrix),e.rotate(this._extrudeMatrix,this._extrudeMatrix,-a.rotation*l.C_DEG_TO_RAD,this._extrudeRotateVector),e.scale(this._extrudeMatrix,this._extrudeMatrix,this._extrudeScaleVector),e.transpose(this._extrudeMatrix,this._extrudeMatrix),e.identity(this._extrudeNoRotationMatrix),e.scale(this._extrudeNoRotationMatrix,
this._extrudeNoRotationMatrix,this._extrudeScaleVector),e.transpose(this._extrudeNoRotationMatrix,this._extrudeNoRotationMatrix),this._cachedWidth=this._state.width,this._cachedHeight=this._state.height,this._cachedRotation=this._state.rotation};d.prototype.drawClippingMasks=function(a,b){if(0!==b.length){a.setDepthWriteEnabled(!1);a.setDepthTestEnabled(!1);a.setStencilTestEnabled(!0);a.setBlendingEnabled(!1);a.setColorMask(!1,!1,!1,!1);a.setStencilOp(7680,7680,7681);a.setStencilWriteMask(255);a.setClearStencil(0);
a.clear(a.gl.STENCIL_BUFFER_BIT);for(var c=0;c<b.length;c++){var g=b[c];g.attached&&g.visible&&(a.setStencilFunctionSeparate(1032,519,g.stencilData.reference,g.stencilData.mask),this._backgroundRenderer.renderSolidColor(a,{u_matrix:g.tileTransform.transform,u_normalized_origin:g.tileTransform.displayCoord,u_coord_range:g.coordRange,u_depth:0,u_color:this._backgroundColor}))}a.setColorMask(!0,!0,!0,!0);a.setBlendingEnabled(!0)}};d.prototype.renderDebug=function(a,b){var c=b.key;this._backgroundColor.set([c.col%
2,c.row%2,0===c.col%2&&0===c.row%2?1:0,.5]);this._backgroundRenderer.renderSolidColor(a,{u_matrix:b.tileTransform.transform,u_normalized_origin:b.tileTransform.displayCoord,u_coord_range:b.coordRange,u_depth:0,u_color:this._backgroundColor})};d.prototype.renderBucket=function(a,b,c,g,f,d,h,e){switch(b.type){case 0:2!==f&&this._renderBackground(a,c,f,d,h,e);break;case 1:2!==f&&this._renderFill(a,b,c,f,d,h,e);break;case 2:1===f&&this._renderLine(a,b,c,d,h,e);break;case 3:2===f&&this._renderSymbol(a,
b,c,g,d,h,e)}};d.prototype.renderTileInfo=function(a,b){this._tileInfoRenderer.render(a,b)};d.prototype.needsRedraw=function(){return this._fadeRecorder.needsRedraw()};d.prototype._renderBackground=function(a,b,c,d,f,e){this._backgroundRenderer.render(a,b,c,d,f,this._SpriteMosaic,this._SpriteMosaic.pixelRatio,e)};d.prototype._renderLine=function(a,b,c,d,f,e){this._lineRenderer.render(a,b,c,this._state,d,f,this._SpriteMosaic,this._extrudeMatrix,this._SpriteMosaic.pixelRatio,e)};d.prototype._renderFill=
function(a,b,c,d,e,k,h){this._fillRenderer.render(a,b,c,this._state.rotation,d,e,k,this._SpriteMosaic,this._extrudeMatrix,this._SpriteMosaic.pixelRatio,h)};d.prototype._renderSymbol=function(a,b,c,d,e,k,h){var f=!0;d===e.key.level&&(f=!1);a.setStencilTestEnabled(f);this._symbolRenderer.render(a,b,c,this._state.rotation,this._fadeRecorder.getFadeValues(this._ignoreSpeed),e,k,this._SpriteMosaic,this._glyphMosaic,this._extrudeMatrix,this._extrudeNoRotationMatrix,this._SpriteMosaic.pixelRatio,h)};return d}()});