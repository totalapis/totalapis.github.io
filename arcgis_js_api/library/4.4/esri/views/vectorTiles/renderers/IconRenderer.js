// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.4/esri/copyright.txt for details.
//>>built
define("require exports ../../../core/libs/gl-matrix/mat4 ../../../core/libs/gl-matrix/vec3 ../../webgl/Program ../../webgl/VertexArrayObject ../GeometryUtils ./vtShaderSnippets".split(" "),function(y,z,g,u,v,w,x,h){return function(){function a(){this._attributeLocations={a_pos:0,a_vertexOffset:1,a_tex:2,a_levelInfo:3};this._spritesTextureSize=new Float32Array(2);this._initialized=!1;this._extrudeMat=g.create();this._scaleVec=u.create()}a.prototype.dispose=function(){this._iconProgram&&(this._iconProgram.dispose(),
this._iconProgram=null)};a.prototype.render=function(c,d,b,l,a,m,e,n,p,h,r){var k=this;this._initialized||this._initialize(c);r*=e.getPaintValue("icon-opacity",b);var f=e.getLayoutValue("icon-rotation-alignment",b);1===f&&(1!==e.getLayoutValue("symbol-placement",b)||e.hasLayoutProperty("icon-rotation-alignment")||(f=0));var t=0===f,f=e.getLayoutValue("icon-keep-upright",b)&&t,q=e.getLayoutValue("icon-size",b);l=x.degToByte(l);t?g.copy(this._extrudeMat,p):g.copy(this._extrudeMat,h);1!==q&&(this._scaleVec[0]=
q,this._scaleVec[1]=q,this._scaleVec[2]=1,g.scale(this._extrudeMat,this._extrudeMat,this._scaleVec));c.bindProgram(this._iconProgram);if(p=this._getIconVAO(c,m))c.bindVAO(p),this._iconProgram.setUniformMatrix4fv("u_transformMatrix",m.tileTransform.transform),this._iconProgram.setUniformMatrix4fv("u_extrudeMatrix",this._extrudeMat),this._iconProgram.setUniform2fv("u_normalized_origin",m.tileTransform.displayCoord),this._iconProgram.setUniform1f("u_depth",e.z),this._iconProgram.setUniform1f("u_mapRotation",
l),this._iconProgram.setUniform1f("u_keepUpright",f?1:0),this._iconProgram.setUniform1f("u_level",10*b),this._iconProgram.setUniform1f("u_fadeSpeed",10*a.fadeSpeed),this._iconProgram.setUniform1f("u_minfadeLevel",10*a.minfadeLevel),this._iconProgram.setUniform1f("u_maxfadeLevel",10*a.maxfadeLevel),this._iconProgram.setUniform1f("u_fadeChange",10*(b+a.fadeChange)),this._iconProgram.setUniform1f("u_opacity",r),this._iconProgram.setUniform1i("u_texture",1),d.markerPerPageElementsMap.forEach(function(a,
b){k._spritesTextureSize[0]=n.getWidth(b)/4;k._spritesTextureSize[1]=n.getHeight(b)/4;k._iconProgram.setUniform2fv("u_mosaicSize",k._spritesTextureSize);n.bind(c,9729,b,1);c.drawElements(4,a[1],5125,12*a[0])}),c.bindVAO()};a.prototype._initialize=function(a){if(this._initialized)return!0;this._iconProgram=new v(a,h.iconShaderVS,h.iconShaderFS,this._attributeLocations);this._iconVertexAttributes={geometry:[{name:"a_pos",count:2,type:5122,offset:0,stride:16,normalized:!1,divisor:0},{name:"a_vertexOffset",
count:2,type:5122,offset:4,stride:16,normalized:!1,divisor:0},{name:"a_tex",count:4,type:5121,offset:8,stride:16,normalized:!1,divisor:0},{name:"a_levelInfo",count:4,type:5121,offset:12,stride:16,normalized:!1,divisor:0}]};return this._initialized=!0};a.prototype._getIconVAO=function(a,d){if(d.iconVertexArrayObject)return d.iconVertexArrayObject;var b=d.iconVertexBuffer,c=d.iconIndexBuffer;if(!b||!c)return null;d.iconVertexArrayObject=new w(a,this._attributeLocations,this._iconVertexAttributes,{geometry:b},
c);return d.iconVertexArrayObject};return a}()});