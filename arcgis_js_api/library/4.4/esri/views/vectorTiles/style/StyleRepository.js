// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.4/esri/copyright.txt for details.
//>>built
define(["require","exports","./StyleLayer","dojo/has"],function(l,m,g,k){return function(){function f(a,d){this.styleJSON=a;this.version=parseFloat(a.version);this.sprite=d?d.spriteUrl:a.sprite;this.glyphs=d?d.glyphsUrl:a.glyphs;if(k("stable-symbol-rendering")){var e=(a.layers||[]).filter(function(a){return a.layout&&a.layout["text-font"]})[0];e&&(a.layers||[]).forEach(function(a){a.layout&&a.layout["text-font"]&&(a.layout["text-font"]=e.layout["text-font"])})}this.layers=(a.layers||[]).map(f._create);
this._identifyRefLayers()}f.prototype._identifyRefLayers=function(){for(var a=[],d=[],e=0,f=this.layers;e<f.length;e++){var c=f[e];if(1===c.type){var b=c.sourceLayer,b=b+("|"+JSON.stringify(c.minzoom)),b=b+("|"+JSON.stringify(c.maxzoom)),b=b+("|"+JSON.stringify(c.filter));a.push({key:b,layer:c})}2===c.type&&(b=c.sourceLayer,b+="|"+JSON.stringify(c.minzoom),b+="|"+JSON.stringify(c.maxzoom),b+="|"+JSON.stringify(c.filter),b+="|"+JSON.stringify(c.layout["line-cap"]),b+="|"+JSON.stringify(c.layout["line-join"]),
d.push({key:b,layer:c}))}this._assignRefLayers(a);this._assignRefLayers(d)};f.prototype._assignRefLayers=function(a){a.sort(function(a,b){return a.key<b.key?-1:a.key>b.key?1:0});for(var d,e,f=a.length,c=0;c<f;c++){var b=a[c];if(b.key===d)b.layer.refLayerId=e;else if(d=b.key,e=b.layer.id,1===b.layer.type&&!b.layer.hasPaintProperty("fill-outline-color"))for(var g=c+1;g<f;g++){var h=a[g];if(h.key===d){if(h.layer.hasPaintProperty("fill-outline-color")){a[c]=h;a[g]=b;e=h.layer.id;break}}else break}}};
f._create=function(a,d,e){d=1-1/(e.length+1)*(1+d);switch(a.type){case "background":return new g.StyleLayer(0,a,d);case "fill":return new g.StyleLayer(1,a,d);case "line":return new g.StyleLayer(2,a,d);case "symbol":return new g.StyleLayer(3,a,d);case "raster":throw Error("Unsupported vector tile raster layer");case "circle":throw Error("Unsupported vector tile circle layer");}throw Error("Unknown vector tile layer");};return f}()});