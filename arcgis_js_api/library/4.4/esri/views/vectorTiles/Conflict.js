// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.4/esri/copyright.txt for details.
//>>built
define(["require","exports","./Geometry","./GeometryUtils"],function(l,n,p,q){Object.defineProperty(n,"__esModule",{value:!0});l=function(){function c(a,b,f,d){this.left=a;this.top=b;this.right=f;this.bottom=d}c.prototype.clone=function(){return new c(this.left,this.top,this.right,this.bottom)};c.prototype.move=function(a,b){this.left+=a;this.top+=b;this.right+=a;this.bottom+=b};c.prototype.rotate=function(a,b){var f=this.left,d=this.right,e=this.top,h=this.bottom,g=f*a-e*b,c=f*b+e*a,k=d*a-e*b,e=
d*b+e*a,m=f*a-h*b,f=f*b+h*a,l=d*a-h*b;a=d*b+h*a;this.left=Math.min(g,k,m,l);this.top=Math.min(c,e,f,a);this.right=Math.max(g,k,m,l);this.bottom=Math.max(c,e,f,a)};c.overlaps=function(a,b){return a.right>b.left&&a.left<b.right&&a.bottom>b.top&&a.top<b.bottom};return c}();n.Box=l;var t=function(){function c(a,b,f,d){this.anchor=a;this.corners=b;this.minzoom=f;this.maxzoom=d}c.prototype.left=function(){return this.corners[0].x};c.prototype.right=function(){return this.corners[2].x};c.prototype.top=function(){return this.corners[1].y};
c.prototype.bottom=function(){return this.corners[3].y};return c}();n.Obstacle=t;l=function(){function c(a,b,f){this.obstacles=[];this.mapAngle=a;this.padding=b;this.isScreenAligned=f;this.minzoom=u}c.prototype.addBox=function(a,b,f,d,e,h){var g=b.left*f-this.padding,c=b.top*f-this.padding,k=b.right*f+this.padding;b=b.bottom*f+this.padding;g=[new p.Point(g,c),new p.Point(k,c),new p.Point(k,b),new p.Point(g,b)];0!==this.mapAngle&&(c=Math.cos(this.mapAngle),k=Math.sin(this.mapAngle),a=a.clone(),a.rotate(c,
k));this.isScreenAligned||(d+=this.mapAngle);if(0!==d){c=Math.cos(d);k=Math.sin(d);g[0].rotate(c,k);g[1].rotate(c,k);g[2].rotate(c,k);g[3].rotate(c,k);d=0;for(c=1;4>c;c++)g[c].x<g[d].x?d=c:g[c].x===g[d].x&&g[c].y<g[d].y&&(d=c);if(d){k=[];for(c=0;4>c;c++)k.push(g[(c+d)%4]);g=k}}this.obstacles.push(new t(a,g,e,h))};return c}();n.Footprint=l;var u=.5;l=function(){function c(){this._grid=[]}c.prototype.setAngle=function(a){this._angle=a;this._c=Math.cos(a);this._s=Math.sin(a)};c.prototype.reset=function(){this._angle=
this._s=0;this._c=1;this._grid=[]};c.prototype.add=function(a){var b=this._grid,f=0;for(a=a.obstacles;f<a.length;f++)for(var d=a[f],e=d.anchor,h=c._gridClamp(Math.min(d.left()+e.x,e.x)),g=c._gridClamp(Math.max(d.right()+e.x,e.x)),l=c._gridClamp(Math.min(d.top()+e.y,e.y)),e=c._gridClamp(Math.max(d.bottom()+e.y,e.y));l<=e;l++)for(var k=h;k<=g;k++){var m=b[16*l+k];m||(m=b[16*l+k]=[]);m.push(d)}};c.prototype.getMinZoom=function(a,b,f,d){if(0===a.obstacles.length)return q.C_INFINITY;f=this._grid;d=0;for(a=
a.obstacles;d<a.length;d++)for(var e=a[d],h=e.anchor,g=c._gridClamp(Math.min(e.left()+h.x,h.x)),l=c._gridClamp(Math.max(e.right()+h.x,h.x)),k=c._gridClamp(Math.min(e.top()+h.y,h.y)),h=c._gridClamp(Math.max(e.bottom()+h.y,h.y));k<=h;k++)for(var m=g;m<=l;m++){var n=f[16*k+m];if(n)for(var p=0;p<n.length;p++){var r=n[p];if(!(e.minzoom>=r.maxzoom||r.minzoom>=e.maxzoom)&&(b=c._calcPlacementZoom(e,r,b),2<=b))return q.C_INFINITY}}return 2>b?b:q.C_INFINITY};c._gridClamp=function(a){return q.clamp(a>>9,-7,
8)};c._calcPlacementZoom=function(a,b,f){var d=b.anchor.x-a.anchor.x;if(0===d&&(a.right()<b.left()||b.right()<a.left()))return f;var e=b.anchor.y-a.anchor.y;if(0===e&&(a.bottom()<b.top()||b.bottom()<a.top()))return f;var h=q.C_INFINITY;if(0!==d){var g=(0<d?a.right()-b.left():a.left()-b.right())/d;g<h&&(h=g);d=0<d?c._calcExtZoomX(a,b,g):c._calcExtZoomX(b,a,g);d<h&&(h=d)}0!==e&&(d=(0<e?a.bottom()-b.top():a.top()-b.bottom())/e,d<h&&(h=d),e=0<e?c._calcExtZoomY(a,b,d):c._calcExtZoomY(b,a,d),e<h&&(h=e));
if(h<a.minzoom||h<b.minzoom)return f;h=Math.min(h,a.maxzoom,b.maxzoom);h<f&&(h=f);return h};c._calcExtZoomX=function(a,b,f){var d,e,c;if(a.anchor.y+a.corners[2].y/f<b.anchor.y+b.corners[0].y/f){d=a.corners[2].x-a.corners[3].x;c=a.corners[2].y-a.corners[3].y;var g=b.corners[1].x-b.corners[0].x;e=b.corners[1].y-b.corners[0].y;0<=d*e-c*g?a.anchor.y+a.corners[3].y/f<b.anchor.y+b.corners[0].y/f?(f=a.corners[3],d=b.corners[0],e=b.corners[1],c=1):(f=b.corners[0],d=a.corners[3],e=a.corners[2],c=-1):a.anchor.y+
a.corners[2].y/f>b.anchor.y+b.corners[1].y/f?(f=a.corners[2],d=b.corners[0],e=b.corners[1],c=1):(f=b.corners[1],d=a.corners[3],e=a.corners[2],c=-1)}else d=a.corners[2].x-a.corners[1].x,c=a.corners[2].y-a.corners[1].y,g=b.corners[3].x-b.corners[0].x,e=b.corners[3].y-b.corners[0].y,0>d*e-c*g?a.anchor.y+a.corners[1].y/f>b.anchor.y+b.corners[0].y/f?(f=a.corners[1],d=b.corners[0],e=b.corners[3],c=1):(f=b.corners[0],d=a.corners[1],e=a.corners[2],c=-1):a.anchor.y+a.corners[2].y/f<b.anchor.y+b.corners[3].y/
f?(f=a.corners[2],d=b.corners[0],e=b.corners[3],c=1):(f=b.corners[3],d=a.corners[1],e=a.corners[2],c=-1);g=e.x-d.x;e=e.y-d.y;return c*((f.y-d.y)*g-(f.x-d.x)*e)/((a.anchor.x-b.anchor.x)*e-(a.anchor.y-b.anchor.y)*g)};c._calcExtZoomY=function(a,b,c){var d,e,f;if(a.anchor.x+a.corners[3].x/c<b.anchor.x+b.corners[1].x/c){d=a.corners[3].x-a.corners[2].x;f=a.corners[3].y-a.corners[2].y;var g=b.corners[0].x-b.corners[1].x;e=b.corners[0].y-b.corners[1].y;0>d*e-f*g?a.anchor.x+a.corners[2].x/c<b.anchor.x+b.corners[1].x/
c?(c=a.corners[2],d=b.corners[1],e=b.corners[0],f=1):(c=b.corners[1],d=a.corners[2],e=a.corners[3],f=-1):a.anchor.x+a.corners[3].x/c>b.anchor.x+b.corners[0].x/c?(c=a.corners[3],d=b.corners[1],e=b.corners[0],f=1):(c=b.corners[0],d=a.corners[2],e=a.corners[3],f=-1)}else d=a.corners[3].x-a.corners[0].x,f=a.corners[3].y-a.corners[0].y,g=b.corners[2].x-b.corners[1].x,e=b.corners[2].y-b.corners[1].y,0<d*e-f*g?a.anchor.x+a.corners[0].x/c>b.anchor.x+b.corners[1].x/c?(c=a.corners[0],d=b.corners[1],e=b.corners[2],
f=1):(c=b.corners[1],d=a.corners[0],e=a.corners[3],f=-1):a.anchor.x+a.corners[3].x/c<b.anchor.x+b.corners[2].x/c?(c=a.corners[3],d=b.corners[1],e=b.corners[2],f=1):(c=b.corners[2],d=a.corners[0],e=a.corners[3],f=-1);g=e.x-d.x;e=e.y-d.y;return f*((c.y-d.y)*g-(c.x-d.x)*e)/((a.anchor.x-b.anchor.x)*e-(a.anchor.y-b.anchor.y)*g)};return c}();n.ConflictEngine=l});