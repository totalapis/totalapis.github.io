// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.4/esri/copyright.txt for details.
//>>built
define(["../../../core/declare","../support/RenderCoordsHelper","../lib/glMatrix","../webgl-engine/lib/Selector"],function(l,k,m,n){var e=m.vec3d,g=e.create(),f=e.create();return l([],{constructor:function(c,a){this.navigation=c;this.pickAlongRay=a._pickRay.bind(a);this.createPickRay=a._pickRayWithBeginPoint.bind(a);this.selector=new n(a.viewingMode)},pickPointInScreen:function(c,a){return this.pickedIntersectionPoint(this.pickInScreen(c,!1),a)},pickFreePointInScreen:function(c,a){this.createPickRay(c,
void 0,this.navigation.currentCamera.viewMatrix,g,f);a||(a=e.create());e.subtract(f,g);e.normalize(f);var b=this.navigation.view.dataExtent;c=Math.max(b.xmax-b.xmin,b.ymax-b.ymin,8*Math.max(b.xmax-b.xmin,b.ymax-b.ymin));var d=this.navigation.currentCamera,h=Math.max(0,b.xmin-d.eye[0],d.eye[0]-b.xmax),b=Math.max(0,b.ymin-d.eye[1],d.eye[1]-b.ymax),h=Math.sqrt(h*h+b*b),b="global"==this.navigation.view.viewingMode?k.Spherical.prototype.getAltitude(d.eye):k.Planar.prototype.getAltitude(d.eye),d=this.navigation._getTerrainElevationBelowCamera(d),
d=c/Math.max(1,Math.pow(Math.max(0,Math.log(c/(Math.abs(b-d)+Number.MIN_VALUE))),2)),d=Math.max(d,Math.min(h,c));e.scale(f,d);e.add(g,f,a)},pickInScreen:function(c,a){this.createPickRay(c,void 0,this.navigation.currentCamera.viewMatrix,g,f);a&&e.set(this.navigation.currentCamera.eye,g);return this.pickAlongRay(g,f,c,c,null,null,this.selector)},pickedIntersectionPoint:function(c,a){if(!c)return!1;a||(a=e.create());return c.getMinResult().getIntersectionPoint(a)}})});