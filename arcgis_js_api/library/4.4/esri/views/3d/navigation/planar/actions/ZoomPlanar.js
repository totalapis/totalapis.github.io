// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.4/esri/copyright.txt for details.
//>>built
define(["./ActionPlanar","../../mixins/ZoomMixin","../../../lib/glMatrix","../../../webgl-engine/lib/Util"],function(n,p,m,q){var r=m.vec2d,a=m.vec3d,g=a.create(),k=a.create(),f=a.create(),h=a.create(),l=a.create(),c=a.create();return n.createSubclass([p],{declaredClass:"esri.views.3d.navigation.planar.actions.ZoomPlanar",begin:function(b){this.inherited(arguments);this.pickPointInScreen(b,l)||this.pickFreePointInScreen(b,l);a.normalize(a.subtract(this.targetCamera.eye,this.targetCamera.center,h));
0>h[1]&&a.negate(h);this.updatePlane(l,h)},update:function(b){a.set(this.targetCamera.center,c);this.createPickRay(this._dragBeginPoint,this._dragBeginPoint,this.currentCamera.viewMatrix,g,k);a.subtract(k,g);q.rayPlane(g,k,this._plane,c);this.normalizeCoordinate(b,g);b=4*(this.normalizedAnchorPoint[1]-g[1]);r.set(g,this.normalizedAnchorPoint);this._applyZoom(c,b);b=this._toYDownCoord(this._dragLastPoint);this.emit("update",b[0],b[1])},_applyZoom:function(b,e){a.subtract(b,this.targetCamera.eye,f);
var d=a.length(f),c=d*(1-e);0<=e&&c<this.minPoiDist&&(c=this.minPoiDist);c=this.limitAltitude(c,b,f,d);1E-6>Math.abs(d-c)||(e=-(c-d)/d,a.scale(f,e),a.add(this.targetCamera.eye,f),a.lerp(this.targetCamera.center,b,e),this.fixTargetUpVector(),this.targetAndCurrentChanged())},stepAtPoint:function(b,e,d,g){a.set(e,c);a.subtract(c,this.targetCamera.eye,f);e=a.length(f);d=e*b;1>=b&&d<this.minPoiDist&&(d=this.minPoiDist);d=this.limitAltitude(d,c,f,e);b=d/e;1E-6<=Math.abs(e-d)&&(a.scale(f,d/e),a.subtract(c,
f,this.targetCamera.eye),a.lerp(this.targetCamera.center,c,1-b),this.constrainTargetEyeByElevation(),this.fixTargetUpVector(),this.targetAnimatedChanged(!1,{internalUpdate:!0}))}})});