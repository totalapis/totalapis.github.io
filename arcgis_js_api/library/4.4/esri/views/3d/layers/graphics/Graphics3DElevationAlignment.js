// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.4/esri/copyright.txt for details.
//>>built
define(["require","exports"],function(m,n){return function(){function a(){this.elevationDirtyGraphicsQueue=[];this.elevationDirtyGraphicsSet={};this.elevationUpdateEventHandle=null;this.eventHandles=[];this.updateElevation=!1;this.graphicsCore=this.layerView=null}a.prototype.initialize=function(b,a,c,e){var k=this;this.layerView=b;this.graphicsCore=c;this.elevationProvider=e;this.getGraphicsInExtent=a;this.elevationUpdateEventHandle=e.on("elevation-change",function(b){return k.elevationUpdateHandler(b)});
this.eventHandles.push(this.layerView.watch("suspended",function(){return k.suspendedChange()}))};a.prototype.destroy=function(){this.elevationDirtyGraphicsSet=this.elevationDirtyGraphicsQueue=null;this.elevationUpdateEventHandle&&(this.elevationUpdateEventHandle.remove(),this.elevationUpdateEventHandle=null);this.eventHandles.forEach(function(b){return b.remove()});this.getGraphicsInExtent=this.graphicsCore=this.layerView=this.eventHandles=null};a.prototype.clear=function(){this.elevationDirtyGraphicsSet=
{};this.elevationDirtyGraphicsQueue=[]};a.prototype.suspendedChange=function(){!0===this.layerView.suspended?this.updateElevation=!1:!1===this.layerView.suspended&&this.updateElevation&&this.markAllGraphicsElevationDirty()};a.prototype.isUpdating=function(){return 0<this.elevationDirtyGraphicsQueue.length};a.prototype.numNodesUpdating=function(){return this.elevationDirtyGraphicsQueue.length};a.prototype.needsIdleUpdate=function(){return this.elevationProvider&&0<this.elevationDirtyGraphicsQueue.length};
a.prototype.idleUpdate=function(b){if(!b.done()){var a=this.layerView.view,c=this.elevationDirtyGraphicsQueue.length;if(0<c){for(var e=this.graphicsCore.stageLayer.getId(),h=this.graphicsCore.labelStageLayer?this.graphicsCore.labelStageLayer.getId():null,f=0,d=0,d=0;d<c;d++){var l=this.elevationDirtyGraphicsQueue[d],g=this.graphicsCore.graphics[l];g&&g.alignWithElevation(this.elevationProvider,a.renderCoordsHelper);delete this.elevationDirtyGraphicsSet[l];f++;if(20<=f){a._stage.processDirtyLayer(e);
null!=h&&a._stage.processDirtyLayer(h);if(b.done())break;f=0}}a._stage.processDirtyLayer(e);null!=h&&a._stage.processDirtyLayer(h);this.elevationDirtyGraphicsQueue.splice(0,d+1);a.deconflictor.setDirty();this.layerView._evaluateUpdatingState()}}};a.prototype.markAllGraphicsElevationDirty=function(){for(var b in this.graphicsCore.graphics)this.markGraphicElevationDirty(this.graphicsCore.graphics[b].graphic.uid);this.layerView._evaluateUpdatingState()};a.prototype.markGraphicElevationDirty=function(b){this.elevationDirtyGraphicsSet[b]||
(this.elevationDirtyGraphicsSet[b]=!0,this.elevationDirtyGraphicsQueue.push(b))};a.prototype.elevationUpdateHandler=function(b){var a=this,c=b.extent;this.layerView.suspended?this.updateElevation||(b=this.graphicsCore.computedExtent)&&c[2]>b.xmin&&c[0]<b.xmax&&c[3]>b.ymin&&c[1]<b.ymax&&(this.updateElevation=!0):-Infinity===c[0]?this.markAllGraphicsElevationDirty():this.getGraphicsInExtent(c,b.spatialReference,function(b,c){for(var f=!1,d=0;d<c;d++){var e=b[d],g=a.graphicsCore.graphics[e];g&&g.needsElevationUpdates()&&
(a.markGraphicElevationDirty(e),f=!0)}f&&a.layerView._evaluateUpdatingState()})};return a}()});