// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.4/esri/copyright.txt for details.
//>>built
define("require exports ../../../../geometry/Point ../../../../symbols/callouts/calloutUtils ../../../../geometry/support/mathUtils ./graphicUtils ../../support/projectionUtils ../../lib/glMatrix ../../webgl-engine/lib/Object3D".split(" "),function(C,e,y,M,D,E,v,F,N){function z(b,a,d,c){var g=0,t=a.z||0,f=0,f=d.mode,h=d.offset||0;"on-the-ground"===f?(g=f=b.getElevation(a,"ground")||0,c&&(c.verticalDistanceToGround=0,c.terrainElevation=f)):"relative-to-ground"===f?(f=b.getElevation(a,"ground")||0,
g=h,null==d.featureExpression&&(g+=t),c&&(c.verticalDistanceToGround=g,c.terrainElevation=f),g+=f):"relative-to-scene"===f?(f=b.getElevation(a,"scene")||0,g=h,c&&(c.verticalDistanceToGround=g,c.terrainElevation=f),g+=f):"absolute-height"===f&&(g=t+h,c&&(f=b.getElevation(a,"ground")||0,c.verticalDistanceToGround=g-f,c.terrainElevation=f));return g}function G(b,a,d,c,g,t,f){var h=f.mode,e=f.offset,m=0,l=0,n=0;q.spatialReference=b.spatialReference;d*=3;g*=3;for(var k=0;k<t;++k)q.x=a[d+0],q.y=a[d+1],
q.z=a[d+2],"on-the-ground"===h?(l=m=b.getElevation(q)||0,n+=m):"relative-to-ground"===h?(m=b.getElevation(q)||0,l=m+e,null==f.featureExpression&&(l+=q.z),n+=m):"relative-to-scene"===h?(m=b.getElevation(q,"scene")||0,l=m+e,n+=m):"absolute-height"===h&&(l=q.z+e),c[g+0]=a[d+0],c[g+1]=a[d+1],c[g+2]=l,d+=3,g+=3;return{terrainElevation:n/t}}function H(b,a,d,c,g){var e=0,f;if(b.metadata.usesVerticalDistanceToGround)e=z(g,a,d,u),E.updateVertexAttributeAuxpos1w(b,u.verticalDistanceToGround),f=u.terrainElevation;
else{var h="absolute-height"!==d.mode,e=z(g,a,d,h?u:null);h&&(f=u.terrainElevation)}d=b.getObjectTransformation();k[0]=a.x;k[1]=a.y;k[2]=e;v.computeLinearTransformation(a.spatialReference,k,d,c)?b.setObjectTransformation(d):console.warn("Could not locate symbol object properly, it might be misplaced");return{terrainElevation:f}}function I(b){for(var a=0,d=b.length-1,c=0;c<d;c++)a+=b[c][0]*b[c+1][1]-b[c+1][0]*b[c][1];return 0<=a}function w(b,a,d,c,g,e){c*=3;for(var f=0;f<g;++f){var h=b[a++];d[c++]=
h[0];d[c++]=h[1];d[c++]=e?h[2]:0}return c/3}function A(b,a){for(var d=b.length,c=Array(d),g=Array(d),e=Array(d),f=0,h=0,k=0,m=0,l=0;l<d;++l)m+=b[l].length;for(var m=new Float64Array(3*m),n=0,q=d-1;0<=q;q--){var p=b[q];if(I(p))c[f++]=p;else{for(var r=p.length,l=0;l<f;++l)r+=c[l].length;l={index:n,pathLengths:Array(f+1),count:r,holeIndices:Array(f)};l.pathLengths[0]=p.length;0<p.length&&(e[k++]={index:n,count:p.length});n=w(p,0,m,n,p.length,a);for(p=0;p<f;++p)r=c[p],l.holeIndices[p]=n,l.pathLengths[p+
1]=r.length,0<r.length&&(e[k++]={index:n,count:r.length}),n=w(r,0,m,n,r.length,a);f=0;0<l.count&&(g[h++]=l)}}for(p=0;p<f;++p)r=c[p],0<r.length&&(e[k++]={index:n,count:r.length}),n=w(r,0,m,n,r.length,a);h<d&&(g.length=h);k<d&&(e.length=k);return{vertexData:m,polygons:g,outlines:e}}function J(b,a,d,c,g){a*=3;c*=3;for(var e=0;e<g;++e)d[c++]=b[a++],d[c++]=b[a++],d[c++]=b[a++]}function B(b,a,d,c,g,e,f){v.bufferToBuffer(b,d,a,c,e,g,f)}function x(b,a,d){v.pointToVector(b,a,d)}function K(b,a){return!(b[0]>
a[3]||b[0]<a[0]||b[1]>a[4]||b[1]<a[1])}function L(b,a){return!(a[0]>b[3]||a[3]<b[0]||a[1]>b[4]||a[4]<b[1])}Object.defineProperty(e,"__esModule",{value:!0});C=F.mat4d;var k=F.vec3d.create(),O=C.identity(),q=new y({x:0,y:0,z:0,spatialReference:null});e.createStageObjectForPoint=function(b,a,d,c,g,e,f,h,q,m,l){var n=a?a.length:0,t=this._context.clippingExtent;x(b,k,this._context.elevationProvider.spatialReference);if(t&&!K(k,t))return null;x(b,k,this._context.renderSpatialReference);t=this._context.localOriginFactory.getOrigin(k);
f=new N({castShadow:!1,metadata:{layerId:h,graphicId:q,usesVerticalDistanceToGround:!!m},idHint:f});for(h=0;h<n;h++)f.addGeometry(a[h],d[h],c?c[h]:O,g,t,l);b=H(f,b,e,this._context.renderSpatialReference,this._context.elevationProvider);return{object:f,terrainElevation:b.terrainElevation}};e.extendPointGraphicElevationInfo=function(b,a,d){b=b.elevationInfo;d=d.spatialReference;x(a,k,d);b.centerPointInElevationSR=new y({x:k[0],y:k[1],z:a.hasZ?k[2]:0,spatialReference:d})};e.placePointOnPolyline=function(b){var a=
b.paths[0],a=D.getPointOnPath(a,D.getPathLength(a)/2);return new y({x:a[0],y:a[1],z:a[2],spatialReference:b.spatialReference})};e.placePointOnPolygon=function(b){return E.computeCentroid(b)};e.computeElevation=z;e.applyElevation=G;e.setObjectElevation=H;e.getSingleSizeDriver=function(b,a){void 0===a&&(a=0);return isFinite(b[a])?b[a]:null};e.isCounterClockwise=I;e.copyPointData=w;e.copyPathData=A;e.copyVertices=J;e.chooseOrigin=function(b,a,d,c){a=Math.floor(a+(d-1)/2);c[0]=b[3*a+0];c[1]=b[3*a+1];
c[2]=b[3*a+2]};e.subtractCoordinates=function(b,a,d,c){a*=3;for(var g=0;g<d;++g)b[a++]-=c[0],b[a++]-=c[1],b[a++]-=c[2]};e.setZ=function(b,a,d,c){a*=3;for(var g=0;g<d;++g)b[a+2]=c,a+=3};e.offsetZ=function(b,a,d,c){a*=3;for(var g=0;g<d;++g)b[a+2]+=c,a+=3};e.scaleZ=function(b,a,d,c){a*=3;for(var g=0;g<d;++g)b[a+2]*=c,a+=3};e.flatArrayToArrayOfArrays=function(b,a,d){var c=[];a*=3;for(var g=0;g<d;++g)c.push([b[a++],b[a++],b[a++]]);return c};e.reproject=B;e.reprojectPoint=x;e.getGeometryVertexData3D=function(b,
a,d,c,g,e){var f=g.spatialReference;b=A(b,a);a=b.vertexData;var h=a.length/3,k=new Float64Array(a.length);d.equals(f)?J(a,0,k,0,a.length):B(a,0,d,k,0,f,h);d=G(g,k,0,a,0,h,e);f.equals(c)||B(a,0,f,a,0,c,h);return{geometryData:b,vertexData:a,eleVertexData:k,terrainElevation:d.terrainElevation}};e.getGeometryVertexDataDraped=function(b,a,d){b=A(b,!1);var c=b.vertexData,e=c.length/3;a.equals(d)||v.bufferToBuffer(c,a,0,c,d,0,e);return{geometryData:b,vertexData:c}};e.computeBoundingBox=function(b,a,d,c){c[0]=
Number.MAX_VALUE;c[1]=Number.MAX_VALUE;c[2]=Number.MAX_VALUE;c[3]=-Number.MAX_VALUE;c[4]=-Number.MAX_VALUE;c[5]=-Number.MAX_VALUE;a*=3;for(var e=0;e<d;++e){var k=b[a++],f=b[a++],h=b[a++];k<c[0]&&(c[0]=k);f<c[1]&&(c[1]=f);h<c[2]&&(c[2]=h);k>c[3]&&(c[3]=k);f>c[4]&&(c[4]=f);h>c[5]&&(c[5]=h)}return c};e.pointInBox2D=K;e.boxesIntersect2D=L;e.boundingBoxClipped=function(b,a){return a?!L(b,a):!1};e.needsElevationUpdates2D=function(b){return"relative-to-ground"===b||"relative-to-scene"===b};e.needsElevationUpdates3D=
function(b){return"absolute-height"!==b};e.needsOffsetAdjustment=function(b,a,d){return M.isCalloutSupport(d)&&d.hasVisibleVerticalOffset()?!1:"relative-to-ground"===b.mode&&0===b.offset&&(!a.hasZ||b.featureExpression)||"relative-to-scene"===b.mode&&0===b.offset?!0:!1};var u={verticalDistanceToGround:0,terrainElevation:0}});