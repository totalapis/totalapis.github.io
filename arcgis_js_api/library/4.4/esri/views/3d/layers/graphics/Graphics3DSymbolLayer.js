// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.4/esri/copyright.txt for details.
//>>built
define("require exports ../../../../core/tsSupport/extendsHelper dojo/_base/lang ../../support/PromiseLightweight ./ElevationInfo ./graphicUtils ./Graphics3DSymbolCommonCode ./constants ../../../../core/Logger ../../../../Color".split(" "),function(y,z,n,f,p,h,k,q,r,t,u){function l(c,b){c=null!=c?b.attributes[c]:0;null!=c&&isFinite(c)||(c=0);return c}var c=new h,v=t.getLogger("esri.symbols.Symbol3D"),w={mode:"on-the-ground",offset:0},x={mode:"absolute-height",offset:0};return function(m){function b(a,
d,g,b){var e=m.call(this)||this;e._elevationOptions={supportsOffsetAdjustment:!1,supportsOnTheGround:!0};e.symbolContainer=a;e.symbol=d;e._context=g;e._symbolLayerOrder=g.layerOrder;e._symbolLayerOrderDelta=g.layerOrderDelta;e._elevationInfo=new h;e._material=null;e._updateDrivenProperties(b);e._updateElevationInfo();e._prepareResources();return e}n(b,m);b.prototype._logWarning=function(a){v.warn(a)};b.prototype._prepareResources=function(a){throw Error("This is an abstract base class");};b.prototype._defaultElevationInfoNoZ=
function(){return w};b.prototype._defaultElevationInfoZ=function(){return x};b.prototype._updateElevationInfo=function(){for(var a in this._elevationInfo)this._elevationInfo[a]=void 0;if(a=this._context.layer.elevationInfo)this._elevationInfo=f.mixin(this._elevationInfo,a);this.symbol&&this.symbol.elevationInfo&&(this._elevationInfo=f.mixin(this._elevationInfo,this.symbol.elevationInfo))};b.prototype.getGraphicElevationInfo=function(a){var d=a.geometry.hasZ?this._defaultElevationInfoZ():this._defaultElevationInfoNoZ();
c.mode=this._elevationInfo.mode||d.mode;c.offset=null!=this._elevationInfo.offset?this._elevationInfo.offset:d.offset;c.featureExpression=this._elevationInfo.featureExpression;c.hasOffsetAdjustment=!1;this._elevationOptions.supportsOnTheGround||"on-the-ground"!==c.mode||(c.mode="relative-to-ground",c.offset=0,c.featureExpression={value:0});if(!0===this._elevationOptions.needsOffsetAdjustment||null==this._elevationOptions.needsOffsetAdjustment&&this._elevationOptions.supportsOffsetAdjustment&&q.needsOffsetAdjustment(c,
a.geometry,this.symbolContainer))c.offset=r.defaultIconElevationOffset,c.hasOffsetAdjustment=!0;c.offset/=this._context.renderCoordsHelper.unitInMeters;return c};b.prototype._getDrapedZ=function(){return-2};b.prototype._updateDrivenProperties=function(a){var d={color:!1,opacity:!1,size:!1};!a&&(a=this._context.renderer)&&(d.color=!!a.colorInfo,d.size=!!a.sizeInfo,a.visualVariables&&a.visualVariables.forEach(function(a){switch(a.type){case "color":d.color=!0;if(a.colors)for(var b=0;b<a.colors.length;b++){var e=
a.colors[b];e&&(Array.isArray(e)&&3<e.length&&255!==e[3]||void 0!==e.a&&255!==e.a)&&(d.opacity=!0)}if(a.stops)for(b=0;b<a.stops.length;b++)(e=a.stops[b].color)&&(Array.isArray(e)&&3<e.length&&255!==e[3]||void 0!==e.a&&255!==e.a)&&(d.opacity=!0);break;case "opacity":d.opacity=!0;break;case "size":d.size=!0}}));this._drivenProperties=d};b.prototype._isPropertyDriven=function(a){return this._drivenProperties[a]};b.prototype._getLayerOpacity=function(){if(this._context.layerView&&"fullOpacity"in this._context.layerView)return this._context.layerView.fullOpacity;
var a=this._context.layer.opacity;return null==a?1:a};b.prototype._getMaterialOpacity=function(){var a;a=1*this._getLayerOpacity();var b=this.symbol&&this.symbol.material;b&&!this._isPropertyDriven("opacity")&&b.color&&(a*=b.color.a);return a};b.prototype._getMaterialOpacityAndColor=function(){var a=this.symbol&&this.symbol.material,b=this._getMaterialOpacity(),a=!this._isPropertyDriven("color")&&a&&a.color?u.toUnitRGB(a.color):null;return k.mixinColorAndOpacity(a,b)};b.prototype._getVertexOpacityAndColor=
function(a,b,c){var d=this._isPropertyDriven("color")?a.color:null;a=this._isPropertyDriven("opacity")?a.opacity:null;d=k.mixinColorAndOpacity(d,a);c&&(d[0]*=c,d[1]*=c,d[2]*=c,d[3]*=c);return b?new b(d):d};b.prototype._getStageIdHint=function(){return this._context.layer.id+"_symbol"};b.prototype.isFastUpdatesEnabled=function(){return this._fastUpdates&&this._fastUpdates.enabled};b.prototype.setDrawOrder=function(a,b,c){this._material&&(this._material.setRenderPriority(a),c[this._material.getId()]=
!0)};b.prototype.createGraphics3DGraphic=function(a,b){for(var d=2;d<arguments.length;d++);throw Error("This is an abstract base class");};b.prototype.destroy=function(){throw Error("This is an abstract base class");};b.prototype.layerPropertyChanged=function(a,b,c){return!1};b.prototype.applyRendererDiff=function(a,b,c,f){return!1};b.prototype._getFastUpdateAttrValues=function(a){if(!this._fastUpdates.enabled)return null;var b=this._fastUpdates.visualVariables,c=b.size?l(b.size.field,a):0;a=b.color?
l(b.color.field,a):0;return[c,a,0,0]};return b}(p.Promise)});