// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.4/esri/copyright.txt for details.
//>>built
define("require exports ../../../../core/tsSupport/generatorHelper ../../../../core/tsSupport/awaiterHelper ../../../../core/watchUtils ../../../../core/arrayUtils ../../../../core/Error ../../../../core/Logger ../../../../core/promiseUtils ../../support/projectionUtils ../../../../renderers/UniqueValueRenderer ../../../../renderers/support/rendererConversion ../../../../renderers/support/diffUtils ../../../../geometry/Point ../../../../geometry/Extent ../../webgl-engine/Stage ../../webgl-engine/lib/Util ../../webgl-engine/lib/Layer ../../webgl-engine/lib/FloatingBoxLocalOriginFactory ../../../../symbols/WebStyleSymbol ../../../../symbols/LabelSymbol3D ../../../../symbols/TextSymbol ../../../../symbols/support/symbolConversion ../../lib/glMatrix ./Graphics3DGraphic ./Graphics3DWebStyleSymbol ./graphicUtils ./Graphics3DSymbolFactory ./Graphics3DOwner ./ElevationQuery ../../support/aaBoundingBox ../../support/mathUtils dojo/Deferred".split(" "),
function(z,aa,G,H,w,I,A,u,J,r,v,K,L,M,N,x,O,B,P,Q,C,R,D,E,S,T,U,V,W,X,Y,q,Z){z=E.vec3d;var t=new M,y=z.create(),F=u.getLogger("esri.views.3d.LayerView3D");u=function(){function c(){this.graphics={};this.graphicsDrapedIds={};this.graphicsBySymbol={};this.graphicsKeys=[];this.symbols={};this.graphicsWithoutSymbol={};this.computedExtent=null;this.symbolCreationContext=new W.Graphics3DSymbolCreationContext;this.hasDraped=!1;this.updatingGraphicIds=new Set;this.graphicTransformFunc=this.onComputedExtentChange=
this.stage=this.labelStageLayer=this.stageLayer=this.tilingSchemeHandle=this.lastFastUpdate=null;this.eventHandles=[];this.sharedSymbolResourcesOwnerHandle=this.highlights=this.elevationQueryService=this.labeling=this.spatialIndex=this.scaleVisibility=this.elevation=this.layer=this.layerView=this.viewSR=null;this.whenGraphics3DGraphicRequests={}}c.prototype.initialize=function(a,b,d,h,e,k,g,f,l,p){var m=this;this.layerView=a;this.layer=b;this.viewSR=a.view.spatialReference;this.elevation=d;this.scaleVisibility=
h;this.spatialIndex=e;this.labeling=k;this.highlights=g;this.onComputedExtentChange=f;this.graphicTransformFunc=l;var n=this.layerView.view;this.elevationQueryService=new X.ElevationQuery(this.viewSR,function(){return n.map.ground},{maximumAutoTileRequests:4});this.initializeStage(n,this.layer.id);this.symbolCreationContext.sharedResources=n.sharedSymbolResources;this.sharedSymbolResourcesOwnerHandle=n.sharedSymbolResources.addGraphicsOwner(this);this.symbolCreationContext.renderer=this.layer.renderer;
this.symbolCreationContext.stage=this.stage;this.symbolCreationContext.streamDataSupplier=n.sharedSymbolResources.streamDataSupplier;this.symbolCreationContext.renderSpatialReference=n.renderSpatialReference;this.symbolCreationContext.renderCoordsHelper=n.renderCoordsHelper;this.symbolCreationContext.layer=this.layer;this.symbolCreationContext.layerView=this.layerView;this.symbolCreationContext.layerOrder=0;this.symbolCreationContext.localOriginFactory=c.createLocalOriginFactory();this.symbolCreationContext.elevationProvider=
n.elevationProvider;n.deconflictor.addGraphicsOwner(this);this.symbolCreationContext.screenSizePerspectiveEnabled=n.screenSizePerspectiveEnabled&&this.layer.screenSizePerspectiveEnabled;this.tilingSchemeHandle=w.when(p,"tilingScheme",function(a){a.spatialReference.equals(m.symbolCreationContext.overlaySR)||(m.symbolCreationContext.overlaySR=p.spatialReference,m.recreateAllGraphics())});this.eventHandles.push(this.layerView.watch("suspended",function(){return m.suspendedChange()}));this.eventHandles.push(this.layerView.watch("layer.screenSizePerspectiveEnabled,view.screenSizePerspectiveEnabled",
function(){m.symbolCreationContext.screenSizePerspectiveEnabled=n.screenSizePerspectiveEnabled&&m.layer.screenSizePerspectiveEnabled;m.recreateAllGraphics()}));this.eventHandles.push(w.on(a,"loadedGraphics","change",function(a){return m.graphicsCollectionChanged(a)},function(){m.clearSymbolsAndGraphics();m.graphicsCollectionChanged({added:m.layerView.loadedGraphics.toArray(),removed:[]})}));this.validateRenderer(this.layer.renderer)};c.prototype.destroy=function(){var a=this;this.layerView.view.deconflictor.removeGraphicsOwner(this);
this.clear();if(this.stage){var b=[this.stageLayer.getId()];this.labelStageLayer&&b.push(this.labelStageLayer.getId());this.stage.removeFromViewContent(b);b.forEach(function(b){return a.stage.remove(x.ModelContentType.LAYER,b)});this.stage=this.labelStageLayer=this.stageLayer=null}this.tilingSchemeHandle&&(this.tilingSchemeHandle.remove(),this.tilingSchemeHandle=null);this.eventHandles.forEach(function(a){return a.remove()});this.layerView=this.labeling=this.scaleVisibility=this.viewSR=this.onComputedExtentChange=
this.eventHandles=null;for(var d in this.whenGraphics3DGraphicRequests)this.whenGraphics3DGraphicRequests[d].reject(new A("graphic:layer-destroyed","Layer has been destroyed"));this.whenGraphics3DGraphicRequests=null;this.sharedSymbolResourcesOwnerHandle&&(this.sharedSymbolResourcesOwnerHandle.remove(),this.sharedSymbolResourcesOwnerHandle=null)};c.prototype.clear=function(){var a=!1,b;for(b in this.graphics){var d=this.graphics[b],a=a||d.isDraped();d.destroy()}this.graphics={};this.graphicsKeys=
null;for(var h in this.symbols)(b=this.symbols[h])&&b.destroy();this.symbols={};this.graphicsBySymbol={};this.graphicsWithoutSymbol={};this.hasDraped=!1;a&&this.layerView._notifyDrapedDataChange()};c.prototype.initializeStage=function(a,b){this.stage=a._stage;this.stageLayer=new B(b,{state:this.layerView.suspended?"HIDDEN":"VISIBLE"},b);this.stage.add(x.ModelContentType.LAYER,this.stageLayer);a=[this.stageLayer.getId()];this.labeling&&(this.labelStageLayer=new B(b,{state:this.layerView.suspended?
"HIDDEN":"IGNORED"},b+"_labels"),this.stage.add(x.ModelContentType.LAYER,this.labelStageLayer),a.push(this.labelStageLayer.getId()));this.stage.addToViewContent(a)};c.prototype.setDrawingOrder=function(a){this.symbolCreationContext.layerOrder=a;var b={},d={},h;for(h in this.graphics)this.graphics[h].setDrawOrder(a,b,d);for(var e in d)(d=this.symbols[e])&&d.setDrawOrder(a,b);O.objectEmpty(b)||(this.stage.getTextureGraphicsRenderer().updateRenderOrder(b),this.layerView._notifyDrapedDataChange())};c.prototype.suspendedChange=
function(){!0===this.layerView.suspended?(this.stageLayer.setState("HIDDEN"),this.labelStageLayer&&this.labelStageLayer.setState("HIDDEN"),this.hideAllGraphics()):!1===this.layerView.suspended&&(this.stageLayer.setState("VISIBLE"),this.labelStageLayer&&this.labelStageLayer.setState("IGNORED"),this.updateAllGraphicsVisibility())};c.prototype.getGraphics3DGraphics=function(){return this.graphics};c.prototype.getGraphics3DGraphicById=function(a){return this.graphics[a]};c.prototype.getGraphics3DGraphicsKeys=
function(){null===this.graphicsKeys&&(this.graphicsKeys=Object.keys(this.graphics));return this.graphicsKeys};c.prototype.labelsEnabled=function(){return!(!this.labeling||!this.labeling.layerLabelsEnabled())};c.prototype.getSymbolUpdateType=function(){var a=0,b=0,d=0,h;for(h in this.symbols){var e=this.symbols[h];e&&(e=e.getFastUpdateStatus(),a+=e.loading,d+=e.fast,b+=e.slow)}return 0<a?"unknown":0<=d&&0===b?"fast":0<=b&&0===d?"slow":"mixed"};c.prototype.numNodesUpdating=function(){return this.updatingGraphicIds.size};
c.prototype.needsIdleUpdate=function(){return!!this.lastFastUpdate&&500<performance.now()-this.lastFastUpdate};c.prototype.idleUpdate=function(a){a.done()||(this.lastFastUpdate&&(this.labeling&&this.labeling.updateLabelingInfo(),this.lastFastUpdate=null),this.layerView._evaluateUpdatingState())};c.prototype.whenGraphics3DGraphic=function(a){var b=this.graphics[a.uid];if(b)return J.resolve(b);b=this.whenGraphics3DGraphicRequests[a.uid];b||(b=new Z,this.whenGraphics3DGraphicRequests[a.uid]=b);return b.promise};
c.prototype.boundsForGraphics3DGraphic=function(a){return H(this,void 0,void 0,function(){var b,d,h,e,k,c,f,l,p;return G(this,function(g){switch(g.label){case 0:return b=this.layerView.view.spatialReference,d=this.layerView.view.renderSpatialReference,h=this.layerView.view.basemapTerrain.spatialReference,e=function(a,e,h){return r.bufferToBuffer(a,d,e,a,b,e,h)},k=function(a,d,e){return r.bufferToBuffer(a,h,d,a,b,d,e)},[4,a.getProjectedBoundingBox(e,k,this.elevationQueryService)];case 1:c=g.sent();
if(!c)return[2,null];f=c.boundingBox;c.requiresDrapedElevation&&(l=this.symbolCreationContext.elevationProvider)&&(Y.center(f,y),t.x=y[0],t.y=y[1],t.z=void 0,t.spatialReference=b,p=l.getElevation(t)||0,f[2]=Math.min(f[2],p),f[5]=Math.max(f[5],p));return[2,{boundingBox:f,screenSpaceObjects:c.screenSpaceObjects}]}})})};c.prototype.whenGraphicBounds=function(a){var b=this;return w.whenOnce(this.layerView,"loadedGraphics").then(function(){var d=b.layerView.layer&&b.layerView.layer.objectIdField,h=b.layerView.loadedGraphics.find(function(b){return b===
a||d&&b.attributes&&a.attributes&&b.attributes[d]===a.attributes[d]?!0:!1});if(h)return b.whenGraphics3DGraphic(h);throw new A("internal:graphic-not-part-of-view","Graphic is not part of this view");}).then(function(a){return b.boundsForGraphics3DGraphic(a)})};c.prototype.graphicsCollectionChanged=function(a){var b=this.graphicTransformFunc?this.graphicTransformFunc(a.added):a.added;this.add(b);this.remove(a.removed)};c.prototype.graphicUpdateHandler=function(a){var b=this.graphics[a.graphic.uid];
if(b)switch(a.property){case "visible":b.setVisibilityFlag(0,a.newValue)&&(b.isDraped()&&this.layerView._notifyDrapedDataChange(),this.labeling&&this.layerView.view.deconflictor.setDirty())}};c.prototype.beginGraphicUpdate=function(a){this.updatingGraphicIds.add(a.uid);this.layerView.get("symbolsUpdating")||this.layerView.set("symbolsUpdating",!0);this.layerView._evaluateUpdatingState()};c.prototype.endGraphicUpdate=function(a){a&&this.updatingGraphicIds.delete(a.uid);this.layerView.get("symbolsUpdating")&&
0===this.updatingGraphicIds.size&&(this.layerView.view.flushDisplayModifications(),this.layerView.set("symbolsUpdating",!1));this.layerView._evaluateUpdatingState()};c.prototype.expandComputedExtent=function(a){var b,d,h,e,k,g;if("point"===a.type)b=d=a.x,h=e=a.y,a.z&&(k=g=a.z);else if("polygon"===a.type||"polyline"===a.type||"multipoint"===a.type){g=a.extent;if(!g)return;b=g.xmin;d=g.xmax;h=g.ymin;e=g.ymax;k=g.zmin;g=g.zmax}var f=this.viewSR,l=c.tmpVec;!a.spatialReference.equals(f)&&r.xyzToVector(b,
h,0,a.spatialReference,l,f)&&(b=l[0],h=l[1],r.xyzToVector(d,e,0,a.spatialReference,l,f),d=l[0],e=l[1]);if(q.isFinite(b)&&q.isFinite(d)&&q.isFinite(h)&&q.isFinite(e)){(f=this.computedExtent)?(b<f.xmin&&(f.xmin=b),d>f.xmax&&(f.xmax=d),h<f.ymin&&(f.ymin=h),e>f.ymax&&(f.ymax=e)):this.computedExtent=f=new N(b,h,d,e,a.spatialReference);if(q.isFinite(k)&&!q.isFinite(g)){if(null==f.zmin||k<f.zmin)f.zmin=k;if(null==f.zmax||g>f.zmax)f.zmax=g}this.onComputedExtentChange&&this.onComputedExtentChange()}};c.prototype.updateHasDraped=
function(){this.hasDraped=!1;for(var a in this.graphicsDrapedIds)if(this.graphicsDrapedIds.hasOwnProperty(a)){this.hasDraped=!0;break}};c.prototype.elevationInfoChange=function(){this.labeling&&this.labeling.elevationInfoChange();this.layer.renderer!==this.symbolCreationContext.renderer&&this.rendererChange(this.layer.renderer);for(var a in this.graphicsBySymbol){var b=this.symbols[a],d=this.graphicsBySymbol[a];if(b&&b.layerPropertyChanged("elevationInfo",d))for(var h in d){var e=d[h],b=e.graphic,
e=e._labelGraphics;this.elevation&&this.elevation.markGraphicElevationDirty(b.uid);for(var c=0;c<e.length;c++){var g=e[c];g.graphics3DSymbolLayer.updateGraphicElevationInfo(b,g)}}else this._recreateSymbol(a)}};c.prototype.clearSymbolsAndGraphics=function(){this.clear();this.elevation&&this.elevation.clear();this.labeling&&this.labeling.clear()};c.prototype.recreateAllGraphics=function(){this.clearSymbolsAndGraphics();this.computedExtent=null;this.onComputedExtentChange&&this.onComputedExtentChange();
this.layerView.loadedGraphics&&this.layerView.view.basemapTerrain.tilingScheme&&this.add(this.layerView.loadedGraphics.toArray())};c.prototype._recreateSymbol=function(a){var b=this.graphicsBySymbol[a],d=[],h=!1,e;for(e in b){var c=b[e];c.isDraped()&&(delete this.graphicsDrapedIds[e],h=!0);d.push(c.graphic);c.destroy();delete this.graphics[e]}this.graphicsBySymbol[a]={};(b=this.symbols[a])&&b.destroy();delete this.symbols[a];this.updateHasDraped();h&&this.layerView._notifyDrapedDataChange();this.add(d)};
c.prototype.add=function(a){if(this.layerView.view.basemapTerrain&&this.layerView.view.basemapTerrain.tilingScheme){for(var b=a.length,d=Array(b),h=Array(b),e=Array(b),c=0;c<b;c++){var g=a[c],f=g.geometry;f&&(this.expandComputedExtent(f),(f=this.layerView.getRenderingInfo?this.layerView.getRenderingInfo(g):{symbol:g.symbol})&&f.symbol?(h[c]=f.symbol,e[c]=f,(f=this.getOrCreateGraphics3DSymbol(h[c],f.renderer))?(d[c]=f,this.beginGraphicUpdate(g)):this.graphicsWithoutSymbol[g.uid]=g):this.graphicsWithoutSymbol[g.uid]=
g)}for(c=0;c<b;c++)this.waitForSymbol(d[c],h[c],a[c],e[c])}};c.prototype.waitForSymbol=function(a,b,d,c){var e=this;a&&a.then(function(){e.createGraphics3DGraphic(a,d,c);e.endGraphicUpdate(d);e.labeling&&e.layerView.view.deconflictor.setDirty()},function(){e.endGraphicUpdate(d)})};c.prototype.remove=function(a){for(var b=!1,d=a.length,c=0;c<d;c++){var e=a[c].uid,k=this.graphics[e];if(k){k.isDraped()&&(delete this.graphicsDrapedIds[e],b=!0);var g=k.graphics3DSymbol.symbol.id;k.destroy();delete this.graphics[e];
delete this.graphicsBySymbol[g][e];delete this.graphicsWithoutSymbol[e];this.graphicsKeys=null}}this.updateHasDraped();b&&this.layerView._notifyDrapedDataChange();this.layerView.view.deconflictor.setDirty()};c.prototype.hasLabelingContext=function(a){if(a instanceof C||a instanceof R){var b=this.symbolCreationContext.layer;return b.labelingInfo?b.labelingInfo.some(function(b){return b.symbol===a}):!1}return!1};c.prototype.hasValidSymbolCreationContext=function(a){return a instanceof C&&!this.hasLabelingContext(a)?
(F.error("LabelSymbol3D is only valid as part of a LabelClass. Using LabelSymbol3D as a renderer symbol is not supported."),!1):!0};c.prototype.createGraphics3DSymbol=function(a,b){if(!this.hasValidSymbolCreationContext(a))return null;a=D.to3D(a,!0,!1,this.hasLabelingContext(a));if(a.symbol){var d=void 0;b&&b.backgroundFillSymbol&&(b=D.to3D(b.backgroundFillSymbol,!1,!0),b.symbol&&(d=b.symbol.symbolLayers));return V.make(a.symbol,this.symbolCreationContext,d)}return null};c.prototype.getOrCreateGraphics3DSymbol=
function(a,b){var d=this,c=this.symbols[a.id];void 0===c&&(c=a instanceof Q?new T(a,function(a){return d.createGraphics3DSymbol(a,b)}):this.createGraphics3DSymbol(a,b),this.symbols[a.id]=c);return c};c.prototype.createGraphics3DGraphic=function(a,b,d){if(!this.symbols[a.symbol.id])this.add([b]);else if(!this.graphics[b.uid]){d=a.createGraphics3DGraphic(b,d);this.graphics[b.uid]=d;this.graphicsKeys=null;this.graphicsBySymbol[a.symbol.id]||(this.graphicsBySymbol[a.symbol.id]={});this.graphicsBySymbol[a.symbol.id][b.uid]=
d;d.initialize(this.stageLayer,this.stage);d.isDraped()&&(this.hasDraped=this.graphicsDrapedIds[b.uid]=!0,this.layerView._notifyDrapedDataChange());d.centroid=null;"point"!==b.geometry.type&&d instanceof S&&(d.centroid=U.computeCentroid(b.geometry,this.viewSR));a=this.scaleVisibility&&this.scaleVisibility.scaleRangeActive();this.spatialIndex&&this.spatialIndex.shouldAddToSpatialIndex(b,d,a)&&this.spatialIndex.addGraphicToSpatialIndex(b,d);this.labeling&&this.labeling.layerLabelsEnabled()&&this.labeling.createLabelsForGraphic(b,
d);a&&this.scaleVisibility.updateGraphicScaleVisibility(b,d);d.setVisibilityFlag(0,b.visible&&!this.layerView.suspended);if(a=this.whenGraphics3DGraphicRequests[b.uid])delete this.whenGraphics3DGraphicRequests[b.uid],a.resolve(d);this.highlights&&this.highlights.graphicCreated(d)}};c.prototype.rendererChange=function(a){var b=this.symbolCreationContext.renderer;if(a!==b){this.validateRenderer(a);var d=L.diff(b,a);this.updateUnchangedSymbolMappings(d,a,b);this.symbolCreationContext.renderer=a;d&&("complete"===
d.type?this.recreateAllGraphics():"partial"===d.type&&(this.applyRendererDiff(d,a,b)?this.volatileGraphicsUpdated():this.recreateAllGraphics()))}};c.prototype.diffHasSymbolChange=function(a){for(var b in a.diff)switch(b){case "visualVariables":break;case "defaultSymbol":break;case "uniqueValueInfos":break;case "authoringInfo":case "fieldDelimiter":delete a.diff[b];break;default:return!0}return!1};c.prototype.applySymbolSetDiff=function(a,b,d,c){c=!1;a=a||[];b=b||[];for(var e=[],h=0;h<b.length;h++){var g=
b[h],f=this.graphicsBySymbol[g.id],l;for(l in f){var p=f[l],m=p.graphic;if(g!==d.defaultSymbol||d.getSymbol(m)!==d.defaultSymbol)p.isDraped()&&(delete this.graphicsDrapedIds[l],c=!0),a.length||d.defaultSymbol?e.push(m):this.graphicsWithoutSymbol[l]=m,p.destroy(),this.highlights&&this.highlights.graphicDeleted(this.graphics[l]),delete f[l],delete this.graphics[l],this.graphicsKeys=null}if(void 0===f||0===Object.keys(f).length)delete this.graphicsBySymbol[g.id],(f=this.symbols[g.id])&&f.destroy(),delete this.symbols[g.id]}if(a.length||
e.length){for(l in this.graphicsWithoutSymbol)e.push(this.graphicsWithoutSymbol[l]);this.graphicsWithoutSymbol={};this.add(e)}this.updateHasDraped();c&&this.layerView._notifyDrapedDataChange();this.layerView.view.deconflictor.setDirty()};c.prototype.applyUniqueValueRendererDiff=function(a,b,d){var c=a.diff.defaultSymbol,e=a.diff.uniqueValueInfos;if(c||e){var k=e?e.added.map(function(a){return a.symbol}):[],g=e?e.removed.map(function(a){return a.symbol}):[];if(e)for(var f=0;f<e.changed.length;f++)k.push(e.changed[f].newValue.symbol),
g.push(e.changed[f].oldValue.symbol);c?(d.defaultSymbol&&g.push(d.defaultSymbol),b.defaultSymbol&&k.push(b.defaultSymbol)):d.defaultSymbol&&k.length&&g.push(b.defaultSymbol);this.applySymbolSetDiff(k,g,b,d);delete a.diff.defaultSymbol;delete a.diff.uniqueValueInfos;return!0}return!1};c.prototype.calculateUnchangedSymbolMapping=function(a,b,d){if(b instanceof v&&d instanceof v)if(!a){if(d&&d.defaultSymbol)return[{oldId:d.defaultSymbol.id,newId:b.defaultSymbol.id}]}else if("partial"===a.type){var c=
a.diff;a=c.defaultSymbol;var c=c.uniqueValueInfos,e=void 0,e=c?c.unchanged.map(function(a){return{oldId:a.oldValue.symbol.id,newId:a.newValue.symbol.id}}):d.uniqueValueInfos.map(function(a,d){return{oldId:a.symbol.id,newId:b.uniqueValueInfos[d].symbol.id}});!a&&d.defaultSymbol&&e.push({oldId:d.defaultSymbol.id,newId:b.defaultSymbol.id});return e}return[]};c.prototype.updateUnchangedSymbolMappings=function(a,b,d){var c=0;for(a=this.calculateUnchangedSymbolMapping(a,b,d);c<a.length;c++)if(d=a[c],b=
d.oldId,d=d.newId,b&&b!==d){var e=this.graphicsBySymbol[b];delete this.graphicsBySymbol[b];void 0!==e&&(this.graphicsBySymbol[d]=e);e=this.symbols[b];delete this.symbols[b];void 0!==e&&(this.symbols[d]=e,e.symbol.id=d)}};c.prototype.applyRendererDiff=function(a,b,d){var c=!1;if(this.diffHasSymbolChange(a))return!1;if(b instanceof v&&d instanceof v&&this.applyUniqueValueRendererDiff(a,b,d)&&0===Object.keys(a.diff).length)return!0;for(var e in this.graphicsBySymbol)if(d=this.symbols[e]){var k=this.graphicsBySymbol[e];
if(!d.applyRendererDiff(a,b,k))return!1;if(!c)for(var g in k)if(k[g].isDraped()){this.layerView._notifyDrapedDataChange();c=!0;break}}return!0};c.prototype.opacityChange=function(){var a=!1,b;for(b in this.graphicsBySymbol){var d=this.symbols[b];if(d){var c=this.graphicsBySymbol[b];d.layerPropertyChanged("opacity");if(!a)for(var e in c)if(c[e].isDraped()){this.layerView._notifyDrapedDataChange();a=!0;break}}}};c.prototype.setClippingExtent=function(a,b){var d=this.symbolCreationContext.clippingExtent,
c=[];r.extentToBoundingRect(a,c,b)?this.symbolCreationContext.clippingExtent=[c[0],c[1],-Infinity,c[2],c[3],Infinity]:this.symbolCreationContext.clippingExtent=null;return!I.equals(this.symbolCreationContext.clippingExtent,d)};c.prototype.forEachGraphics3DGraphic=function(a){var b=this;if(this.layerView.loadedGraphics){var d=!1,c=!1;this.layerView.loadedGraphics.forEach(function(e){var h=b.getGraphics3DGraphicById(e.uid);h&&a(h,e)&&(d=!0,c=c||h.isDraped())});d&&this.layerView.view.deconflictor.setDirty();
c&&this.layerView._notifyDrapedDataChange()}};c.prototype.updateAllGraphicsVisibility=function(){var a=this;this.forEachGraphics3DGraphic(function(b,c){var d=b.setVisibilityFlag(0,c.visible),e=!1;a.scaleVisibility&&(e=a.scaleVisibility.updateGraphicScaleVisibility(c,b));return d||e})};c.prototype.hideAllGraphics=function(){this.forEachGraphics3DGraphic(function(a){return a.setVisibilityFlag(0,!1)})};c.prototype.validateRenderer=function(a){(a=K.validateTo3D(a))&&F.warn("Renderer for layer '"+(this.layer.title?
this.layer.title+", ":"")+", id:"+this.layer.id+"' is not supported in a SceneView",a.message)};c.prototype.volatileGraphicsUpdated=function(){this.labeling&&(this.lastFastUpdate=performance.now());this.stageLayer.invalidateSpatialQueryAccelerator();this.stageLayer.shaderTransformationChanged();this.layerView._evaluateUpdatingState()};c.createLocalOriginFactory=function(){return new P(5E6,16)};c.prototype.snapshotInternals=function(){var a=this;return{graphics:Object.keys(this.graphics).sort(),symbols:Object.keys(this.symbols).sort(),
graphicsBySymbol:Object.keys(this.graphicsBySymbol).sort().map(function(b){return{symbolId:b,graphics:Object.keys(a.graphicsBySymbol[b]).sort()}}),graphicsWithoutSymbol:Object.keys(this.graphicsWithoutSymbol).sort(),graphicsDrapedIds:Object.keys(this.graphicsDrapedIds).sort()}};return c}();u.tmpVec=E.vec3d.create();return u});