// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.4/esri/copyright.txt for details.
//>>built
define("require exports ./Texture ./Util ../../../webgl/Texture ../../../webgl/enums".split(" "),function(p,k,w,t,x,B){function u(){var a=document.createElement("canvas");a.width=1024;a.height=1024;return a}function y(a){return"rgb("+a.slice(0,3).map(function(b){return Math.floor(255*b)}).toString()+")"}function z(a){return"rgba("+a.slice(0,3).map(function(b){return Math.floor(255*b)}).toString()+","+a[3]+")"}p=function(){function a(b,a,c){this._idHint=c;this._text=b;this._textLines=b.split(/\r?\n/);
this._params=a;this._haloSize=Math.round(this._params.halo.size);this._fillStyle=z(this._params.color);this._haloStyle=y(this._params.halo.color)}a.prototype.getId=function(){null==this._id&&(this._id=w.idGen.gen(this._idHint));return this._id};a.prototype.getParams=function(){return this._params};a.prototype.getString=function(){return this._text};a.prototype.deferredLoading=function(){return!1};a.prototype.getWidth=function(){if(null!=this._width)return this._width;var b=this.getTextWidth();this._params.usedInAtlas||
(b=t.nextHighestPowerOfTwo(b));return this._width=b};a.prototype.getHeight=function(){if(null!=this._height)return this._height;var b=this.getTextHeight();this._params.usedInAtlas||(b=t.nextHighestPowerOfTwo(b));return this._height=b};a.prototype.initializeThroughRender=function(b,a){var c=this._getTextCanvas(),e=c.getContext("2d");e.save();var f=this.getWidth(),d=this.getHeight(),A=this.getTextWidth(),h=this.getTextHeight();c.width=f;c.height=d;a.samplingMode=9987;a.wrapMode=33071;a.flipped=!0;a.preMultiplyAlpha=
!0;a.hasMipmap=!0;this.renderText(1,A,h,e,0,d-h);b=new x(b,a,c);e.restore();return b};a.prototype.getTextWidth=function(){var a=this._getTextCanvas().getContext("2d");this._setFontProperties(a,this._params.size);for(var d=0,c=0,e=this._textLines;c<e.length;c++){var f=a.measureText(e[c]).width;f>d&&(d=f)}c=this._params.font;if("italic"===c.style||"oblique"===c.style||"string"===typeof c.weight&&("bold"===c.weight||"bolder"===c.weight)||"number"===typeof c.weight&&600<c.weight)d+=.3*a.measureText("A").width;
d+=2*this._haloSize;return Math.round(d)};a.prototype.getTextHeight=function(){return this.getLineHeight()*this._textLines.length};a.prototype.getTexcoordScale=function(){var a=this.getTextWidth(),d=this.getTextHeight();return[a/this.getWidth(),d/this.getHeight()]};a.prototype.getLineHeight=function(){return Math.floor(1.275*this._params.size+2*this._haloSize)};a.prototype.setUnloadFunc=function(a){this._unloadFunc=a};a.prototype.unload=function(){this._unloadFunc&&(this._unloadFunc(this._id),this._unloadFunc=
null)};a.prototype.renderText=function(a,d,c,e,f,g){void 0===f&&(f=0);void 0===g&&(g=0);c=this.getLineHeight()*a;var b=this._haloSize,h=e.textAlign;d=f+("center"===h?.5*d:"right"===h?d:0)+b;h=g+b;e.save();f=3>b;if(0<b){g=h;var k=this._getHaloCanvas(),l=k.getContext("2d");l.clearRect(0,0,1024,1024);this._setFontProperties(l,this._params.size*a);l.fillStyle=this._haloStyle;l.strokeStyle=this._haloStyle;l.lineJoin=f?"miter":"round";if(f)for(var m=0,q=this._textLines;m<q.length;m++){f=q[m];for(var r=
0,n=v;r<n.length;r++){var p=n[r];l.fillText(f,d+b*p[0],h+b*p[1])}g+=c}else for(m=0,q=this._textLines;m<q.length;m++){f=q[m];r=2*b;for(n=0;5>n;n++)l.lineWidth=(.6+.1*n)*r,l.strokeText(f,d,g);g+=c}e.globalAlpha=this._params.halo.color[3];e.drawImage(k,0,0);e.globalAlpha=1}this._setFontProperties(e,this._params.size*a);g=h;a=0;for(b=this._textLines;a<b.length;a++)f=b[a],e.globalCompositeOperation="destination-out",e.fillStyle="rgb(0, 0, 0)",e.fillText(f,d,g),e.globalCompositeOperation="source-over",
e.fillStyle=this._fillStyle,e.fillText(f,d,g),g+=c;e.restore()};a.prototype._getTextCanvas=function(){null==a._textCanvas2D&&(a._textCanvas2D=u());return a._textCanvas2D};a.prototype._getHaloCanvas=function(){null==a._haloCanvas2D&&(a._haloCanvas2D=u());return a._haloCanvas2D};a.prototype._setFontProperties=function(a,d){var b=this._params.font;a.font=b.style+" "+b.weight+" "+d+"px "+b.family;a.textAlign="left";a.textBaseline="top"};return a}();var v=[];for(k=0;360>k;k+=22.5)v.push([Math.cos(Math.PI*
k/180),Math.sin(Math.PI*k/180)]);return p});