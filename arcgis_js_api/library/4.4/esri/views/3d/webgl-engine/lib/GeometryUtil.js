// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.4/esri/copyright.txt for details.
//>>built
define(["./GeometryData","./BufferVectorMath","./Util","./gl-matrix"],function(B,Q,N,O){function P(a,c,b,d,g){if(Math.abs(e.dot(c,a))>g)return!1;e.cross(a,c,b);e.normalize(b);e.cross(b,a,d);e.normalize(d);return!0}var e=O.vec3,Z=O.vec4,R=O.vec3d,l=N.VertexAttrConstants,G=Q.Vec3Compact,H=R.create(),U=R.create(),Y={createSphereGeometry:function(a,c,b,d,g,h,f){a=a||50;d=void 0!==d?d:-Math.PI;g=void 0!==g?g:2*Math.PI;h=void 0!==h?h:.5*-Math.PI;f=void 0!==f?f:Math.PI;var q=Math.max(3,Math.floor(c)||8),
k=Math.max(2,Math.floor(b)||6),n=(q+1)*(k+1);b=new Float32Array(3*n);c=new Float32Array(3*n);var n=new Float32Array(2*n),p,t,v=[],A=e.create(),u=0;for(t=0;t<=k;t++){var m=[],r=t/k,w=h+r*f,C=Math.cos(w);for(p=0;p<=q;p++){var x=p/q,z=d+x*g,M=Math.cos(z)*C*a,D=Math.sin(w)*a,z=-Math.sin(z)*C*a;b[3*u]=M;b[3*u+1]=D;b[3*u+2]=z;e.set3(M,D,z,A);e.normalize(A);c[3*u]=A[0];c[3*u+1]=A[1];c[3*u+2]=A[2];n[2*u]=x;n[2*u+1]=r;m.push(u);++u}v.push(m)}a=new Uint32Array(2*q*(k-1)*3);for(t=u=0;t<k;t++)for(p=0;p<q;p++)d=
v[t][p],g=v[t][p+1],h=v[t+1][p+1],f=v[t+1][p],0===t?(a[u++]=d,a[u++]=h,a[u++]=f):t===k-1?(a[u++]=d,a[u++]=g,a[u++]=h):(a[u++]=d,a[u++]=g,a[u++]=h,a[u++]=h,a[u++]=f,a[u++]=d);N.assert(u===a.length);q={};q[l.POSITION]=a;q[l.NORMAL]=a;q[l.UV0]=a;k={};k[l.POSITION]={size:3,data:b};k[l.NORMAL]={size:3,data:c};k[l.UV0]={size:2,data:n};return new B(k,q)},createPolySphereGeometry:function(a,c,b){function d(b,d){b>d&&(b=d+(d=b,0));var c=b.toString()+"."+d.toString();if(f[c])return f[c];var g=h.length;h.length+=
3;G.add(h,3*b,h,3*d,h,g);G.scale(h,g,a/G.length(h,g));g/=3;return f[c]=g}var g,h;b?(h=[0,-1,0,1,0,0,0,0,1,-1,0,0,0,0,-1,0,1,0],b=[0,1,2,0,2,3,0,3,4,0,4,1,1,5,2,2,5,3,3,5,4,4,5,1]):(b=a*(1+Math.sqrt(5))/2,h=[-a,b,0,a,b,0,-a,-b,0,a,-b,0,0,-a,b,0,a,b,0,-a,-b,0,a,-b,b,0,-a,b,0,a,-b,0,-a,-b,0,a],b=[0,11,5,0,5,1,0,1,7,0,7,10,0,10,11,1,5,9,5,11,4,11,10,2,10,7,6,7,1,8,3,9,4,3,4,2,3,2,6,3,6,8,3,8,9,4,9,5,2,4,11,6,2,10,8,6,7,9,8,1]);for(g=0;g<h.length;g+=3)G.scale(h,g,a/G.length(h,g));var f={};for(g=0;g<c;g++){for(var e=
b.length,k=new Uint32Array(4*e),n=0;n<e;n+=3){var p=b[n],t=b[n+1],v=b[n+2],A=d(p,t),u=d(t,v),m=d(v,p),r=4*n;k[r]=p;k[r+1]=A;k[r+2]=m;k[r+3]=t;k[r+4]=u;k[r+5]=A;k[r+6]=v;k[r+7]=m;k[r+8]=u;k[r+9]=A;k[r+10]=u;k[r+11]=m}b=k;f={}}c=new Float32Array(h);for(g=0;g<c;g+=3)G.normalize(c,g);h=new Float32Array(h);g={};g[l.POSITION]=b;g[l.NORMAL]=b;b={};b[l.POSITION]={size:3,data:h};b[l.NORMAL]={size:3,data:c};return new B(b,g)},createPointGeometry:function(a,c,b,d,g,h,f){var e=new Float32Array(3);e[0]=c?c[0]:
0;e[1]=c?c[1]:0;e[2]=c?c[2]:0;c=new Float32Array(3);c[0]=a?a[0]:0;c[1]=a?a[1]:0;c[2]=a?a[2]:1;if(null==h)a=new Float32Array(2),a[0]=0,a[1]=0;else{a=new Float32Array(h.length);for(var k=0;k<h.length;k++)a[k]=h[k]}h=new Uint8Array(4);h[0]=b?255*b[0]:255;h[1]=b?255*b[1]:255;h[2]=b?255*b[2]:255;h[3]=b&&3<b.length?255*b[3]:255;b=new Float32Array(2);b[0]=null!=d&&2==d.length?d[0]:1;b[1]=null!=d&&2==d.length?d[1]:1;if(null!=g){var n=new Float32Array(4);n[0]=g[0];n[1]=g[1];n[2]=g[2];n[3]=g[3]}if(null!=f){var p=
new Float32Array(4);p[0]=f[0];p[1]=f[1];p[2]=f[2];p[3]=f[3]}k=new Uint32Array(1);k[0]=0;d={};d[l.POSITION]=k;d[l.NORMAL]=k;d[l.UV0]=k;d[l.COLOR]=k;d[l.SIZE]=k;null!=g&&(d[l.AUXPOS1]=k);null!=f&&(d[l.AUXPOS2]=k);k={};k[l.POSITION]={size:3,data:e};k[l.NORMAL]={size:3,data:c};k[l.UV0]={size:a.length,data:a};k[l.COLOR]={size:4,data:h};k[l.SIZE]={size:2,data:b};null!=g&&(k[l.AUXPOS1]={size:4,data:n});null!=f&&(k[l.AUXPOS2]={size:4,data:p});return new B(k,d,B.DefaultOffsets,"point")},createPointArrayGeometry:function(a,
c){for(var b=new Float32Array(3*a.length),d=new Float32Array(c?3*a.length:3),g=new Uint32Array(a.length),h=new Uint32Array(a.length),f=0;f<a.length;f++)b[3*f]=a[f][0],b[3*f+1]=a[f][1],b[3*f+2]=a[f][2],c&&(d[3*f]=c[f][0],d[3*f+1]=c[f][1],d[3*f+2]=c[f][2]),g[f]=f,h[f]=0;c||(d[0]=0,d[1]=1,d[2]=0);a=new Float32Array(2);a[0]=0;a[1]=0;f={};f[l.POSITION]=g;f[l.NORMAL]=c?g:h;f[l.UV0]=h;c={};c[l.POSITION]={size:3,data:b};c[l.NORMAL]={size:3,data:d};c[l.UV0]={size:2,data:a};return new B(c,f,B.DefaultOffsets,
"point")},createTriangleGeometry:function(){var a=new Float32Array(9);a[0]=0;a[1]=0;a[2]=0;a[3]=0;a[4]=0;a[5]=100;a[6]=100;a[7]=0;a[8]=0;var c=new Uint32Array(3);c[0]=0;c[1]=1;c[2]=2;var b=new Float32Array(3);b[0]=0;b[1]=1;b[2]=0;var d=new Uint32Array(3);d[0]=0;d[1]=0;d[2]=0;var g=new Float32Array(2);g[0]=0;g[1]=0;var h=new Uint32Array(3);h[0]=0;h[1]=0;h[2]=0;var f={};f[l.POSITION]=c;f[l.NORMAL]=d;f[l.UV0]=h;c={};c[l.POSITION]={size:3,data:a};c[l.NORMAL]={size:3,data:b};c[l.UV0]={size:2,data:g};return new B(c,
f)},createSquareGeometry:function(a){var c,b,d=new Float32Array(12);if(a)for(c=0;4>c;c++)for(b=0;3>b;b++)d[3*c+b]=a[c][b];else d[0]=-1,d[1]=-1,d[2]=0,d[3]=1,d[4]=-1,d[5]=0,d[6]=1,d[7]=1,d[8]=0,d[9]=-1,d[10]=1,d[11]=0;b=new Uint32Array(6);b[0]=0;b[1]=1;b[2]=2;b[3]=2;b[4]=3;b[5]=0;a=new Float32Array(3);a[0]=0;a[1]=0;a[2]=1;var g=new Uint32Array(6);for(c=0;6>c;c++)g[c]=0;c=new Float32Array(8);c[0]=0;c[1]=0;c[2]=1;c[3]=0;c[4]=1;c[5]=1;c[6]=0;c[7]=1;var h=new Uint8Array(4);h[0]=255;h[1]=255;h[2]=255;h[3]=
255;var f={};f[l.POSITION]=b;f[l.NORMAL]=g;f[l.UV0]=b;f[l.COLOR]=g;b={};b[l.POSITION]={size:3,data:d};b[l.NORMAL]={size:3,data:a};b[l.UV0]={size:2,data:c};b[l.COLOR]={size:4,data:h};return new B(b,f)},createBoxGeometry:function(){var a,c,b=[[-.5,-.5,.5],[.5,-.5,.5],[.5,.5,.5],[-.5,.5,.5],[-.5,-.5,-.5],[.5,-.5,-.5],[.5,.5,-.5],[-.5,.5,-.5]],d=[0,0,1,-1,0,0,1,0,0,0,-1,0,0,1,0,0,0,-1],g=[0,0,1,0,1,1,0,1],h=[0,1,2,2,3,0,4,0,3,3,7,4,1,5,6,6,2,1,1,0,4,4,5,1,3,2,6,6,7,3,5,4,7,7,6,5],f=Array(36);for(a=0;6>
a;a++)for(c=0;6>c;c++)f[6*a+c]=a;var e=Array(36);for(a=0;6>a;a++)e[6*a+0]=0,e[6*a+1]=1,e[6*a+2]=2,e[6*a+3]=2,e[6*a+4]=3,e[6*a+5]=0;return function(a){var c;Array.isArray(a)||(a=[a,a,a]);var k=new Float32Array(24);for(c=0;8>c;c++)k[3*c]=b[c][0]*a[0],k[3*c+1]=b[c][1]*a[1],k[3*c+2]=b[c][2]*a[2];a={};a[l.POSITION]=new Uint32Array(h);a[l.NORMAL]=new Uint32Array(f);a[l.UV0]=new Uint32Array(e);c={};c[l.POSITION]={size:3,data:k};c[l.NORMAL]={size:3,data:new Float32Array(d)};c[l.UV0]={size:2,data:new Float32Array(g)};
return new B(c,a)}}(),createDiamondGeometry:function(){var a=[[-.5,0,-.5],[.5,0,-.5],[.5,0,.5],[-.5,0,.5],[0,-.5,0],[0,.5,0]],c=[0,1,-1,1,1,0,0,1,1,-1,1,0,0,-1,-1,1,-1,0,0,-1,1,-1,-1,0],b=[5,1,0,5,2,1,5,3,2,5,0,3,4,0,1,4,1,2,4,2,3,4,3,0],d=[0,0,0,1,1,1,2,2,2,3,3,3,4,4,4,5,5,5,6,6,6,7,7,7];return function(g){var h;Array.isArray(g)||(g=[g,g,g]);var f=new Float32Array(18);for(h=0;6>h;h++)f[3*h]=a[h][0]*g[0],f[3*h+1]=a[h][1]*g[1],f[3*h+2]=a[h][2]*g[2];g={};g[l.POSITION]=new Uint32Array(b);g[l.NORMAL]=
new Uint32Array(d);h={};h[l.POSITION]={size:3,data:f};h[l.NORMAL]={size:3,data:new Float32Array(c)};return new B(h,g)}}(),createTetrahedronGeometry:function(){var a=e.createFrom(-.5,0,-.5),c=e.createFrom(.5,0,-.5),b=e.createFrom(0,0,.5),d=e.createFrom(0,.5,0),g=e.create(),h=e.create(),f=e.create(),q=e.create(),k=e.create();e.subtract(a,d,g);e.subtract(a,c,h);e.cross(g,h,f);e.normalize(f,f);e.subtract(c,d,g);e.subtract(c,b,h);e.cross(g,h,q);e.normalize(q,q);e.subtract(b,d,g);e.subtract(b,a,h);e.cross(g,
h,k);e.normalize(k,k);var n=[a,c,b,d],p=[0,-1,0,f[0],f[1],f[2],q[0],q[1],q[2],k[0],k[1],k[2]],t=[0,1,2,3,1,0,3,2,1,3,0,2],v=[0,0,0,1,1,1,2,2,2,3,3,3];return function(a){var b;Array.isArray(a)||(a=[a,a,a]);var c=new Float32Array(12);for(b=0;4>b;b++)c[3*b]=n[b][0]*a[0],c[3*b+1]=n[b][1]*a[1],c[3*b+2]=n[b][2]*a[2];a={};a[l.POSITION]=new Uint32Array(t);a[l.NORMAL]=new Uint32Array(v);b={};b[l.POSITION]={size:3,data:c};b[l.NORMAL]={size:3,data:new Float32Array(p)};return new B(b,a)}}(),createConeGeometry:function(a,
c,b,d){var g=0,h=e.createFrom(0,g,0),f=e.createFrom(0,g+a,0),q=e.createFrom(0,-1,0),k=e.createFrom(0,1,0);d&&(g=a,f=e.createFrom(0,0,0),h=e.createFrom(0,g,0),q=e.createFrom(0,1,0),k=e.createFrom(0,-1,0));var h=[f,h],q=[q,k],k=b+2,n=0,f=Math.sqrt(a*a+c*c);if(d)for(d=b-1;0<=d;d--)n=2*Math.PI/b*d,p=e.createFrom(Math.cos(n)*c,g,Math.sin(n)*c),h.push(p),n=e.createFrom(a*Math.cos(n)/f,-c/f,a*Math.sin(n)/f),q.push(n);else for(d=0;d<b;d++){var n=2*Math.PI/b*d,p=e.createFrom(Math.cos(n)*c,g,Math.sin(n)*c);
h.push(p);n=e.createFrom(a*Math.cos(n)/f,c/f,a*Math.sin(n)/f);q.push(n)}a=new Uint32Array(6*(b+2));b=new Uint32Array(6*(b+2));g=c=0;for(d=3;d<h.length;d++)a[c++]=1,a[c++]=d-1,a[c++]=d,b[g++]=0,b[g++]=0,b[g++]=0;a[c++]=h.length-1;a[c++]=2;a[c++]=1;b[g++]=0;b[g++]=0;b[g++]=0;for(d=3;d<h.length;d++)a[c++]=d,a[c++]=d-1,a[c++]=0,b[g++]=d,b[g++]=d-1,b[g++]=1;a[c++]=0;a[c++]=2;a[c++]=h.length-1;b[g++]=1;b[g++]=2;b[g++]=q.length-1;g=1;Array.isArray(g)||(g=[g,g,g]);c=new Float32Array(3*k);for(d=0;d<k;d++)c[3*
d]=h[d][0]*g[0],c[3*d+1]=h[d][1]*g[1],c[3*d+2]=h[d][2]*g[2];h=new Float32Array(3*k);for(d=0;d<k;d++)h[3*d]=q[d][0],h[3*d+1]=q[d][1],h[3*d+2]=q[d][2];q={};q[l.POSITION]=a;q[l.NORMAL]=b;k={};k[l.POSITION]={size:3,data:c};k[l.NORMAL]={size:3,data:h};return new B(k,q)},createCylinderGeometry:function(a,c,b,d,g,h){d||(d=e.createFrom(1,0,0));g||(g=e.createFrom(0,0,0));h=void 0===h?!0:h;var f=e.create();e.normalize(d,f);d=e.create();e.scale(f,Math.abs(a),d);var q=e.create();e.scale(d,-.5,q);e.add(q,g);var k=
e.createFrom(0,1,0);Math.abs(.2>1-e.dot(f,k))&&e.set3(0,0,1,k);var n=e.create();e.cross(f,k,n);e.normalize(n);e.cross(n,f,k);var p=2*b+(h?2:0),t=b+(h?2:0);g=new Float32Array(3*p);a=new Float32Array(3*t);var v=new Float32Array(2*p),A=new Uint32Array(3*b*(h?4:2)),u=new Uint32Array(3*b*(h?4:2));h&&(g[3*(p-2)+0]=q[0],g[3*(p-2)+1]=q[1],g[3*(p-2)+2]=q[2],v[2*(p-2)]=0,v[2*(p-2)+1]=0,g[3*(p-1)+0]=g[3*(p-2)+0]+d[0],g[3*(p-1)+1]=g[3*(p-2)+1]+d[1],g[3*(p-1)+2]=g[3*(p-2)+2]+d[2],v[2*(p-1)]=1,v[2*(p-1)+1]=1,a[3*
(t-2)+0]=-f[0],a[3*(t-2)+1]=-f[1],a[3*(t-2)+2]=-f[2],a[3*(t-1)+0]=f[0],a[3*(t-1)+1]=f[1],a[3*(t-1)+2]=f[2]);var f=function(a,b,c){A[a]=b;u[a]=c},m,r,w=0,C=e.create(),x=e.create();for(m=0;m<b;m++)r=2*Math.PI/b*m,e.scale(k,Math.sin(r),C),e.scale(n,Math.cos(r),x),e.add(C,x),a[3*m+0]=C[0],a[3*m+1]=C[1],a[3*m+2]=C[2],e.scale(C,c),e.add(C,q),g[3*m+0]=C[0],g[3*m+1]=C[1],g[3*m+2]=C[2],v[2*m+0]=m/b,v[2*m+1]=0,g[3*(m+b)+0]=g[3*m+0]+d[0],g[3*(m+b)+1]=g[3*m+1]+d[1],g[3*(m+b)+2]=g[3*m+2]+d[2],v[2*(m+b)+0]=m/b,
v[2*m+1]=1,r=(m+1)%b,f(w++,m,m),f(w++,m+b,m),f(w++,r,r),f(w++,r,r),f(w++,m+b,m),f(w++,r+b,r);if(h){for(m=0;m<b;m++)r=(m+1)%b,f(w++,p-2,t-2),f(w++,m,t-2),f(w++,r,t-2);for(m=0;m<b;m++)r=(m+1)%b,f(w++,m+b,t-1),f(w++,p-1,t-1),f(w++,r+b,t-1)}c={};c[l.POSITION]=A;c[l.NORMAL]=u;c[l.UV0]=A;b={};b[l.POSITION]={size:3,data:g};b[l.NORMAL]={size:3,data:a};b[l.UV0]={size:2,data:v};return new B(b,c)},createTubeGeometry:function(a,c,b,d,g){b=b||10;d=null!=d?d:!0;N.assert(1<a.length);for(var h=[],f=[],e=0;e<b;e++){h.push([0,
-e-1,-((e+1)%b)-1]);var k=e/b*2*Math.PI;f.push([Math.cos(k)*c,Math.sin(k)*c])}return Y.createPathExtrusionGeometry(f,a,[[0,0,0]],h,d,g)},createPathExtrusionGeometry:function(a,c,b,d,g,h){var f,q=a.length,k=new Float32Array(c.length*q*3+(6*b.length||0)),n=new Float32Array(c.length*q+(2*b.length||0)),p=new Float32Array(c.length*q*3+(b?6:0)),t=0,v=0,A=0,u=(c.length-1)*q*6+6*d.length,m=new Uint32Array(u),u=new Uint32Array(u),r=0,w=0,C=e.create(),x=e.create(),z=e.create(),M=e.create();e.create();var D=
e.create();e.create();e.create();var y=e.create(),G=e.create(),E=e.create(),H=e.create(),L=e.create();e.create();e.create();var O=e.create(),V=e.create(),Q=e.create(),S=Z.create();e.set3(0,1,0,H);e.subtract(c[1],c[0],x);e.normalize(x);g?(e.add(c[0],h,E),e.normalize(E,z)):e.set3(0,0,1,z);P(x,z,D,z,.99619469809)||P(x,H,D,z,.99619469809)||P(x,H,D,z,.99619469809);e.set(z,M);e.set(D,V);for(f=0;f<b.length;f++)e.scale(D,b[f][0],y),e.scale(z,b[f][2],E),e.add(y,E),e.add(y,c[0]),k[t++]=y[0],k[t++]=y[1],k[t++]=
y[2],n[A++]=0;p[v++]=-x[0];p[v++]=-x[1];p[v++]=-x[2];for(f=0;f<d.length;f++)m[r++]=0<d[f][0]?d[f][0]:-d[f][0]-1+b.length,m[r++]=0<d[f][1]?d[f][1]:-d[f][1]-1+b.length,m[r++]=0<d[f][2]?d[f][2]:-d[f][2]-1+b.length,u[w++]=0,u[w++]=0,u[w++]=0;var I=b.length;f=b.length-1;for(var T,J=0;J<c.length;J++){T=!1;if(0<J){e.set(x,C);J<c.length-1?(e.subtract(c[J+1],c[J],x),e.normalize(x)):T=!0;e.add(C,x,L);e.normalize(L);e.add(c[J-1],M,O);S[0]=L[0];S[1]=L[1];S[2]=L[2];S[3]=-R.dot(L,c[J]);if(N.rayPlane(O,C,S,E))e.subtract(E,
c[J]),e.normalize(E,z),e.cross(L,z,D),e.normalize(D);else{var F=L,K=V,U=H,W=D,X=z;P(F,M,W,X,.99619469809)||P(F,K,W,X,.99619469809)||P(F,U,W,X,.99619469809)}e.set(z,M);e.set(D,V)}g&&(e.add(c[J],h,E),e.normalize(E,Q));for(F=0;F<q;F++)if(e.scale(D,a[F][0],y),e.scale(z,a[F][1],E),e.add(y,E),e.normalize(y,G),p[v++]=G[0],p[v++]=G[1],p[v++]=G[2],g?n[A++]=e.dot(y,Q):n[A++]=y[2],e.add(y,c[J]),k[t++]=y[0],k[t++]=y[1],k[t++]=y[2],!T)for(K=(F+1)%q,m[r++]=I+F,m[r++]=I+q+F,m[r++]=I+K,m[r++]=I+K,m[r++]=I+q+F,m[r++]=
I+q+K,K=0;6>K;K++)u[w++]=m[r-6+K]-f;I+=q}T=c[c.length-1];for(f=0;f<b.length;f++)e.scale(D,b[f][0],y),e.scale(z,b[f][1],E),e.add(y,E),e.add(y,T),k[t++]=y[0],k[t++]=y[1],k[t++]=y[2],n[A++]=0;a=v/3;p[v++]=x[0];p[v++]=x[1];p[v++]=x[2];q=I-q;for(f=0;f<d.length;f++)m[r++]=0<=d[f][0]?I+d[f][0]:-d[f][0]-1+q,m[r++]=0<=d[f][2]?I+d[f][2]:-d[f][2]-1+q,m[r++]=0<=d[f][1]?I+d[f][1]:-d[f][1]-1+q,u[w++]=a,u[w++]=a,u[w++]=a;d={};d[l.POSITION]=m;d[l.NORMAL]=u;m={};m[l.POSITION]={size:3,data:k};m.zOffset={size:1,data:n};
m[l.NORMAL]={size:3,data:p};return new B(m,d)},createPolylineGeometry:function(a){N.assert(1<a.length,"createPolylineGeometry(): polyline needs at least 2 points");N.assert(3===a[0].length,"createPolylineGeometry(): malformed vertex");for(var c=new Float32Array(3*a.length),b=new Uint32Array(2*(a.length-1)),d=0,g=0,e=0;e<a.length;e++){for(var f=0;3>f;f++)c[d++]=a[e][f];0<e&&(b[g++]=e-1,b[g++]=e)}a={};d={};a[l.POSITION]=b;d[l.POSITION]={size:3,data:c};return new B(d,a,B.DefaultOffsets,"line")},addVertexColors:function(a,
c,b){var d,g,e;if(b){var f={};b=a.getVertexAttr();for(e in b)f[e]=b[e];a=a.getFaces();b=Array(a.length);for(g=0;g<a.length;g++){d={};for(e in a[g].indices)d[e]=a[g].indices[e];b[g]={type:a[g].type,indices:d,positionKey:a[g].positionKey}}a=new B(b,f)}c=c||[1,1,1,1];e=new Uint8Array(4);e[0]=255*c[0];e[1]=255*c[1];e[2]=255*c[2];e[3]=255*(3<c.length?c[3]:1);a.getVertexAttr()[l.COLOR]={size:4,data:e};b=a.getFaces();for(g=0;g<b.length;g++)c=b[g],d=new Uint32Array(c.indices[c.positionKey].length),c.indices[l.COLOR]=
d;return a},addNormals:function(a){var c=a.getVertexAttr();a=a.getFaces();for(var b=Q.Vec3Compact.subtract,d=a.map(function(a){return a.indices.position.length/3}).reduce(function(a,b){return a+b}),d=new Float32Array(3*d),e=c.position.data,h=0,f=0;f<a.length;f++){for(var l=a[f].indices.position,k=new Uint32Array(l.length),n=0;n<l.length;n+=3){b(e,3*l[n],e,3*l[n+2],U,0);b(e,3*l[n],e,3*l[n+1],H,0);R.cross(H,U);R.normalize(H);var p=h/3;d[h++]=H[0];d[h++]=H[1];d[h++]=H[2];k[n]=p;k[n+1]=p;k[n+2]=p}a[f].indices.normal=
k}c.normal={size:3,data:d}},cgToGIS:function(a){var c=a.getVertexAttr();a=c.position.data;var c=c.normal.data,b,d;if(c)for(b=0;b<c.length;b+=3)d=c[b+1],c[b+1]=-c[b+2],c[b+2]=d;if(a)for(b=0;b<a.length;b+=3)d=a[b+1],a[b+1]=-a[b+2],a[b+2]=d}};return Y});