// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.4/esri/copyright.txt for details.
//>>built
define("./TileBase ./TileGeometryFactory ../../../core/ObjectPool ../support/mathUtils ../support/earthUtils ../lib/glMatrix".split(" "),function(h,l,m,n,c,p){var e=p.vec3d,f=c.earthRadius,k=function(a,d,b,g){b=f+b;var c=Math.cos(a);g[0]=Math.cos(d)*c*b;g[1]=Math.sin(d)*c*b;g[2]=Math.sin(a)*b};c=function(a,d,b,g){h.call(this);this.tileUp=e.create();this.obb=Array(8);this._isWebMercator=!1;for(var c=0;8>c;c++)this.obb[c]=e.create();void 0!==a&&this.init(a,d,b,g)};c.prototype=new h;c.prototype.constructor=
c;c.prototype.init=function(a,d,b,g){h.prototype.init.call(this,a,d,b,g);this._isWebMercator=g.spatialReference.isWebMercator;d=this.extentWGS84Rad[0];b=this.extentWGS84Rad[1];g=this.extentWGS84Rad[2];var c=this.extentWGS84Rad[3];a=a[0];var l=n.lerp(b,c,.5),m=n.lerp(d,g,.5);this.edgeLen=(g-d)*Math.cos(0===a?0:Math.min(Math.abs(b),Math.abs(c)))*f;this.curvatureHeight=f-Math.sqrt(f*f-this.edgeLen*this.edgeLen/4);k(l,m,0,this.centerAtSeaLevel);e.set(this.centerAtSeaLevel,this.tileUp);e.normalize(this.tileUp);
this._updateOBB();this.updateRadiusAndCenter()};c.prototype.isVisible=function(a,d){if(!this.intersectsClippingArea)return!1;if(9<this.lij[0]){d=this.obb;for(var b=0;6>b;b++){for(var c=0;8>c&&!(0>a[b][0]*d[c][0]+a[b][1]*d[c][1]+a[b][2]*d[c][2]+a[b][3]);c++);if(8===c)return!1}}else if(d=this.radius,b=this.center,a[0][0]*b[0]+a[0][1]*b[1]+a[0][2]*b[2]+a[0][3]>d||a[1][0]*b[0]+a[1][1]*b[1]+a[1][2]*b[2]+a[1][3]>d||a[2][0]*b[0]+a[2][1]*b[1]+a[2][2]*b[2]+a[2][3]>d||a[3][0]*b[0]+a[3][1]*b[1]+a[3][2]*b[2]+
a[3][3]>d||a[4][0]*b[0]+a[4][1]*b[1]+a[4][2]*b[2]+a[4][3]>d||a[5][0]*b[0]+a[5][1]*b[1]+a[5][2]*b[2]+a[5][3]>d)return!1;return!0};c.prototype.computeElevationBounds=function(){h.prototype.computeElevationBounds.call(this);this._updateOBB()};c.prototype.updateRadiusAndCenter=function(){if(0===this.lij[0])e.set3(0,0,0,this.center),this.radius=f+this.elevationBounds[1];else{h.prototype.updateRadiusAndCenter.call(this);var a=Math.max(e.dist2(this.center,this.obb[0]),e.dist2(this.center,this.obb[1]));this.radius=
Math.sqrt(a)}};c.prototype._numSubdivisionsAtLevel=[128,64,32,16,16,8,8,4];c.prototype.createGeometry=function(a,d,b){var c=this._isPole(this.lij[1],this.lij[0]);a.needsUpdate=!1;return l.createSphericalGlobeTile(a.numVertsPerRow,this.extent,this.extentWGS84Rad,this._isWebMercator,a.samplerData,d,c,b)};c.prototype._updateOBB=function(){var a=this.extentWGS84Rad,d=this.obb,b;for(b=0;2>b;b++){var c=this.elevationBounds[b],h=4*b;k(a[1],a[0],c,d[h++]);k(a[3],a[0],c,d[h++]);k(a[3],a[2],c,d[h++]);k(a[1],
a[2],c,d[h++])}this._isWebMercator&&(a=this._isPole(this.lij[1],this.lij[0]),2===a?(e.set3(0,0,f,d[1]),e.set3(0,0,f,d[2]),e.set3(0,0,f,d[5]),e.set3(0,0,f,d[6])):1===a&&(e.set3(0,0,-f,d[0]),e.set3(0,0,-f,d[3]),e.set3(0,0,-f,d[4]),e.set3(0,0,-f,d[7])))};c.prototype._isPole=function(a,c){var b=0;a===(1<<c)-1&&(b+=1);0===a&&(b+=2);return b};c.Pool=new m(c);return c});