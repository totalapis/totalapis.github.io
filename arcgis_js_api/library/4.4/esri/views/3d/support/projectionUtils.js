// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.4/esri/copyright.txt for details.
//>>built
define("../../../geometry/SpatialReference ../../../geometry/Point ./mathUtils ./earthUtils ../lib/glMatrix ../webgl-engine/lib/BufferVectorMath".split(" "),function(v,F,r,A,B,G){var w=B.vec3d,t=B.mat4d,H=G.Vec3Compact,c=w.create(),h=w.create(),n=w.create(),l=r.deg2rad(1),x=r.rad2deg(1),C,m,D,u,E=new v({wkt:'\r\n      GEOCCS["Spherical geocentric",\r\n        DATUM["Not specified",\r\n          SPHEROID["Sphere",'+A.earthRadius+',0]],\r\n        PRIMEM["Greenwich",0.0,\r\n          AUTHORITY["EPSG","8901"]],\r\n        UNIT["m",1.0],\r\n        AXIS["Geocentric X",OTHER],\r\n        AXIS["Geocentric Y",EAST],\r\n        AXIS["Geocentric Z",NORTH]\r\n      ]\r\n    '}),
g=A.earthRadius,p=function(a){return a===E?1:a.isWGS84?2:a.isWebMercator?3:0};v=function(a,d,b,e){b[e++]=a[d++];b[e++]=a[d++];b[e]=a[d]};var y=function(a,d,b,e){var k=.4999999*Math.PI,c=l*a[d+1],c=r.clamp(c,-k,k),k=Math.sin(c);b[e++]=l*a[d]*g;b[e++]=g/2*Math.log((1+k)/(1-k));b[e]=a[d+2]},z=function(a,d,b,e){var c=g+a[d+2],f=l*a[d+1];a=l*a[d];d=Math.cos(f);b[e++]=Math.cos(a)*d*c;b[e++]=Math.sin(a)*d*c;b[e]=Math.sin(f)*c},I=[void 0,z,v,y],q=[void 0,function(a,d,b,e){var c=H.length(a,d),f=r.asin(a[d+
2]/c);a=(0<a[d+1]?1:-1)*r.acos(a[d]/(Math.cos(f)*c));b[e++]=x*a;b[e++]=x*f;b[e]=c-g},v,function(a,d,b,e){b[e++]=x*(a[d++]/g);b[e++]=x*(Math.PI/2-2*Math.atan(Math.exp(-1*a[d++]/g)));b[e]=a[d]}];return{SphericalRenderSpatialReference:E,vectorToVector:function(a,d,b,e){2===a.length?(c[0]=a[0],c[1]=a[1],c[2]=0,a=c):a===b&&(w.set(a,c),a=c);return this.bufferToBuffer(a,d,0,b,e,0,1)},pointToVector:function(a,d,b){c[0]=a.x;c[1]=a.y;var e=a.z;c[2]=void 0!==e?e:0;return this.bufferToBuffer(c,a.spatialReference,
0,d,b,0,1)},vectorToPoint:function(a,d,b,e){"esri.SpatialReference"===b.declaredClass?(e=b,b=new F({spatialReference:e})):e=e||b.spatialReference;return this.bufferToBuffer(a,d,0,c,e,0,1)?(b.x=c[0],b.y=c[1],b.z=c[2],b.spatialReference=e,b):null},xyzToVector:function(a,d,b,e,k,f){c[0]=a;c[1]=d;c[2]=b;return this.bufferToBuffer(c,e,0,k,f,0,1)},bufferToBuffer:function(a,d,b,e,c,f,g){g=g||1;C!==d&&(m=p(d),C=d);D!==c&&(u=p(c),D=c);g=b+3*g;if(m!==u||0===m&&!d.equals(c))if(0<m&&0<u)if(2!==u){var k=I[u];
if(2!==m)for(c=q[m];b<g;b+=3,f+=3)c(a,b,h,0,d.wkid),k(h,0,e,f);else for(;b<g;b+=3,f+=3)k(a,b,e,f)}else for(c=q[m];b<g;b+=3,f+=3)c(a,b,e,f,d.wkid);else return!1;else if(e!==a||b!==f)for(;b<g;b++,f++)e[f]=a[b];return!0},computeLinearTransformation:function(a,d,b,e){var c=p(a),f=p(e);if(c===f&&(0!==c||a.equals(e)))return t.identity(b),t.translate(b,d),!0;if(1===f){if(e=q[c])return e(d,0,h,0,a.wkid),z(h,0,n,0),e=l*h[0],d=l*h[1],a=Math.sin(e),e=Math.cos(e),c=Math.sin(d),d=Math.cos(d),b[0]=-a,b[4]=-c*e,
b[8]=d*e,b[12]=n[0],b[1]=e,b[5]=-c*a,b[9]=d*a,b[13]=n[1],b[2]=0,b[6]=d,b[10]=c,b[14]=n[2],b[3]=0,b[7]=0,b[11]=0,b[15]=1,!0}else if(3===f&&(2===c||1===c))return q[c](d,0,h,0,a.wkid),a=l*h[1],y(h,0,n,0),t.identity(b),t.translate(b,n),a=1/Math.cos(a),t.scale(b,[a,a,1]),!0;return!1},mbsToMbs:function(a,d,b,c){var e=p(d),f=p(c);if(e===f&&(0!==e||d.equals(c)))return b[0]=a[0],b[1]=a[1],b[2]=a[2],b[3]=a[3],!0;if(1===f){if(c=q[e])return c(a,0,h,0,d.wkid),z(h,0,b,0),b[3]=a[3],!0}else if(3===f&&(2===e||1===
e))return q[e](a,0,h,0,d.wkid),d=l*h[1],d=Math.abs(d)+Math.asin(a[3]/(g+a[2])),y(h,0,b,0),b[3]=d>.9999*Math.PI?Number.MAX_VALUE:1/Math.cos(d)*a[3],!0;return!1},extentToBoundingBox:function(a,d,b){if(null==a)return!1;var e;c[0]=null!=a.xmin?a.xmin:0;c[1]=null!=a.ymin?a.ymin:0;c[2]=null!=a.zmin?a.zmin:0;e=this.bufferToBuffer(c,a.spatialReference,0,d,b,0,1);c[0]=null!=a.xmax?a.xmax:0;c[1]=null!=a.ymax?a.ymax:0;c[2]=null!=a.zmax?a.zmax:0;e=e&&this.bufferToBuffer(c,a.spatialReference,0,d,b,3,1);null==
a.xmin&&(d[0]=-Infinity);null==a.ymin&&(d[1]=-Infinity);null==a.zmin&&(d[2]=-Infinity);null==a.xmax&&(d[3]=Infinity);null==a.ymax&&(d[4]=Infinity);null==a.zmax&&(d[5]=Infinity);return e},extentToBoundingRect:function(a,d,b){if(null==a)return!1;var e;c[0]=null!=a.xmin?a.xmin:0;c[1]=null!=a.ymin?a.ymin:0;c[2]=null!=a.zmin?a.zmin:0;e=this.bufferToBuffer(c,a.spatialReference,0,c,b,0,1);d[0]=c[0];d[1]=c[1];c[0]=null!=a.xmax?a.xmax:0;c[1]=null!=a.ymax?a.ymax:0;c[2]=null!=a.zmax?a.zmax:0;e=e&&this.bufferToBuffer(c,
a.spatialReference,0,c,b,0,1);d[2]=c[0];d[3]=c[1];null==a.xmin&&(d[0]=-Infinity);null==a.ymin&&(d[1]=-Infinity);null==a.xmax&&(d[2]=Infinity);null==a.ymax&&(d[3]=Infinity);return e},webMercator:{x2lon:function(a){return a/g},y2lat:function(a){return Math.PI/2-2*Math.atan(Math.exp(-1*a/g))},lon2x:function(a){return a*g},lat2y:function(a){a=Math.sin(a);return g/2*Math.log((1+a)/(1-a))}}}});