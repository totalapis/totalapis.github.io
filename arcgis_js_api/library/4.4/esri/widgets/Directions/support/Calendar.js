// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.4/esri/copyright.txt for details.
//>>built
define("require exports ../../../core/tsSupport/declareExtendsHelper ../../../core/tsSupport/decorateHelper ../../support/widget ../../../core/accessorSupport/decorators ../../Widget ../../../../moment/moment ./CalendarViewModel dojo/keys dojo/i18n!../nls/Calendar".split(" "),function(e,y,q,g,d,k,w,n,p,c,h){var x=[c.DOWN_ARROW,c.END,c.ENTER,c.HOME,c.LEFT_ARROW,c.PAGE_DOWN,c.PAGE_UP,c.RIGHT_ARROW,c.SPACE,c.UP_ARROW];e=function(e){function b(a){a=e.call(this)||this;a._activeDate=null;a._isOpen=!1;a._closedByUserAction=
!1;a.value=null;a.viewModel=new p;return a}q(b,e);b.prototype.render=function(){var a=this.viewModel.value.format("L"),f=this._isOpen,b=(l={},l["esri-icon-down-arrow"]=!f,l["esri-icon-up-arrow"]=f,l);return d.tsx("div",{class:"esri-calendar esri-widget"},d.tsx("div",{afterUpdate:this._focusSelectedOrClosed,"aria-pressed":f.toString(),bind:this,class:d.join("esri-widget-button","esri-calendar__date-picker-toggle"),onclick:this._toggle,onkeydown:this._toggle,role:"button",tabIndex:0},d.tsx("span",{class:"esri-calendar__date"},
a),d.tsx("span",{"aria-hidden":"true",classes:b})),f?this._renderCalendarOptions():null);var l};b.prototype._focusSelectedOrClosed=function(a){this._closedByUserAction&&(this._closedByUserAction=!1,a.focus())};b.prototype._handleDatePickerKeydown=function(a){a.keyCode===c.ESCAPE&&(this._closedByUserAction=!0,this._close(),a.preventDefault(),a.stopPropagation())};b.prototype._renderCalendarOptions=function(){var a=this._activeDate,f=this.get("viewModel.value");return d.tsx("div",{bind:this,class:"esri-calendar__date-picker",
key:"esri-calendar__date-picker",onkeydown:this._handleDatePickerKeydown},this._renderMonthPicker(a),this._renderDayPicker(a,f),this._renderYearPicker(a))};b.prototype._renderMonthPicker=function(a){var f=n.months().map(function(f,b){b=a.month()===b;return d.tsx("option",{selected:b},f)});return d.tsx("div",{class:"esri-calendar__month-picker"},d.tsx("div",{"aria-label":h.goToPreviousMonth,bind:this,class:"esri-widget-button",onclick:this._setPreviousMonth,onkeydown:this._setPreviousMonth,role:"button",
tabIndex:0,title:h.goToPreviousMonth},d.tsx("span",{"aria-hidden":"true",class:"esri-icon-left"})),d.tsx("select",{"aria-live":"assertive",bind:this,class:"esri-calendar__month-dropdown",id:this.id+"__month-picker",onchange:this._setMonth,onkeydown:this._setMonth},f),d.tsx("div",{"aria-label":h.goToNextMonth,bind:this,class:"esri-widget-button",onclick:this._setNextMonth,onkeydown:this._setNextMonth,role:"button",tabIndex:0,title:h.goToNextMonth},d.tsx("span",{"aria-hidden":"true",class:"esri-icon-right"})))};
b.prototype._renderDayPicker=function(a,f){var b=a.clone().day(n.localeData().firstDayOfWeek()),b=this._getWeekLabels(b),c=this._getDayId(a);a=this._renderCalendarMonth(a,f);return d.tsx("div",{afterCreate:this._handleDayPickerCreate,"aria-activedescendant":c,"aria-labelledby":this.id+"__month-picker "+this.id+"__selected-year",bind:this,class:"esri-calendar__day-picker",id:this.id+"__day-picker",onkeydown:this._handleDayPickerKeydown,role:"grid",tabIndex:0},d.tsx("div",{class:"esri-calendar__week-item",
role:"row"},b.map(function(a){return d.tsx("div",{"aria-label":a.name,class:d.join("esri-calendar__day-item","esri-calendar__day-item--header"),role:"columnheader",title:a.name},a.abbr)})),a)};b.prototype._getDayId=function(a){return this.id+"__"+a.format("YYYY-MM-DD")};b.prototype._handleDayPickerCreate=function(a){a.focus()};b.prototype._getWeekLabels=function(a){for(var f=[],b=0;7>b;b++)f.push({name:a.format("dddd"),abbr:a.format("dd")}),a.add(1,"day");return f};b.prototype._handleDayPickerKeydown=
function(a){var b=a.keyCode,d=a.ctrlKey,l=a.shiftKey,e=this._activeDate;if(-1!==x.indexOf(b)){if(b===c.LEFT_ARROW)e.subtract(1,"day");else if(b===c.RIGHT_ARROW)e.add(1,"day");else if(b===c.UP_ARROW)e.subtract(1,"week");else if(b===c.DOWN_ARROW)e.add(1,"week");else if(b===c.PAGE_UP)e.subtract(1,l?"year":"month");else if(b===c.PAGE_DOWN)e.add(1,l?"year":"month");else if(b===c.HOME)e.startOf(d?"year":"month");else if(b===c.END)e.endOf(d?"year":"month");else if(b===c.ENTER||b===c.SPACE)this.viewModel.value=
e.clone(),this._closedByUserAction=!0,this._close();a.preventDefault();a.stopPropagation()}};b.prototype._renderCalendarMonth=function(a,b){for(var e=n(),c=n.localeData(),f=a.clone().startOf("month"),g=a.clone().endOf("month"),c=f.clone().subtract(f.weekday()-c.firstDayOfWeek(),"day"),h=[],k=0;6>k;k++){for(var p=[],t=0;7>t;t++){var u=c.date(),v=c.isSame(a,"day"),r=c.isSame(b,"day"),q=this._getDayId(c),r=(m={},m["esri-calendar__day-item--nearby-month"]=!c.isBetween(f,g,null,"[]"),m["esri-calendar__day-item--today"]=
c.isSame(e,"day"),m["esri-calendar__day-item--active"]=v,m["esri-calendar__day-item--selected"]=r,m);p.push(d.tsx("div",{"aria-label":u.toString(),"aria-selected":v.toString(),bind:this,class:"esri-calendar__day-item","data-iso-date":c.toISOString(),classes:r,id:q,onclick:this._handleSelectedDate,onkeydown:this._handleSelectedDate,role:"gridcell"},u));c.add(1,"day")}h.push(d.tsx("div",{class:"esri-calendar__week-item",role:"row"},p))}return h;var m};b.prototype._renderYearPicker=function(a){var b=
a.clone();a=b.format("YYYY");var c=b.add(1,"year").format("YYYY"),b=b.subtract(2,"year").format("YYYY");return d.tsx("div",{class:"esri-calendar__year-picker"},d.tsx("div",{"aria-label":h.goToPreviousYear,bind:this,class:"esri-calendar__year-picker-item",onclick:this._setPreviousYear,onkeydown:this._setPreviousYear,tabIndex:0,title:h.goToPreviousYear},b),d.tsx("div",{class:d.join("esri-calendar__year-picker-item","esri-calendar__year-picker-item--selected"),id:this.id+"__selected-year"},a),d.tsx("div",
{"aria-label":h.goToNextYear,bind:this,class:"esri-calendar__year-picker-item",onclick:this._setNextYear,onkeydown:this._setNextYear,tabIndex:0,title:h.goToNextYear},c))};b.prototype._toggle=function(){this._isOpen?this._close():this._open(this.viewModel.value.clone())};b.prototype._setMonth=function(a){a=a.target;a=a.item(a.selectedIndex).value;this._activeDate.month(a)};b.prototype._close=function(){this._activeDate=null;this._isOpen=!1};b.prototype._open=function(a){this._activeDate=a;this._isOpen=
!0};b.prototype._setPreviousMonth=function(){this._activeDate.subtract(1,"month")};b.prototype._setNextMonth=function(){this._activeDate.add(1,"month")};b.prototype._setPreviousYear=function(){this._activeDate.subtract(1,"year")};b.prototype._setNextYear=function(){this._activeDate.add(1,"year")};b.prototype._handleSelectedDate=function(a){this.viewModel.value=n(a.target.getAttribute("data-iso-date"));this._closedByUserAction=!0;this._close()};return b}(k.declared(w));g([k.aliasOf("viewModel.value")],
e.prototype,"value",void 0);g([k.property({type:p}),d.renderable("viewModel.value")],e.prototype,"viewModel",void 0);g([d.accessibleHandler()],e.prototype,"_toggle",null);g([d.accessibleHandler()],e.prototype,"_setPreviousMonth",null);g([d.accessibleHandler()],e.prototype,"_setNextMonth",null);g([d.accessibleHandler()],e.prototype,"_setPreviousYear",null);g([d.accessibleHandler()],e.prototype,"_setNextYear",null);g([d.accessibleHandler()],e.prototype,"_handleSelectedDate",null);return e=g([k.subclass("esri.widgets.Directions.support.Calendar")],
e)});