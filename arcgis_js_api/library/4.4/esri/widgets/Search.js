// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.4/esri/copyright.txt for details.
//>>built
define("require exports ../core/tsSupport/declareExtendsHelper ../core/tsSupport/decorateHelper ../core/accessorSupport/decorators ./support/widget ./Search/SearchViewModel ./Search/SearchResultRenderer ./Widget ../core/lang ../core/watchUtils ../PopupTemplate dojo/regexp dojo/keys dojo/query dojo/i18n!./Search/nls/Search".split(" "),function(d,A,t,a,e,c,n,u,v,w,r,x,y,f,p,h){d=function(d){function a(b){b=d.call(this)||this;b._inputNode=null;b._sourceMenuButtonNode=null;b._sourceListNode=null;b._suggestionListNode=
null;b._searchResultRenderer=new u({container:document.createElement("div")});b._popupTemplate=new x({title:h.searchResult,content:b._renderSearchResultsContent.bind(b)});b.activeMenu="none";b.activeSource=null;b.activeSourceIndex=null;b.allPlaceholder=null;b.autoNavigate=null;b.autoSelect=null;b.defaultSource=null;b.locationToAddressDistance=null;b.maxResults=null;b.maxSuggestions=null;b.minSuggestCharacters=null;b.popupEnabled=null;b.popupOpenOnSelect=null;b.popupTemplate=null;b.resultGraphic=null;
b.resultGraphicEnabled=null;b.results=null;b.searchAllEnabled=null;b.searching=!1;b.searchTerm=null;b.selectedResult=null;b.sources=null;b.suggestions=null;b.suggestionsEnabled=null;b.view=null;b.viewModel=new n;return b}t(a,d);a.prototype.postInitialize=function(){var b=this;this.viewModel.popupTemplate=this._popupTemplate;this.own(r.on(this,"viewModel","suggest-complete",function(a){0!==a.numResults&&(b.activeMenu="suggestion")}),r.on(this,"viewModel","search-clear",function(){b.activeMenu="none"}))};
a.prototype.destroy=function(){this._searchResultRenderer&&(this._searchResultRenderer.viewModel=null,this._searchResultRenderer.destroy(),this._searchResultRenderer=null)};a.prototype.clear=function(){};a.prototype.focus=function(){this._inputNode&&this._inputNode.focus()};a.prototype.blur=function(){this._inputNode&&this._inputNode.blur();this.activeMenu="none"};a.prototype.search=function(b){return null};a.prototype.suggest=function(b){return null};a.prototype.render=function(){var b=this,a=this.viewModel,
g=a.searchTerm,d=this._getSourceName(a.activeSourceIndex),e=g.trim(),f=this.id,k=c.tsx("input",{bind:this,placeholder:a.placeholder,"aria-label":h.searchButtonTitle,maxlength:a.maxInputLength,autocomplete:"off",type:"text",tabindex:"0",class:"esri-search__input",value:g,"aria-haspopup":"true",id:f+"_input",role:"textbox",onclick:this._handleInputClick,onkeyup:this._handleInputKeyup,oninput:this._handleInputPaste,onpaste:this._handleInputPaste,afterUpdate:this._storeInputNode,onfocus:this._handleInputFocus,
onblur:this._handleInputBlur}),k=c.tsx("form",{key:"esri-search__form",bind:this,class:"esri-search__form",onsubmit:this._formSubmit,role:"search"},k),q=g?c.tsx("div",{key:"esri-search__clear-button",bind:this,role:"button",class:c.join("esri-search__clear-button","esri-widget-button"),tabindex:"0",title:h.clearButtonTitle,onclick:this._handleClearButtonClick,onkeydown:this._handleClearButtonClick},c.tsx("span",{"aria-hidden":"true",class:"esri-icon-close"})):null,l=a.suggestions?a.suggestions.map(function(a){var g=
a.sourceIndex,z=a.results.length?b._getSuggestionHeaderNode(g):null;a=a.results.map(function(a,c){return b._getSuggestionNode(a,c,g)});return c.tsx("div",{key:"esri-search__suggestion-container-"+g},z,c.tsx("ul",{key:"esri-search__suggestion-list-"+g},a))}):null,l=c.tsx("div",{key:"esri-search__suggestions-menu",class:c.join("esri-menu","esri-search__suggestions-menu"),role:"menu",bind:this,afterUpdate:this._storeSuggestionsListNode},l),k=c.tsx("div",{key:"esri-search__input-container",class:"esri-search__input-container"},
k,q,l),q=c.tsx("div",{key:"esri-search__submit-button",bind:this,role:"button",title:h.searchButtonTitle,class:c.join("esri-search__submit-button","esri-widget-button"),tabindex:"0",onclick:this._handleSearchButtonClick,onkeydown:this._handleSearchButtonClick},c.tsx("span",{"aria-hidden":"true",role:"presentation",class:"esri-icon-search"}),c.tsx("span",{class:"esri-icon-font-fallback-text"},h.searchButtonTitle)),g=w.substitute({value:'"'+g+'"'},h.noResultsFound),g=e?c.tsx("div",{key:"esri-search__no_results"},
c.tsx("div",{class:"esri-search__warning-header"},h.noResults),c.tsx("div",{class:"esri-search__warning-text"},g)):null,e=e?null:c.tsx("div",{key:"esri-search__empty-search"},c.tsx("span",{"aria-hidden":"true",class:"esri-icon-notice-triangle"}),c.tsx("span",{class:"esri-search__no-value-text"},h.emptyValue)),e=c.tsx("div",{key:"esri-search__error-menu",class:c.join("esri-menu","esri-search__warning-menu")},c.tsx("div",{class:"esri-search__warning-body"},g,e)),l=a.sources,g=1<l.length,l=l&&l.toArray(),
a=a.searchAllEnabled?this._getSourceNode(n.ALL_INDEX):null,d=g?c.tsx("div",{key:"esri-search__source-menu-button",bind:this,role:"button",title:h.searchIn,id:f+"_menu_button",class:c.join("esri-search__sources-button","esri-widget-button"),tabindex:"0",onkeydown:this._handleSourcesMenuToggleClick,onclick:this._handleSourcesMenuToggleClick,onkeyup:this._handleSourceMenuButtonKeyup,afterUpdate:this._storeSourceMenuButtonNode},c.tsx("span",{"aria-hidden":"true",role:"presentation",class:"esri-icon-down-arrow esri-search__sources-button--down"}),
c.tsx("span",{"aria-hidden":"true",role:"presentation",class:"esri-icon-up-arrow esri-search__sources-button--up"}),c.tsx("span",{class:"esri-search__source-name"},d)):null,f=g?c.tsx("ul",{bind:this,afterUpdate:this._storeSourcesListNode},a,l.map(function(a,c){return b._getSourceNode(c)})):null,f=c.tsx("div",{key:"esri-search__source-menu",class:c.join("esri-menu","esri-search__sources-menu"),role:"menu"},f),a=this.activeMenu,a=(m={},m["esri-search--multiple-sources"]=g,m["esri-search--loading"]=
this.searching,m["esri-search--warning"]="warning"===a,m["esri-search--sources"]="source"===a,m["esri-search--show-suggestions"]="suggestion"===a,m);return c.tsx("div",{class:"esri-search esri-widget"},c.tsx("div",{role:"presentation",classes:a,class:"esri-search__container"},d,f,k,q,e));var m};a.prototype._handleSourcesMenuToggleClick=function(){this.activeMenu="source"===this.activeMenu?"none":"source"};a.prototype._handleClearButtonClick=function(){this.viewModel.clear();this.focus()};a.prototype._handleSearchButtonClick=
function(){this._performSearch()};a.prototype._handleSuggestionClick=function(b){if(b=b.currentTarget["data-suggestion"])this._performSearch(b),this.focus()};a.prototype._handleSourceClick=function(b){this.viewModel.activeSourceIndex=b.currentTarget["data-source-index"];this.activeMenu="none";this.focus()};a.prototype._performSearch=function(b){var a=this;this.activeMenu="none";this._set("searching",!0);this.viewModel.search(b).always(function(b){var c=0;b&&b.forEach(function(b){c+=b.results.length});
a.activeMenu=0===c?"warning":"none";a._set("searching",!1)})};a.prototype._handleInputFocus=function(){this.emit("search-focus")};a.prototype._handleInputBlur=function(){this.emit("search-blur")};a.prototype._storeSuggestionsListNode=function(b){this._suggestionListNode=b};a.prototype._storeSourcesListNode=function(b){this._sourceListNode=b};a.prototype._storeInputNode=function(b){this._inputNode=b};a.prototype._storeSourceMenuButtonNode=function(b){this._sourceMenuButtonNode=b};a.prototype._handleInputClick=
function(){this.activeMenu="none"};a.prototype._handleInputKeyup=function(b){var a=b.keyCode,c=b.ctrlKey||b.metaKey||a===f.copyKey||a===f.LEFT_ARROW||a===f.RIGHT_ARROW||a===f.ENTER,d=this._suggestionListNode?p("li",this._suggestionListNode):null,e=this.viewModel,h=a===f.UP_ARROW,k=a===f.DOWN_ARROW;c||(a===f.TAB||a===f.ESCAPE?(e.cancelSuggest(),this.activeMenu="none"):(h||k)&&d?(this.activeMenu="suggestion",b.stopPropagation(),b.preventDefault(),e.cancelSuggest(),(b=d[h?d.length-1:0])&&b.focus()):
e.suggest())};a.prototype._handleInputPaste=function(b){var a=this.viewModel;b=b.target;a.searchTerm!==b.value&&(a.searchTerm=b.value);a.suggest()};a.prototype._handleSourceMenuButtonKeyup=function(b){var a=b.keyCode,c=a===f.UP_ARROW,a=a===f.DOWN_ARROW;if(c||a)b.stopPropagation(),b.preventDefault(),(b=this._sourceListNode?p("li",this._sourceListNode):null)&&(c=b[c?b.length-1:0])&&c.focus()};a.prototype._handleSourceKeyup=function(b){var a=b.target,c=this._sourceListNode?p("li",this._sourceListNode):
null,d=b.keyCode;d===f.ESCAPE?(this.activeMenu="none",this.focus()):c&&(a=c.indexOf(a),d===f.UP_ARROW?(b.stopPropagation(),b.preventDefault(),b=a-1,(c=0>b?this._sourceMenuButtonNode:c[b])&&c.focus()):d===f.DOWN_ARROW&&(b.stopPropagation(),b.preventDefault(),b=a+1,(c=b>=c.length?this._sourceMenuButtonNode:c[b])&&c.focus()))};a.prototype._handleSuggestionKeyup=function(b){var a=b.target,c=this._suggestionListNode?p("li",this._suggestionListNode):null,a=c.indexOf(a),d=b.keyCode;this.viewModel.cancelSuggest();
d===f.BACKSPACE||d===f.DELETE?this.focus():d===f.ESCAPE?(this.activeMenu="none",this.focus()):c&&(d===f.UP_ARROW?(b.stopPropagation(),b.preventDefault(),b=a-1,0>b?this.focus():(c=c[b])&&c.focus()):d===f.DOWN_ARROW&&(b.stopPropagation(),b.preventDefault(),b=a+1,b>=c.length?this.focus():(c=c[b])&&c.focus()))};a.prototype._formSubmit=function(b){b.preventDefault();this._performSearch()};a.prototype._getSourceName=function(b){var a=this.viewModel.sources.getItemAt(b);return b===n.ALL_INDEX?h.all:a?a.name:
h.untitledSource};a.prototype._getSuggestionHeaderNode=function(a){var b=this.viewModel;return 1<b.sources.length&&b.activeSourceIndex===n.ALL_INDEX?(a=this._getSourceName(a),c.tsx("div",{class:"esri-header"},a)):null};a.prototype._splitResult=function(a,c){c=y.escapeString(c);return a.replace(new RegExp("(^|)("+c+")(|$)","ig"),"$1|$2|$3").split("|")};a.prototype._getSuggestionNode=function(a,d,e){var b=this.viewModel.searchTerm;if(b){var f=this._splitResult(a.text||h.untitledResult,b),g=b.toLowerCase(),
k=[];f.forEach(function(a,b){a&&a.length&&(b=e+"-"+d+"-"+b,a.toLowerCase()===g?k.push(c.tsx("strong",{key:"esri-search__partial-match-"+b},a)):k.push(a))});return c.tsx("li",{bind:this,onclick:this._handleSuggestionClick,onkeydown:this._handleSuggestionClick,onkeyup:this._handleSuggestionKeyup,key:"esri-search__suggestion$-{sourceIndex}_"+d,"data-suggestion":a,role:"menuitem",tabindex:"0"},k)}};a.prototype._getSourceNode=function(a){var b=(d={},d["esri-search__source--active"]=a===this.viewModel.activeSourceIndex,
d);return c.tsx("li",{bind:this,key:"esri-search__source-"+a,onclick:this._handleSourceClick,onkeydown:this._handleSourceClick,onkeyup:this._handleSourceKeyup,"data-source-index":a,role:"menuitem",class:"esri-search__source",classes:b,tabindex:"0"},this._getSourceName(a));var d};a.prototype._renderSearchResultsContent=function(){this._searchResultRenderer.showMoreResultsOpen=!1;this._searchResultRenderer.viewModel=this.viewModel;return this._searchResultRenderer};return a}(e.declared(v));a([e.property(),
c.renderable()],d.prototype,"activeMenu",void 0);a([e.aliasOf("viewModel.activeSource"),c.renderable()],d.prototype,"activeSource",void 0);a([e.aliasOf("viewModel.activeSourceIndex"),c.renderable()],d.prototype,"activeSourceIndex",void 0);a([e.aliasOf("viewModel.allPlaceholder"),c.renderable()],d.prototype,"allPlaceholder",void 0);a([e.aliasOf("viewModel.autoNavigate")],d.prototype,"autoNavigate",void 0);a([e.aliasOf("viewModel.autoSelect")],d.prototype,"autoSelect",void 0);a([e.aliasOf("viewModel.defaultSource")],
d.prototype,"defaultSource",void 0);a([e.aliasOf("viewModel.locationToAddressDistance")],d.prototype,"locationToAddressDistance",void 0);a([e.aliasOf("viewModel.maxResults")],d.prototype,"maxResults",void 0);a([e.aliasOf("viewModel.maxSuggestions")],d.prototype,"maxSuggestions",void 0);a([e.aliasOf("viewModel.minSuggestCharacters")],d.prototype,"minSuggestCharacters",void 0);a([e.aliasOf("viewModel.popupEnabled")],d.prototype,"popupEnabled",void 0);a([e.aliasOf("viewModel.popupOpenOnSelect")],d.prototype,
"popupOpenOnSelect",void 0);a([e.aliasOf("viewModel.popupTemplate")],d.prototype,"popupTemplate",void 0);a([e.aliasOf("viewModel.resultGraphic")],d.prototype,"resultGraphic",void 0);a([e.aliasOf("viewModel.resultGraphicEnabled")],d.prototype,"resultGraphicEnabled",void 0);a([e.aliasOf("viewModel.results"),c.renderable()],d.prototype,"results",void 0);a([e.aliasOf("viewModel.searchAllEnabled"),c.renderable()],d.prototype,"searchAllEnabled",void 0);a([e.property({readOnly:!0}),c.renderable()],d.prototype,
"searching",void 0);a([e.aliasOf("viewModel.searchTerm"),c.renderable()],d.prototype,"searchTerm",void 0);a([e.aliasOf("viewModel.selectedResult")],d.prototype,"selectedResult",void 0);a([e.aliasOf("viewModel.sources"),c.renderable()],d.prototype,"sources",void 0);a([e.aliasOf("viewModel.suggestions"),c.renderable()],d.prototype,"suggestions",void 0);a([e.aliasOf("viewModel.suggestionsEnabled")],d.prototype,"suggestionsEnabled",void 0);a([e.aliasOf("viewModel.view"),c.renderable()],d.prototype,"view",
void 0);a([c.vmEvent("search-clear search-complete search-start select-result suggest-start suggest-complete".split(" ")),e.property({type:n}),c.renderable("viewModel")],d.prototype,"viewModel",void 0);a([e.aliasOf("viewModel.clear")],d.prototype,"clear",null);a([e.aliasOf("viewModel.search")],d.prototype,"search",null);a([e.aliasOf("viewModel.suggest")],d.prototype,"suggest",null);a([c.accessibleHandler()],d.prototype,"_handleSourcesMenuToggleClick",null);a([c.accessibleHandler()],d.prototype,"_handleClearButtonClick",
null);a([c.accessibleHandler()],d.prototype,"_handleSearchButtonClick",null);a([c.accessibleHandler()],d.prototype,"_handleSuggestionClick",null);a([c.accessibleHandler()],d.prototype,"_handleSourceClick",null);return d=a([e.subclass("esri.widgets.Search")],d)});